<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harald Pretl">
<meta name="dcterms.date" content="2025-11-12">

<title>Radio-Frequency Integrated Circuits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b66d9f3da4d84aca26cc7cc1c94b0445.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-d3daa1d1ef55350d6f5c3e6cec97cbbd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-b66d9f3da4d84aca26cc7cc1c94b0445.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Radio-Frequency Integrated Circuits</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./rfic.html" aria-current="page"> 
<span class="menu-text">Course Material</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./rfic.pdf"> <i class="bi bi-filetype-pdf" role="img">
</i> 
<span class="menu-text">PDF</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/iic-jku/radio-frequency-integrated-circuits" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#sec-intro-wireless" id="toc-sec-intro-wireless" class="nav-link" data-scroll-target="#sec-intro-wireless"><span class="header-section-number">1.1</span> Wireless Transmission</a></li>
  <li><a href="#sec-intro-standards" id="toc-sec-intro-standards" class="nav-link" data-scroll-target="#sec-intro-standards"><span class="header-section-number">1.2</span> Wireless Standards</a></li>
  </ul></li>
  <li><a href="#sec-fundamentals" id="toc-sec-fundamentals" class="nav-link" data-scroll-target="#sec-fundamentals"><span class="header-section-number">2</span> Fundamentals</a>
  <ul class="collapse">
  <li><a href="#sec-channel-capacity" id="toc-sec-channel-capacity" class="nav-link" data-scroll-target="#sec-channel-capacity"><span class="header-section-number">2.1</span> Channel Capacity</a></li>
  <li><a href="#sec-linearity" id="toc-sec-linearity" class="nav-link" data-scroll-target="#sec-linearity"><span class="header-section-number">2.2</span> Linearity</a>
  <ul class="collapse">
  <li><a href="#sec-linearity-single" id="toc-sec-linearity-single" class="nav-link" data-scroll-target="#sec-linearity-single"><span class="header-section-number">2.2.1</span> Single-Tone Linearity</a></li>
  <li><a href="#multi-tone-linearity" id="toc-multi-tone-linearity" class="nav-link" data-scroll-target="#multi-tone-linearity"><span class="header-section-number">2.2.2</span> Multi-Tone Linearity</a></li>
  </ul></li>
  <li><a href="#sec-noise" id="toc-sec-noise" class="nav-link" data-scroll-target="#sec-noise"><span class="header-section-number">2.3</span> Noise</a>
  <ul class="collapse">
  <li><a href="#sec-noise-types" id="toc-sec-noise-types" class="nav-link" data-scroll-target="#sec-noise-types"><span class="header-section-number">2.3.1</span> Types of Noise Generation</a></li>
  <li><a href="#noise-in-impedance-matched-systems" id="toc-noise-in-impedance-matched-systems" class="nav-link" data-scroll-target="#noise-in-impedance-matched-systems"><span class="header-section-number">2.3.2</span> Noise in Impedance-Matched Systems</a></li>
  <li><a href="#sec-noise-figure" id="toc-sec-noise-figure" class="nav-link" data-scroll-target="#sec-noise-figure"><span class="header-section-number">2.3.3</span> Noise Figure</a></li>
  <li><a href="#sec-sensitivity" id="toc-sec-sensitivity" class="nav-link" data-scroll-target="#sec-sensitivity"><span class="header-section-number">2.3.4</span> Sensitivity</a></li>
  </ul></li>
  <li><a href="#sec-fundamentals-modulation" id="toc-sec-fundamentals-modulation" class="nav-link" data-scroll-target="#sec-fundamentals-modulation"><span class="header-section-number">2.4</span> Modulation</a></li>
  <li><a href="#sec-fundamentals-pulse-shaping" id="toc-sec-fundamentals-pulse-shaping" class="nav-link" data-scroll-target="#sec-fundamentals-pulse-shaping"><span class="header-section-number">2.5</span> Pulse Shaping and Spectral Efficiency</a></li>
  <li><a href="#sec-fundamentals-ofdm" id="toc-sec-fundamentals-ofdm" class="nav-link" data-scroll-target="#sec-fundamentals-ofdm"><span class="header-section-number">2.6</span> Orthogonal Frequency-Division Multiplexing (OFDM)</a></li>
  <li><a href="#sec-fundamentals-multiple-access" id="toc-sec-fundamentals-multiple-access" class="nav-link" data-scroll-target="#sec-fundamentals-multiple-access"><span class="header-section-number">2.7</span> Multiple Access Techniques</a></li>
  </ul></li>
  <li><a href="#sec-trx" id="toc-sec-trx" class="nav-link" data-scroll-target="#sec-trx"><span class="header-section-number">3</span> Transceivers</a>
  <ul class="collapse">
  <li><a href="#sec-trx-direct-conversion" id="toc-sec-trx-direct-conversion" class="nav-link" data-scroll-target="#sec-trx-direct-conversion"><span class="header-section-number">3.1</span> Direct-Conversion Transceiver</a></li>
  <li><a href="#sec-trx-mod-demod" id="toc-sec-trx-mod-demod" class="nav-link" data-scroll-target="#sec-trx-mod-demod"><span class="header-section-number">3.2</span> Modulation and Demodulation</a></li>
  <li><a href="#filtering" id="toc-filtering" class="nav-link" data-scroll-target="#filtering"><span class="header-section-number">3.3</span> Filtering</a></li>
  <li><a href="#direct-conversion-architecture" id="toc-direct-conversion-architecture" class="nav-link" data-scroll-target="#direct-conversion-architecture"><span class="header-section-number">3.4</span> Direct-Conversion Architecture</a></li>
  <li><a href="#sec-trx-duplexing" id="toc-sec-trx-duplexing" class="nav-link" data-scroll-target="#sec-trx-duplexing"><span class="header-section-number">3.5</span> Duplexing</a>
  <ul class="collapse">
  <li><a href="#frequency-division-duplex-fdd" id="toc-frequency-division-duplex-fdd" class="nav-link" data-scroll-target="#frequency-division-duplex-fdd"><span class="header-section-number">3.5.1</span> Frequency-Division Duplex (FDD)</a></li>
  <li><a href="#time-division-duplex-tdd" id="toc-time-division-duplex-tdd" class="nav-link" data-scroll-target="#time-division-duplex-tdd"><span class="header-section-number">3.5.2</span> Time-Division Duplex (TDD)</a></li>
  <li><a href="#comparison-of-fdd-and-tdd" id="toc-comparison-of-fdd-and-tdd" class="nav-link" data-scroll-target="#comparison-of-fdd-and-tdd"><span class="header-section-number">3.5.3</span> Comparison of FDD and TDD</a></li>
  </ul></li>
  <li><a href="#specialty-architectures" id="toc-specialty-architectures" class="nav-link" data-scroll-target="#specialty-architectures"><span class="header-section-number">3.6</span> Specialty Architectures</a>
  <ul class="collapse">
  <li><a href="#super-heterodyne-architecture" id="toc-super-heterodyne-architecture" class="nav-link" data-scroll-target="#super-heterodyne-architecture"><span class="header-section-number">3.6.1</span> Super-Heterodyne Architecture</a></li>
  <li><a href="#low-if-architecture" id="toc-low-if-architecture" class="nav-link" data-scroll-target="#low-if-architecture"><span class="header-section-number">3.6.2</span> Low-IF Architecture</a></li>
  <li><a href="#super-simple-architecture" id="toc-super-simple-architecture" class="nav-link" data-scroll-target="#super-simple-architecture"><span class="header-section-number">3.6.3</span> Super Simple Architecture</a></li>
  </ul></li>
  <li><a href="#iq-imbalance" id="toc-iq-imbalance" class="nav-link" data-scroll-target="#iq-imbalance"><span class="header-section-number">3.7</span> I/Q Imbalance</a></li>
  </ul></li>
  <li><a href="#sec-lna" id="toc-sec-lna" class="nav-link" data-scroll-target="#sec-lna"><span class="header-section-number">4</span> Low Noise Amplifiers</a>
  <ul class="collapse">
  <li><a href="#sec-lna-resistive-matching" id="toc-sec-lna-resistive-matching" class="nav-link" data-scroll-target="#sec-lna-resistive-matching"><span class="header-section-number">4.1</span> Resistively Matched Common-Source LNA</a></li>
  <li><a href="#sec-lna-common-gate" id="toc-sec-lna-common-gate" class="nav-link" data-scroll-target="#sec-lna-common-gate"><span class="header-section-number">4.2</span> Common-Gate LNA</a></li>
  <li><a href="#sec-lna-inductive-degeneration" id="toc-sec-lna-inductive-degeneration" class="nav-link" data-scroll-target="#sec-lna-inductive-degeneration"><span class="header-section-number">4.3</span> Inductively-Degenerated Common-Source LNA</a></li>
  <li><a href="#sec-lna-feedback" id="toc-sec-lna-feedback" class="nav-link" data-scroll-target="#sec-lna-feedback"><span class="header-section-number">4.4</span> Feedback LNA</a></li>
  </ul></li>
  <li><a href="#sec-mixer" id="toc-sec-mixer" class="nav-link" data-scroll-target="#sec-mixer"><span class="header-section-number">5</span> Mixers</a>
  <ul class="collapse">
  <li><a href="#sec-mixer-nonlinear" id="toc-sec-mixer-nonlinear" class="nav-link" data-scroll-target="#sec-mixer-nonlinear"><span class="header-section-number">5.1</span> Non-Linear Mixer</a></li>
  <li><a href="#sec-mixer-time-variant" id="toc-sec-mixer-time-variant" class="nav-link" data-scroll-target="#sec-mixer-time-variant"><span class="header-section-number">5.2</span> Time-Variant Mixer</a></li>
  <li><a href="#sec-mixer-gilbert" id="toc-sec-mixer-gilbert" class="nav-link" data-scroll-target="#sec-mixer-gilbert"><span class="header-section-number">5.3</span> Gilbert Cell Mixer</a></li>
  <li><a href="#sec-mixer-npath" id="toc-sec-mixer-npath" class="nav-link" data-scroll-target="#sec-mixer-npath"><span class="header-section-number">5.4</span> N-Path Filter</a></li>
  <li><a href="#sec-mixer-lo" id="toc-sec-mixer-lo" class="nav-link" data-scroll-target="#sec-mixer-lo"><span class="header-section-number">5.5</span> LO Generation</a>
  <ul class="collapse">
  <li><a href="#sec-lo-rc" id="toc-sec-lo-rc" class="nav-link" data-scroll-target="#sec-lo-rc"><span class="header-section-number">5.5.1</span> RC/CR Phase Shift Network</a></li>
  <li><a href="#sec-lo-polyphase" id="toc-sec-lo-polyphase" class="nav-link" data-scroll-target="#sec-lo-polyphase"><span class="header-section-number">5.5.2</span> Polyphase Filter</a></li>
  <li><a href="#sec-lo-ff" id="toc-sec-lo-ff" class="nav-link" data-scroll-target="#sec-lo-ff"><span class="header-section-number">5.5.3</span> Flip-Flop Based Phase Generation</a></li>
  <li><a href="#sec-lo-delay" id="toc-sec-lo-delay" class="nav-link" data-scroll-target="#sec-lo-delay"><span class="header-section-number">5.5.4</span> Delay-Based Phase Generation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-oscillator" id="toc-sec-oscillator" class="nav-link" data-scroll-target="#sec-oscillator"><span class="header-section-number">6</span> Oscillators</a>
  <ul class="collapse">
  <li><a href="#sec-oscillator-noise" id="toc-sec-oscillator-noise" class="nav-link" data-scroll-target="#sec-oscillator-noise"><span class="header-section-number">6.1</span> Oscillator Noise</a></li>
  <li><a href="#sec-oscillator-reciprocal-mixing" id="toc-sec-oscillator-reciprocal-mixing" class="nav-link" data-scroll-target="#sec-oscillator-reciprocal-mixing"><span class="header-section-number">6.2</span> Reciprocal Mixing</a></li>
  <li><a href="#sec-single-ended-oscillators" id="toc-sec-single-ended-oscillators" class="nav-link" data-scroll-target="#sec-single-ended-oscillators"><span class="header-section-number">6.3</span> Single-Ended Oscillators</a></li>
  <li><a href="#sec-differential-oscillators" id="toc-sec-differential-oscillators" class="nav-link" data-scroll-target="#sec-differential-oscillators"><span class="header-section-number">6.4</span> Differential Oscillators</a></li>
  <li><a href="#sec-frequency-tuning-of-oscillators" id="toc-sec-frequency-tuning-of-oscillators" class="nav-link" data-scroll-target="#sec-frequency-tuning-of-oscillators"><span class="header-section-number">6.5</span> Frequency Tuning of Oscillators</a></li>
  <li><a href="#sec-oscillator-modeling" id="toc-sec-oscillator-modeling" class="nav-link" data-scroll-target="#sec-oscillator-modeling"><span class="header-section-number">6.6</span> Oscillator Modelling</a></li>
  </ul></li>
  <li><a href="#sec-pll" id="toc-sec-pll" class="nav-link" data-scroll-target="#sec-pll"><span class="header-section-number">7</span> Phase-Locked Loops</a>
  <ul class="collapse">
  <li><a href="#sec-pll-basic-architecture" id="toc-sec-pll-basic-architecture" class="nav-link" data-scroll-target="#sec-pll-basic-architecture"><span class="header-section-number">7.1</span> Basic PLL Architecture</a></li>
  <li><a href="#sec-pll-charge-pump" id="toc-sec-pll-charge-pump" class="nav-link" data-scroll-target="#sec-pll-charge-pump"><span class="header-section-number">7.2</span> Charge-Pump PLL</a></li>
  <li><a href="#sec-pll-all-digital" id="toc-sec-pll-all-digital" class="nav-link" data-scroll-target="#sec-pll-all-digital"><span class="header-section-number">7.3</span> All-Digital PLL</a>
  <ul class="collapse">
  <li><a href="#sec-pll-tdc" id="toc-sec-pll-tdc" class="nav-link" data-scroll-target="#sec-pll-tdc"><span class="header-section-number">7.3.1</span> Time-to-Digital Converter</a></li>
  <li><a href="#sec-pll-dco" id="toc-sec-pll-dco" class="nav-link" data-scroll-target="#sec-pll-dco"><span class="header-section-number">7.3.2</span> Digitally Controlled Oscillator</a></li>
  </ul></li>
  <li><a href="#sec-pll-frac-n" id="toc-sec-pll-frac-n" class="nav-link" data-scroll-target="#sec-pll-frac-n"><span class="header-section-number">7.4</span> Fractional-N PLL</a>
  <ul class="collapse">
  <li><a href="#sec-pll-delta-sigma" id="toc-sec-pll-delta-sigma" class="nav-link" data-scroll-target="#sec-pll-delta-sigma"><span class="header-section-number">7.4.1</span> Delta-Sigma Modulator</a></li>
  <li><a href="#sec-pll-frac-n-implementation" id="toc-sec-pll-frac-n-implementation" class="nav-link" data-scroll-target="#sec-pll-frac-n-implementation"><span class="header-section-number">7.4.2</span> Fractional-N PLL Implementation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-poweramp" id="toc-sec-poweramp" class="nav-link" data-scroll-target="#sec-poweramp"><span class="header-section-number">8</span> Power Amplifiers</a>
  <ul class="collapse">
  <li><a href="#sec-poweramp-classes" id="toc-sec-poweramp-classes" class="nav-link" data-scroll-target="#sec-poweramp-classes"><span class="header-section-number">8.1</span> Amplifier Classes</a></li>
  <li><a href="#sec-poweramp-advanced" id="toc-sec-poweramp-advanced" class="nav-link" data-scroll-target="#sec-poweramp-advanced"><span class="header-section-number">8.2</span> PA Advanced Techniques</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="rfic.pdf"><i class="bi bi-file-pdf"></i>Typst</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Radio-Frequency Integrated Circuits</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Harald Pretl <a href="mailto:harald.pretl@jku.at" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-1519-076X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.jku.at/en/institute-for-integrated-circuits-and-quantum-computing">
            Johannes Kepler University
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="hidden">

</div>
<section id="sec-intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This is the material for an introductory radio-frequency integrated circuits course. The contents are largely based on <span class="citation" data-cites="Razavi_RFIC">(<a href="#ref-Razavi_RFIC" role="doc-biblioref">Behzad Razavi 2011</a>)</span> and <span class="citation" data-cites="Darabi_RFIC">(<a href="#ref-Darabi_RFIC" role="doc-biblioref">Darabi 2020</a>)</span>; these two books are an excellent introduction into this topic and are highly recommended! For a general introduction into RF and microwave <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span> is a great read!</p>
<p>It is assumed that readers are familiar with the contents of this <a href="https://iic-jku.github.io/analog-circuit-design/analog_circuit_design.html">Analog Circuit Design</a> course.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>All course material (source code of this document, Jupyter notebooks for calculations, Xschem circuits, etc.) is made publicly available on GitHub (<a href="https://github.com/iic-jku/radio-frequency-integrated-circuits">follow this link</a>) and shared under the Apache-2.0 license.</p>
<p>Please feel free to submit <a href="https://github.com/iic-jku/radio-frequency-integrated-circuits/pulls">pull requests</a> to fix typos or add content! If you want to discuss something that is not clear, please <a href="https://github.com/iic-jku/radio-frequency-integrated-circuits/issues/new">open an issue</a>.</p>
<p>The production of this document would be impossible without these (and many more) great open-source software products: <code>VS Code</code>, <code>Quarto</code>, <code>Pandoc</code>, <code>LaTeX</code>, <code>Typst</code>, <code>Jupyter Notebook</code>, <code>Python</code>, <code>Xschem</code>, <code>ngspice</code>, <code>CACE</code>, <code>pygmid</code>, <code>schemdraw</code>, <code>Numpy</code>, <code>Scipy</code>, <code>Matplotlib</code>, <code>Pandas</code>, <code>Git</code>, <code>Docker</code>, <code>Ubuntu</code>, <code>Linux</code>, …</p>
</div>
</div>
<section id="sec-intro-wireless" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-intro-wireless"><span class="header-section-number">1.1</span> Wireless Transmission</h2>
<p>In wireless transmission, we usually want to transmit data via a transmitter (TX) and a connected antenna to a receiver (RX) using an electromagnetic (EM) wave. This arrangement is shown in <a href="#fig-simple-wireless-system" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div id="cell-fig-simple-wireless-system" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div id="fig-simple-wireless-system" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-simple-wireless-system-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-simple-wireless-system-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: The block diagram of a simple wireless system."><img src="rfic_files/figure-html/fig-simple-wireless-system-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simple-wireless-system-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The block diagram of a simple wireless system.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Unfortunately, wireless transmission is hard. The wireless channel, i.e., the usage of electromagnetic waves to transmit information from a transmitter to a receiver, while tremendously useful, unfortunately has quite a few undesired features:</p>
<ul>
<li>The wireless channel is shared between all users.</li>
<li>As a consequence, the available bandwidth is shared; this means that bandwidth is a scarce resource.</li>
<li>The wireless channel has significant losses.</li>
<li>The channel is time variant, as usually the transmitter and/or the receiver move, and/or the environment changes.</li>
</ul>
<p>In order to estimate the power <span class="math inline">\(P_\mathrm{R}\)</span> of the wireless transmission at the receiver we can use Friis’ transmission formula <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span>:</p>
<p><span id="eq-friis-transmission"><span class="math display">\[
P_\mathrm{R} = \frac{P_\mathrm{T}}{4 \pi d^2} \cdot A_\mathrm{R} = P_\mathrm{T} \cdot \frac{A_\mathrm{R} \cdot A_\mathrm{T}}{d^2 \lambda^2}
\tag{1}\]</span></span></p>
<p>Here, <span class="math inline">\(A_\mathrm{R}\)</span> (and <span class="math inline">\(A_\mathrm{T}\)</span>) is the effective area of the receive/transmit antenna, while <span class="math inline">\(d\)</span> is the distance (line of sight) between the two antennas. The effective area of an antenna depends on the type and construction, but generally we can say that</p>
<p><span class="math display">\[
A \propto \lambda^2
\]</span></p>
<p>For an isotropic antenna (a theoretical construct where the radiation is equal in all directions) <span class="math inline">\(A = \lambda^2 / (4 \pi)\)</span>, while for a <span class="math inline">\(\lambda/2\)</span>-dipole <span class="math inline">\(A = 0.13 \lambda^2\)</span>. Of course, the speed of light <span class="math inline">\(c\)</span> relates frequency <span class="math inline">\(f\)</span> and wavelength <span class="math inline">\(\lambda\)</span> of an electromagnetic wave by</p>
<p><span class="math display">\[
c = \lambda f.
\]</span></p>
<p>Generally speaking, the size of an electromagnetic antenna is proportional to the wavelength of the EM wave used for transmission. For many devices, we seek antennas on the order of a few centimeters, and this is why frequencies in the hundreds of MHz to GHz are so popular. <a href="#tbl-rf-applications" class="quarto-xref">Table&nbsp;1</a> lists a few typical applications and their frequency and wavelength.</p>
<div id="tbl-rf-applications" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rf-applications-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Typical RF applications with their operating frequencies and corresponding wavelengths
</figcaption>
<div aria-describedby="tbl-rf-applications-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Application</th>
<th>Frequency</th>
<th>Wavelength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FM Radio</td>
<td>88–108 MHz</td>
<td>2.8-3.4 m</td>
</tr>
<tr class="even">
<td style="text-align: left;">WiFi (lowband)</td>
<td>2.4 GHz</td>
<td>12.5 cm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WiFi (highband)</td>
<td>5 GHz</td>
<td>6 cm</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bluetooth</td>
<td>2.4 GHz</td>
<td>12.5 cm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cellular</td>
<td>0.6–5 GHz</td>
<td>6-50 cm</td>
</tr>
<tr class="even">
<td style="text-align: left;">GNSS</td>
<td>1.575 GHz</td>
<td>19 cm</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>As you can see in <a href="#tbl-rf-applications" class="quarto-xref">Table&nbsp;1</a> many of these antennas would not fit into the used device form factors, i.e., often we have to use electrically small antennas.</p>
<div id="nte-wavelength-calculation" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;1: Wavelength Calculation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s calculate the wavelength for a Bluetooth signal at 2.4 GHz. Given:</p>
<ul>
<li>Frequency <span class="math inline">\(f = 2.4\)</span> GHz <span class="math inline">\(= 2.4 \times 10^9\)</span> Hz<br>
</li>
<li>Speed of light <span class="math inline">\(c = 3 \times 10^8\)</span> m/s</li>
</ul>
<p>Using the relationship <span class="math inline">\(c = \lambda f\)</span>, we can solve for wavelength:</p>
<p><span class="math display">\[\lambda = \frac{c}{f} = \frac{3 \times 10^8 \text{ m/s}}{2.4 \times 10^9 \text{ Hz}} = 0.125 \text{ m} = 12.5 \text{ cm}\]</span></p>
<p>This means that a quarter-wavelength monopole antenna for 2.4 GHz Bluetooth would be approximately 3.1 cm long, which easily fits into most mobile devices.</p>
</div>
</div>
<p>In order to get a feeling for the attenuation experienced in wireless communication, we now calculate the following exemplary transmission. We will use the unit of dBm which is often used in RF design and is defined as</p>
<p><span id="eq-dbm"><span class="math display">\[
P|_\text{dBm} = 10 \cdot \log_{10} \left( \frac{P|_\text{W}}{1\,\text{mW}} \right)
\tag{2}\]</span></span></p>
<div id="nte-wireless-attenuation" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;2: Wireless Transmission
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use the following parameters:</p>
<ul>
<li>Transmit power <span class="math inline">\(P_\mathrm{T} = 1\)</span> W</li>
<li>Frequency <span class="math inline">\(f = 2.4\)</span> GHz</li>
<li>Communication distance <span class="math inline">\(d = 10\)</span> km</li>
<li>Using <span class="math inline">\(\lambda/2\)</span> dipoles on both ends</li>
</ul>
<p>Using <a href="#eq-friis-transmission" class="quarto-xref">Equation&nbsp;1</a> we calculate</p>
<p><span class="math display">\[
P_\mathrm{R} = P_\mathrm{T} \cdot \frac{0.13 \lambda^2 \cdot 0.13 \lambda^2}{d^2 \lambda^2} = P_\mathrm{T} \cdot 0.13^2 \left( \frac{\lambda}{d} \right)^2 =  2.64\,\text{pW} = -85.8\,\text{dBm}
\]</span></p>
<p>With the transmit power of 1 W = 30 dBm we have an attenuation of 116 dB! This is a very large number!</p>
</div>
</div>
<p>The loss we calculated in <a href="#nte-wireless-attenuation" class="quarto-xref">Note&nbsp;2</a> is called the free-space path loss (FSPL). It is the minimum loss we can expect in a wireless communication system. In reality, the situation is often even worse. The free-space path loss <span class="math inline">\(\text{FSPL}\)</span> (in dB) can be calculated as</p>
<p><span id="eq-fspl"><span class="math display">\[
\text{FSPL} = 20 \cdot \log_{10}(d / \text{m}) + 20 \cdot \log_{10}(f / \text{Hz}) + 20 \cdot \log_{10} \left( \frac{4\pi}{c} \text{m/s} \right).
\tag{3}\]</span></span></p>
<p><a href="#eq-fspl" class="quarto-xref">Equation&nbsp;3</a> can be readily derived from <a href="#eq-friis-transmission" class="quarto-xref">Equation&nbsp;1</a> and <a href="#eq-dbm" class="quarto-xref">Equation&nbsp;2</a> assuming isotropic antennas at transmitter and receiver. Using <a href="#eq-fspl" class="quarto-xref">Equation&nbsp;3</a> we can easily calculate the FSPL for different distances and frequencies. The results are shown in <a href="#fig-free-space-path-loss" class="quarto-xref">Figure&nbsp;2</a>. It should be noted that the FSPL increases by 20 dB per decade of distance and 20 dB per decade of frequency, making higher frequencies and longer distances very challenging.</p>
<div id="cell-fig-free-space-path-loss" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div id="fig-free-space-path-loss" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-free-space-path-loss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-free-space-path-loss-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Free space path loss vs.&nbsp;distance for different frequencies (1 GHz, 10 GHz, and 100 GHz)."><img src="rfic_files/figure-html/fig-free-space-path-loss-output-1.png" width="612" height="434" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-free-space-path-loss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Free space path loss vs.&nbsp;distance for different frequencies (1 GHz, 10 GHz, and 100 GHz).
</figcaption>
</figure>
</div>
</div>
</div>
<p>As dire as the situation of <a href="#fig-free-space-path-loss" class="quarto-xref">Figure&nbsp;2</a> already looks, this is not even all factors considered:</p>
<ul>
<li>The given attenuation is for line-of-sight paths; often, the attenuation is significantly higher than this due to blockage by buildings, mountains, rain, or foliage.</li>
<li>In the absence of a direct line-of-sight path, the EM wave is redirected by reflections, causing additional attenuation, and potential destructive interference by multi-path reception.</li>
</ul>
<p>The consequences of this are (among others):</p>
<ul>
<li>The transmitter needs to generate enough <strong>transmit power</strong> to overcome the transmission loss; this has to be done often with high <strong>efficiency</strong>, as the transmit device is battery operated or limited by cooling.</li>
<li>The receiver has to be able to process <strong>weak signals</strong>, i.e., the <strong>noise</strong> level of the signal processing has to be very low.</li>
<li>Often, the receive signal is very weak, while there are strong signals at other frequencies (i.e., other wireless transmitters are located close to the receiver). This means the receiver has to be able to process a weak signal while simultaneously tolerating <strong>large interfering signals</strong> (called blockers).</li>
<li>Since the frequency spectrum is shared among many users and wireless applications, the transmit information has to be packed efficiently into a <strong>small bandwidth</strong>.</li>
<li>Very often, wireless devices are battery-operated. This means transmit and receive functions have to be implemented using <strong>minimum power consumption</strong>.</li>
</ul>
<p>As stated in the beginning, designing wireless systems is hard.</p>
</section>
<section id="sec-intro-standards" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-intro-standards"><span class="header-section-number">1.2</span> Wireless Standards</h2>
<p>In order to allow communication between different devices, different operators, and different manufacturers, wireless communication is standardized. There are many different standards, each with its own characteristics. Wireless standards define every aspect of wireless communication, and can be documents with hundreds or thousands of pages. Here, we mainly focus on the radio-frequency and analog aspects of wireless standards. Summarized in <a href="#tbl-wireless-standards" class="quarto-xref">Table&nbsp;2</a> are a few popular wireless standards with their main characteristics.</p>
<div id="tbl-wireless-standards" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wireless-standards-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Comparison of wireless communication standards
</figcaption>
<div aria-describedby="tbl-wireless-standards-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 18%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Standard</th>
<th>GSM (2G)</th>
<th>WCDMA (3G)</th>
<th>LTE (4G)<br><strong>5G NR</strong></th>
<th>WiFi</th>
<th>Bluetooth</th>
<th>GNSS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Frequency range (MHz)</strong></td>
<td>850, 900, 1800, 1900</td>
<td>850, 900, 1700, 1900, 2100</td>
<td>Multiple bands 450…7100 <strong>(FR1)</strong>, <strong>24000…48000 (FR2)</strong></td>
<td>2400, 5000, 6000</td>
<td>2400</td>
<td>1500, 1200</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Modulation</strong></td>
<td>GMSK, 8PSK (EDGE)</td>
<td>QPSK (DL), BPSK (UL), 16QAM (HSPA), 64QAM (HSPA)</td>
<td>QPSK, 16QAM, 64QAM (DL+UL) 256QAM (DL<strong>+UL</strong>)</td>
<td>BPSK, QPSK, 16QAM, 64QAM, 256QAM, 1024QAM, 4096QAM</td>
<td>GFSK (m=0.28…0.35), <span class="math inline">\(\pi\)</span>/4-DQPSK, 8DPSK</td>
<td>BPSK, QPSK</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Transmission/ multiple access</strong></td>
<td>TDMA, FDMA</td>
<td>DS-CDMA</td>
<td>OFDMA (DL<strong>+UL</strong>), SC-FDMA/<strong>DFT-s-OFDM (UL)</strong></td>
<td>OFDM, CSMA/CA</td>
<td>FHSS</td>
<td>CDMA</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Duplex</strong></td>
<td>FDD</td>
<td>FDD</td>
<td>FDD, TDD</td>
<td>TDD</td>
<td>TDD</td>
<td>n/a</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Channel bandwidth</strong></td>
<td>200 kHz</td>
<td>5 MHz</td>
<td>1.4, 3, 5, 10, 15, 20, …, <strong>100 MHz (FR1), 400 MHz (FR2)</strong></td>
<td>10, 20, 40, 80, 160, 320 MHz</td>
<td>1 MHz</td>
<td>16…24 MHz</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Symbol rate</strong></td>
<td>270.833 ksym/s</td>
<td>3.84 Msym/s</td>
<td>15/<strong>30/60</strong> ksym/s</td>
<td>312.5 ksym/s</td>
<td>1 Msym/s</td>
<td>50 sym/s</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Pulse shaping</strong></td>
<td>Gaussian (BT=0.3)</td>
<td>Root Raised Cosine (<span class="math inline">\(\alpha\)</span>=0.22)</td>
<td>Rectangular</td>
<td>Rectangular</td>
<td>Gaussian (BT=0.5)</td>
<td>Rectangular</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Transmit power</strong></td>
<td>1…2 W</td>
<td>250 mW</td>
<td>200 mW (FDD), 400 mW (TDD)</td>
<td>100 mW</td>
<td>1…100 mW</td>
<td>n/a</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>PAR (UL)</strong></td>
<td>0 dB (GMSK), 3 dB (8PSK)</td>
<td>3…8 dB</td>
<td>6…8 dB</td>
<td>Up to 12 dB</td>
<td>0 dB (GFSK), 3 dB (8DPSK)</td>
<td>n/a</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>MIMO</strong></td>
<td>no</td>
<td>Not realized (DL 2x2)</td>
<td>DL 4x4 (up to 8x8)</td>
<td>2x2 (up to 8x8)</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Channel bond</strong></td>
<td>no</td>
<td>Up to 4x5 MHz</td>
<td>Up to 7x20/4x100 MHz</td>
<td>Up to 80+80+80+80 MHz</td>
<td>no</td>
<td>no</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>During this course, we will learn what these terms mean and how they impact the design of RF integrated circuits.</p>
<p>As you can see in <a href="#tbl-wireless-standards" class="quarto-xref">Table&nbsp;2</a>, since LTE (4G) and 5G NR, many additional bands have been defined in the sub-6 GHz range (FR1) and also in the mm-wave range (FR2, 24.25 to 52.6 GHz). This means that modern wireless devices have to support many different frequency bands, which makes the design of RF frontends even more challenging. A good overview of the different frequency bands is given here for <a href="https://www.sqimway.com/lte_band.php">LTE</a> and <a href="https://www.sqimway.com/nr_band.php">5G NR</a>.</p>
<p>RFIC design is a multidisciplinary field, requiring knowledge from various engineering domains, as shown in <a href="#fig-rf-design-multidisciplinary" class="quarto-xref">Figure&nbsp;3</a>. This makes RFIC design challenging, but also very interesting!</p>
<div id="cell-fig-rf-design-multidisciplinary" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div id="fig-rf-design-multidisciplinary" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rf-design-multidisciplinary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-rf-design-multidisciplinary-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: RF design as a multidisciplinary field requiring knowledge from various engineering domains (adapted from [@Razavi_RFIC])."><img src="rfic_files/figure-html/fig-rf-design-multidisciplinary-output-1.png" width="463" height="463" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rf-design-multidisciplinary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: RF design as a multidisciplinary field requiring knowledge from various engineering domains (adapted from <span class="citation" data-cites="Razavi_RFIC">(<a href="#ref-Razavi_RFIC" role="doc-biblioref">Behzad Razavi 2011</a>)</span>).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Further, RFIC design requires careful consideration of many different aspects, as shown in <a href="#fig-rf-design-considerations" class="quarto-xref">Figure&nbsp;4</a>. Many parameters are often tightly coupled, requiring careful trade-offs during the design process.</p>
<div id="cell-fig-rf-design-considerations" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div id="fig-rf-design-considerations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rf-design-considerations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-rf-design-considerations-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: RFIC require careful design considerations and trade-offs (adapted from [@Razavi_RFIC])."><img src="rfic_files/figure-html/fig-rf-design-considerations-output-1.png" width="389" height="389" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rf-design-considerations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: RFIC require careful design considerations and trade-offs (adapted from <span class="citation" data-cites="Razavi_RFIC">(<a href="#ref-Razavi_RFIC" role="doc-biblioref">Behzad Razavi 2011</a>)</span>).
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-fundamentals" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Fundamentals</h1>
<p>In this section, we will discuss a few important concepts which will be instrumental in the further study of RF circuits and systems. As signals in RF circuits and systems are often limited on the top end by linearity, and on the bottom end by noise, we will discuss these two topics in some detail.</p>
<section id="sec-channel-capacity" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-channel-capacity"><span class="header-section-number">2.1</span> Channel Capacity</h2>
<p>In <a href="#sec-intro" class="quarto-xref">Section&nbsp;1</a> we have already discussed the fact that we need to pack information into a minimum bandwidth, as the available spectrum is limited. To appreciate the limits of information transfer, we need to understand how much information can be transmitted over a given bandwidth. This limit is given by the <em>Shannon-Hartley theorem</em>, which gives the maximum data rate <span class="math inline">\(C\)</span> (in bit/s) that can be transmitted over a communication channel with bandwidth <span class="math inline">\(B\)</span> (in Hz) and signal-to-noise ratio <span class="math inline">\(\text{SNR}\)</span> (with linear units):</p>
<p><span id="eq-shannon-hartley"><span class="math display">\[
C = B \cdot \log_2(1 + \text{SNR})
\tag{4}\]</span></span></p>
<p>This formula gives us a theoretical upper limit on the data rate that can be achieved with a given bandwidth and SNR <em>under optimal conditions</em>. It is important to note that this limit is only achievable with ideal coding and modulation schemes, which are not practical in real-world systems. However, it provides a useful benchmark for evaluating the performance of communication systems.</p>
<div id="nte-channel-limit" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;3: Channel Capacity Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let us calculate the channel capacity for a system with a bandwidth of 2 MHz and an SNR of 7 dB (the BW and minimum SNR of Bluetooth LE for 1 Mbps). First, we need to convert the SNR from dB to linear units:</p>
<p><span class="math display">\[
\text{SNR} = 10^{{7}/{10}} \approx 5
\]</span></p>
<p>Now we can use <a href="#eq-shannon-hartley" class="quarto-xref">Equation&nbsp;4</a> to calculate the channel capacity:</p>
<p><span class="math display">\[
C = B \cdot \log_2(1 + \text{SNR}) = 2\,\text{MHz} \cdot \log_2(1 + 5) = 2\,\text{MHz} \cdot 2.585 \approx 5.2\,\text{Mbps}
\]</span></p>
<p>This sounds reasonable, as the user data rate for Bluetooth LE is 1 Mbps for the given SNR, which allows for quite some overhead for coding and protocols.</p>
</div>
</div>
</section>
<section id="sec-linearity" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-linearity"><span class="header-section-number">2.2</span> Linearity</h2>
<p>As we have already seen in <a href="#sec-intro-wireless" class="quarto-xref">Section&nbsp;1.1</a> the transmitter has to process large signals without distorting them, while the receiver has to process small signals in the presence of large signals. Both situations mean we need metrics and models to quantify and discuss linearity properties.</p>
<p>We are going to use a very simple, time-invariant model to study linearity, based on a Taylor polynomial.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Linearity and Time Invariance in RF Systems
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use time invariance to simplify the mathematics. In practice, many circuits and systems will show time variant behavior which leads to quite a few very interesting and important phenomena! A time-invariant nonlinear system is also called a “memoryless” system, as the output at time <span class="math inline">\(t\)</span> only depends on the input at time <span class="math inline">\(t\)</span>.</p>
<p>In contrast, a system with memory (i.e., time-variant) will have an output at time <span class="math inline">\(t\)</span> which depends on the input at time <span class="math inline">\(t\)</span> and also on past inputs (e.g., at times <span class="math inline">\(t - \Delta T\)</span>, <span class="math inline">\(t - 2 \Delta T\)</span>, etc.). Examples of systems with memory are filters, which have a frequency-dependent response, or power amplifiers with thermal memory effects.</p>
</div>
</div>
<p>We model a nonlinear circuit block with the following Taylor polynomial:</p>
<p><span id="eq-nonlinear-model"><span class="math display">\[
y(t) = \alpha_0 + \alpha_1 x(t) + \alpha_2 x(t)^2 + \alpha_3 x(t)^3 + \ldots
\tag{5}\]</span></span></p>
<p>Usually, the blocks under study will have higher order nonlinear terms but we often stop at 3rd order to keep things simple. For practical work, higher order terms should be included if necessary.</p>
<p>Which <span class="math inline">\(x(t)\)</span> should we use to study wireless systems? Often, the bandwidth <span class="math inline">\(f_\mathrm{BW}\)</span> of a transmit signal is much smaller than the center frequency <span class="math inline">\(f_0\)</span>, i.e., <span class="math inline">\(f_\mathrm{BW} \ll f_0\)</span>. In this case using a sinusoidal signal as a model is both simple to handle and approximately correct.</p>
<section id="sec-linearity-single" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-linearity-single"><span class="header-section-number">2.2.1</span> Single-Tone Linearity</h3>
<p>We thus set (with <span class="math inline">\(A\)</span> being the amplitude of the input signal and <span class="math inline">\(\omega = 2 \pi f\)</span> the angular frequency)</p>
<p><span class="math display">\[
x(t) = A \cos(\omega t)
\]</span></p>
<p>and insert it into <a href="#eq-nonlinear-model" class="quarto-xref">Equation&nbsp;5</a>. After some simple trigonometric manipulations we are at</p>
<p><span id="eq-linearity-single"><span class="math display">\[
\begin{split}
y(t) &amp;=
\underbrace{ \frac{1}{2} \alpha_2 A^2 }_\text{dc component}
+
\underbrace{ \left(\alpha_1 A + \frac{3}{4} \alpha_3 A^3 \right) \cos(\omega t) }_\text{fundamental} \\
&amp;+
\underbrace{ \frac{1}{2} \alpha_2 A^2 \cos(2 \omega t) }_\text{2nd harmonic}
+
\underbrace{ \frac{1}{4} \alpha_3 A^3 \cos(3 \omega t) }_\text{3rd harmonic}
\end{split}
\tag{6}\]</span></span></p>
<p>Looking at <a href="#eq-linearity-single" class="quarto-xref">Equation&nbsp;6</a> we can make a few interesting observations:</p>
<ul>
<li>Even-order nonlinearity (<span class="math inline">\(\alpha_2\)</span>) creates low-frequency components; it effectively adds frequency components related to the envelope <span class="math inline">\(A\)</span>. If <span class="math inline">\(A\)</span> is a constant then this results in a dc term; if <span class="math inline">\(A(t)\)</span> is time variant it will create a squared version of it at low frequencies.</li>
<li>The <span class="math inline">\(\alpha_1\)</span> term is the gain of the circuit block.</li>
<li>Odd-order nonlinearity (<span class="math inline">\(\alpha_3\)</span>) can impact the gain of the fundamental term passing through the block. Depending on the sign of <span class="math inline">\(\alpha_3\)</span> this can lead to gain contraction or expansion.</li>
<li>Even- and odd-order nonlinearities create additional frequency components, so-called harmonics of the fundamental frequency. These harmonics are often unwanted, as they are far outside the wanted transmission frequency range, and need to be minimized, by either
<ol type="1">
<li>use a lowpass filter to filter these harmonics, or</li>
<li>increase the linearity, i.e., make the <span class="math inline">\(\alpha_2\)</span>, <span class="math inline">\(\alpha_3\)</span>, etc., small enough.</li>
</ol></li>
</ul>
<p>The created harmonics are illustrated in <a href="#fig-harmonics" class="quarto-xref">Figure&nbsp;5</a>. Note that measuring harmonics to quantify the nonlinearity metrics like <span class="math inline">\(\alpha_2\)</span> and <span class="math inline">\(\alpha_3\)</span> is often not very accurate, as these harmonics are often filtered in bandwidth-limited systems.</p>
<div id="cell-fig-harmonics" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div id="fig-harmonics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-harmonics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-harmonics-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;5: Single-tone test showing created harmonics at 2ω and 3ω."><img src="rfic_files/figure-html/fig-harmonics-output-1.png" width="589" height="434" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-harmonics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Single-tone test showing created harmonics at 2ω and 3ω.
</figcaption>
</figure>
</div>
</div>
</div>
<p>How can we quantify the nonlinearity with a one-tone test? We can sweep the input signal <span class="math inline">\(x(t)\)</span> in amplitude, and observe the output <span class="math inline">\(y(t)\)</span>. If the observed gain drops by 1 dB from the small-signal value we note the input power, and call this point the <strong>1dB compression point</strong> (<span class="math inline">\(P_\mathrm{1dB}\)</span>). We should always add whether this 1dB compression point is input- or output-referred to avoid ambiguity. The diagram in <a href="#fig-1db-compression-point" class="quarto-xref">Figure&nbsp;6</a> shows this test (<span class="math inline">\(\alpha_1 = 100\)</span>, <span class="math inline">\(\alpha_3 = -0.2\)</span>).</p>
<div id="cell-fig-1db-compression-point" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div id="fig-1db-compression-point" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-1db-compression-point-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-1db-compression-point-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;6: 1dB compression point test showing input vs output power relationship and the definition of P1dB."><img src="rfic_files/figure-html/fig-1db-compression-point-output-1.png" width="600" height="434" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1db-compression-point-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: 1dB compression point test showing input vs output power relationship and the definition of P1dB.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Compressive vs.&nbsp;Expansive Behavior
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that for compressive behaviour, <span class="math inline">\(\alpha_3\)</span> and <span class="math inline">\(\alpha_1\)</span> have different signs, while for expansive behaviour, they have the same sign.</p>
<p>At some point, every circuit block will show compressive behavior, as the maximum signal amplitude will be limited by power supply voltages, device breakdown voltages, etc.</p>
</div>
</div>
</section>
<section id="multi-tone-linearity" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="multi-tone-linearity"><span class="header-section-number">2.2.2</span> Multi-Tone Linearity</h3>
<p>We now elevate our investigations and apply two sinusoids with different frequencies and different amplitudes and see which signals we get at the output of the nonlinear block. The two-tone test and resulting third-order intermodulation products (IM3) are illustrated in <a href="#fig-im3-tones" class="quarto-xref">Figure&nbsp;7</a>.</p>
<p><span class="math display">\[
x(t) = A_1 \cos(\omega_1 t) + A_2 \cos(\omega_2 t)
\]</span></p>
<p>We apply the above stimulus to our nonlinear model described by <a href="#eq-nonlinear-model" class="quarto-xref">Equation&nbsp;5</a> and again, after some trigonometric manipulations, arrive at:</p>
<p><span id="eq-linearity-double"><span class="math display">\[
y(t) = y'(t) + y''(t) + y'''(t)
\tag{7}\]</span></span></p>
<p>As many different frequency components are created by this simple two-tone test (and nonlinearity only up to 3rd order) we split the result into different equations and look at the result separately.</p>
<p>First, we start with the fundamental tones:</p>
<p><span id="eq-linearity-double-a"><span class="math display">\[
\begin{split}
    y'(t) &amp;= \left( \underbrace{\alpha_1 A_1 + \frac{3}{4} \alpha_3 A_1^3}_\text{compression/expansion} + \underbrace{\frac{3}{2} \alpha_3 A_1 A_2^2}_\text{cross-modulation/desens} \right) \cos(\omega_1 t) \\
    &amp;+ \left( \underbrace{\alpha_1 A_2 + \frac{3}{4} \alpha_3 A_2^3}_\text{compression/expansion} + \underbrace{\frac{3}{2} \alpha_3 A_2 A_1^2}_\text{cross-modulation/desens} \right) \cos(\omega_2 t)
\end{split}
\tag{8}\]</span></span></p>
<p>As shown in <a href="#eq-linearity-double-a" class="quarto-xref">Equation&nbsp;8</a>, interesting things happen:</p>
<ul>
<li>We (again) have the gain compression/expansion effect as already discussed in <a href="#sec-linearity-single" class="quarto-xref">Section&nbsp;2.2.1</a>.</li>
<li>In addition, we have <strong>cross-modulation</strong>, i.e., the envelope of one tone (e.g., <span class="math inline">\(A_2(t)\)</span> of the tone at <span class="math inline">\(\omega_2\)</span>) impacts the envelope of the other tone at <span class="math inline">\(\omega_1\)</span>. This can lead to unwanted signal distortion, even if there is a large frequency separation between <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span>!</li>
<li>Further, since the sign of <span class="math inline">\(\alpha_3\)</span> is usually opposite to <span class="math inline">\(\alpha_1\)</span>, this can also lead to <strong>desensitization</strong> (“desens”). If, for example, <span class="math inline">\(A_2 \gg A_1\)</span>, then there would be no compression due to the tone <span class="math inline">\(\omega_1\)</span> itself, however, the large tone at <span class="math inline">\(\omega_2\)</span> will lead to gain compression of the tone at <span class="math inline">\(\omega_1\)</span>; this effect is called desense.</li>
</ul>
<p>We now look at the next class of generated tones:</p>
<p><span id="eq-linearity-double-b"><span class="math display">\[
\begin{split}
    y''(t) &amp;= \frac{1}{2} \alpha_2 A_1^2 + \frac{1}{2} \alpha_2 A_2^2 \\
    &amp;+ \alpha_2 A_1 A_2 \cos[ (\omega_1 - \omega_2) t] \\
    &amp;+ \alpha_2 A_1 A_2 \cos[ (\omega_1 + \omega_2) t]
\end{split}
\tag{9}\]</span></span></p>
<p>As we can see in <a href="#eq-linearity-double-b" class="quarto-xref">Equation&nbsp;9</a> new tones are created (besides the low frequency components we already know from the single-tone test) at the sum and difference of <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span>. These new frequency components are called “<strong>intermodulation products of second order</strong>” (IM2). These tones are created by the even-order nonlinearity (<span class="math inline">\(\alpha_2\)</span>). These IM2 products are far away from the wanted tones, so are often not very problematic in amplifiers (but there can be exceptions!). However, they can be very problematic in frequency conversion blocks like mixers. We will come back to this point when discussing zero-IF receivers.</p>
<p>We now investigate the next couple of tones:</p>
<p><span id="eq-linearity-double-c"><span class="math display">\[
\begin{split}
    y'''(t) &amp;= \frac{3}{4} \alpha_3 A_1^2 A_2 \cos[(2 \omega_1 + \omega_2) t] \\
    &amp;+ \frac{3}{4} \alpha_3 A_1^2 A_2 \cos[(2 \omega_1 - \omega_2) t] \\
    &amp;+ \frac{3}{4} \alpha_3 A_1 A_2^2 \cos[(2 \omega_2 + \omega_1) t] \\
    &amp;+ \frac{3}{4} \alpha_3 A_1 A_2^2 \cos[(2 \omega_2 - \omega_1) t]
\end{split}
\tag{10}\]</span></span></p>
<p>The tones shown in <a href="#eq-linearity-double-c" class="quarto-xref">Equation&nbsp;10</a> are called “<strong>intermodulation products of third order</strong>” (IM3), and are caused by the odd nonlinearities (like <span class="math inline">\(\alpha_3\)</span>). While the IM3 tones located at <span class="math inline">\(2 \omega_1 + \omega_2\)</span> and <span class="math inline">\(\omega_1 + 2 \omega_2\)</span> are similar to the sum IM2 tone and far away from <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span>, the other two tones are concerning.</p>
<p>Expressing <span class="math inline">\(\Delta \omega = \omega_2 - \omega_1\)</span> (and assuming <span class="math inline">\(\omega_1 &lt; \omega_2\)</span>), the building law of <span class="math inline">\(2 \omega_1 - \omega_2 = \omega_1 - \Delta \omega\)</span> and <span class="math inline">\(2 \omega_2 - \omega_1 = \omega_2 + \Delta \omega\)</span> results in new tones right besides <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span>, with a frequency separation only defined by <span class="math inline">\(\Delta \omega\)</span>. This situation is illustrated in <a href="#fig-im3-tones" class="quarto-xref">Figure&nbsp;7</a>.</p>
<div id="cell-fig-im3-tones" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div id="fig-im3-tones" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-im3-tones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-im3-tones-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;7: Two-tone test showing fundamental frequencies ω₁, ω₂ and third-order intermodulation products (IM3) at 2ω₁-ω₂ and 2ω₂-ω₁."><img src="rfic_files/figure-html/fig-im3-tones-output-1.png" width="604" height="434" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-im3-tones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Two-tone test showing fundamental frequencies ω₁, ω₂ and third-order intermodulation products (IM3) at 2ω₁-ω₂ and 2ω₂-ω₁.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This close localization of the IM3 tones can also be utilized to characterize nonlinear performance. Using gain compression or harmonic generation (H3) it can be very difficult to extract nonlinearity of third order (<span class="math inline">\(\alpha_3\)</span>). However, using a two-tone test, the IM3 tones can be readily measured, even if the measured signal path shows a <strong>bandpass characteristic</strong>! As RF systems frequently employ bandpass filters to suppress out-of-band signals, this is a very important property of the two-tone test.</p>
<p>The resulting test is called a two-tone test yielding the third-order intercept point (IP3). This test is widely used in RF design to characterize the linearity of amplifiers, mixers, and complete transceiver systems. The power relationship between fundamental tones and IM3 products as a function of input power is shown in <a href="#fig-im3-power-sweep" class="quarto-xref">Figure&nbsp;8</a>.</p>
<div id="cell-fig-im3-power-sweep" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div id="fig-im3-power-sweep" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-im3-power-sweep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-im3-power-sweep-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;8: Two-tone IM3 test showing fundamental and IM3 product power vs.&nbsp;input power, with IP3 intercept point definition. Equal input power per tone is assumed."><img src="rfic_files/figure-html/fig-im3-power-sweep-output-1.png" width="604" height="434" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-im3-power-sweep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Two-tone IM3 test showing fundamental and IM3 product power vs.&nbsp;input power, with IP3 intercept point definition. Equal input power per tone is assumed.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that, as shown in <a href="#fig-im3-power-sweep" class="quarto-xref">Figure&nbsp;8</a>, the IM3 products rise with a slope of 3 dB/dB, i.e., if the input power is increased by 1 dB, the IM3 products increase by 3 dB. The fundamental tones rise with a slope of 1 dB/dB (as long as we are in the linear region). The IP3 point is defined as the intersection of the <strong>extrapolated</strong> linear lines of fundamental and IM3 products. As both lines have different slopes, this intersection point is usually far outside the actual operating range of the circuit block under test!</p>
<p>When calculating the IIP3 (input-referred IP3) we can use the following formula, assuming equal input power per tone. It is important to always check the slope of the IM3 products to ensure that we are indeed in the third-order region! If the input power per tone is <span class="math inline">\(P_\mathrm{in}\)</span> (in dBm) and the input-referred power of one IM3 tone is <span class="math inline">\(P_\mathrm{IM3}\)</span> (in dBm), then the input-referred IP3 is given by</p>
<p><span id="eq-iip3"><span class="math display">\[
\text{IIP3} = P_\mathrm{in} + \frac{P_\mathrm{in} - P_\mathrm{IM3}}{2}
\tag{11}\]</span></span></p>
<p>Further, for midly nonlinear systems (i.e., <span class="math inline">\(\alpha_3\)</span> is dominating), the IIP3 can be approximated from the 1dB compression point as</p>
<p><span id="eq-iip3-approx"><span class="math display">\[
\text{IIP3}|_\mathrm{dBm} \approx P_\mathrm{1dB}|_\mathrm{dBm} + 9.6\,\text{dB}.
\tag{12}\]</span></span></p>
<p>If we have two blocks which are cascaded, and we know the gain and IIP3 of both blocks, we can calculate the overall IIP3 of the cascade with the following approximation. An exact calculation is very involved, as the nonlinearities of the first block (and the resulting tones) will be processed by the second block, creating even more tones; this process escalates very quickly. However, for practical purposes, the following approximation is often sufficient:</p>
<p><span id="eq-iip3-cascade"><span class="math display">\[
\frac{1}{\text{IIP3}_\text{total}} \approx \frac{1}{\text{IIP3}_1} + \frac{G_1}{\text{IIP3}_2} + \frac{G_1 G_2}{\text{IIP3}_3}
\tag{13}\]</span></span></p>
<p>Here <span class="math inline">\(G_1\)</span> is the linear gain of the first block, and <span class="math inline">\(\text{IIP3}_1\)</span>, <span class="math inline">\(\text{IIP3}_2\)</span> are the input-referred IP3 of the first and second block, respectively. Note that all powers have to be in linear units (i.e., Watts) when using <a href="#eq-iip3-cascade" class="quarto-xref">Equation&nbsp;13</a>. An even more simplified version of <a href="#eq-iip3-cascade" class="quarto-xref">Equation&nbsp;13</a> can be used with all quantities given in dBm and dB, respectively:</p>
<p><span id="eq-iip3-cascade-simple"><span class="math display">\[
\text{IIP3}_\text{total} \approx \min \{  \text{IIP3}_1, \text{IIP3}_2 - G_1, \text{IIP3}_3 - G_1 - G_2 \}
\tag{14}\]</span></span></p>
<p>A typical RF system cascade with multiple blocks and their individual IIP3 contributions is shown in <a href="#fig-iip3-cascade" class="quarto-xref">Figure&nbsp;9</a>.</p>
<div id="cell-fig-iip3-cascade" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div id="fig-iip3-cascade" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iip3-cascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-iip3-cascade-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;9: Block cascade for IIP3 calculation showing multiple stages with gains and individual IIP3 values."><img src="rfic_files/figure-html/fig-iip3-cascade-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iip3-cascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Block cascade for IIP3 calculation showing multiple stages with gains and individual IIP3 values.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="nte-iip3-cascade" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;4: Simple IIP3 Cascade Calculation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s calculate the overall IIP3 of two cascaded blocks. The first block is a low-noise amplifier with an IIP3 of -10 dBm and a gain of 20 dB. The second block is a mixer that has a gain of 10 dB and an IIP3 of 5 dBm. What is the overall IIP3?</p>
<p>Using <a href="#eq-iip3-cascade-simple" class="quarto-xref">Equation&nbsp;14</a> we can quickly estimate:</p>
<p><span class="math display">\[
\text{IIP3}_\text{total} \approx \min \{ -10\,\text{dBm}, 5\,\text{dBm} - 20\,\text{dB} = -15\,\text{dBm} \} = -15\,\text{dBm}
\]</span></p>
<p>We see that the overall IIP3 is limited by the linearity of the second block, as the first block amplifies all signals (including blockers) by 20 dB before they reach the second block.</p>
</div>
</div>
</section>
</section>
<section id="sec-noise" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-noise"><span class="header-section-number">2.3</span> Noise</h2>
<p>Just as nonlinearity is a limiting factor for large signals, noise is the limiting factor for small signals. Noise is present in all electronic circuits and systems, and it is impossible to avoid it. However, we can try to minimize its impact on system performance.</p>
<p>Noise is usually characterized by its power spectral density (PSD) in units of Watts per Hertz (W/Hz). For example, thermal noise at room temperature has a PSD of approximately <span class="math inline">\(k T = 4 \times 10^{-21}\)</span> W/Hz, or –174 dBm/Hz (with the Boltzmann constant <span class="math inline">\(k = 1.38 \times 10^{-23}\,\text{J/K}\)</span>). This means that if we have a bandwidth of 1 MHz, the total thermal noise power would be:</p>
<p><span class="math display">\[
P_\mathrm{thermal} = \text{PSD} \cdot B = -174\,\text{dBm/Hz} + 10 \log_{10} \left( \frac{1\,\text{MHz}}{1\,\text{Hz}} \right) = -114\,\text{dBm}
\]</span></p>
<p>The PSD of noise can be flat vs.&nbsp;frequency (which is called “white noise”), or can decrease with frequency (e.g., “flicker noise” or “1/f noise”). Further, noise can be generated by resistors (thermal noise), semiconductors (shot noise, generation-recombination noise), etc. A detailed discussion of noise sources can be found in <span class="citation" data-cites="Gray_Meyer_5th_ed">(<a href="#ref-Gray_Meyer_5th_ed" role="doc-biblioref">Gray et al. 2009</a>)</span> or <span class="citation" data-cites="Razavi_Analog_CMOS">(<a href="#ref-Razavi_Analog_CMOS" role="doc-biblioref">Behzad Razavi 2017</a>)</span>.</p>
<section id="sec-noise-types" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-noise-types"><span class="header-section-number">2.3.1</span> Types of Noise Generation</h3>
<p><strong>Resistors</strong> generate thermal noise, which is white noise with a PSD of <span class="math inline">\(4 k T R\)</span> (in V<span class="math inline">\(^2\)</span>/Hz) when looking at the voltage across the resistor, or <span class="math inline">\(4 k T / R\)</span> (in A<span class="math inline">\(^2\)</span>/Hz) when looking at the current through the resistor. This noise is generated by the random thermal motion of charge carriers in the resistor.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Thermal Noise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the simple approximation given above is only valid for reasonably high frequencies and typical temperatures, and is known as the Rayleigh-Jeans approximation of Planck’s blackbody radiation accounting for quantum effects and is given by <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span></p>
<p><span class="math display">\[
\text{PSD} = \frac{4 R h f}{e^{{h f}/{k T}} - 1}
\]</span></p>
<p>where <span class="math inline">\(h\)</span> is the Planck constant (<span class="math inline">\(h = 6.626 \times 10^{-34}\)</span> Js) and <span class="math inline">\(f\)</span> is the frequency. The Rayleigh-Jeans approximation is valid for <span class="math inline">\(f \ll k T / h\)</span>, which is approximately 6 THz at room temperature (290 K).</p>
<p>We can integrate the above PSD over the full frequency range and show the rms noise voltage of a resistor <span class="math inline">\(R\)</span> is bounded to</p>
<p><span class="math display">\[
\overline{v_\mathrm{n}^2} = \int_0^\infty \frac{4 R h f}{e^{{h f}/{k T}} - 1} df = \frac{2 (\pi k T)^2}{3 h} \cdot R
\]</span></p>
<p>which equates to approximately 13 mVrms noise voltage for a 1 k<span class="math inline">\(\Omega\)</span> resistor at room temperature (which is impossible to measure in practice, as there will be some form of bandwidth limitation in any real measurement setup).</p>
</div>
</div>
<p><strong>MOSFETs</strong> generate several types of noise, the most important ones being the thermal noise of the channel and flicker noise.</p>
<p>The thermal noise of the channel can be modeled as a current noise source between drain and source with a PSD of <span class="math inline">\(\overline{I_\mathrm{n}^2} = 4 k T \gamma g_{d0}\)</span> (in A<span class="math inline">\(^2\)</span>/Hz), where <span class="math inline">\(\gamma\)</span> is a process-dependent parameter (usually between 2/3 and 2). The parameter <span class="math inline">\(g_{d0}\)</span> is the small-signal output conductance of the MOSFET in triode, i.e., <span class="math inline">\(g_{d0} = g_\mathrm{ds}\)</span>, or equal to <span class="math inline">\(g_{d0} = g_\mathrm{m}\)</span> when in saturation.</p>
<p>In saturation, it is often useful to express the thermal noise as a voltage noise source at the gate with a PSD of <span class="math inline">\(\overline{V_\mathrm{n}^2} = 4 k T \gamma / g_\mathrm{m}\)</span> (in V<span class="math inline">\(^2\)</span>/Hz). We can see that we can lower this noise of the MOSFET by increasing the transconductance <span class="math inline">\(g_\mathrm{m}\)</span>, which can be achieved by increasing the bias current.</p>
<p>In addition, at high frequencies, the MOSFET also has induced gate-current noise, which is correlated with the channel thermal noise. A detailed discussion of this noise source can be found in <span class="citation" data-cites="Razavi_Analog_CMOS">(<a href="#ref-Razavi_Analog_CMOS" role="doc-biblioref">Behzad Razavi 2017</a>)</span>.</p>
<p>Flicker noise is usually modeled as a voltage noise source at the gate with a PSD of <span class="math inline">\(K_f / (C'_\mathrm{ox}W L f)\)</span> (in V<span class="math inline">\(^2\)</span>/Hz), where <span class="math inline">\(K_f\)</span> is a process-dependent parameter, <span class="math inline">\(C'_\mathrm{ox}\)</span> is the oxide capacitance per unit area, <span class="math inline">\(L\)</span> and <span class="math inline">\(W\)</span> are the length and width of the MOSFET, and <span class="math inline">\(f\)</span> is the frequency. Note that we can lower the flicker noise by increasing the area of the MOSFET (<span class="math inline">\(W L\)</span>), however, this increases the parasitic capacitances associated with the MOSFET, and this often prohibitive for RF operation!</p>
<p>In <strong>bipolar junction transistors (BJTs)</strong>, the most important noise source is the shot noise due to the diffusion current in the base-emitter junction. Its PSD can be modeled as a current noise source between collector and emitter with a PSD of <span class="math inline">\(2 q I_\mathrm{C}\)</span> (in A<span class="math inline">\(^2\)</span>/Hz), where <span class="math inline">\(q\)</span> is the elementary charge (<span class="math inline">\(q = 1.6 \times 10^{-19}\)</span> C) and <span class="math inline">\(I_\mathrm{C}\)</span> is the DC collector current.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Equivalence of Shot and Thermal Noise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that it has been shown in <span class="citation" data-cites="Sarpeshkar_1993">(<a href="#ref-Sarpeshkar_1993" role="doc-biblioref">Sarpeshkar, Delbruck, and Mead 1993</a>)</span> that thermal noise and shot noise are actually equivalent, as both are generated by the random, thermally agitated motion of charge carriers!</p>
</div>
</div>
<p>Ideal <strong>capacitors</strong> and <strong>inductors</strong> do not generate noise, however, real capacitors and inductors have parasitic resistances which generate thermal noise.</p>
<p>In RF systems additional noise sources can be present. One noteworthy example is the <a href="https://en.wikipedia.org/wiki/Cosmic_microwave_background"><strong>cosmic microwave background</strong></a> radiation, which can be modeled as a noise temperature of approximately 3 K. While this is negligible compared to thermal noise at room temperature (approximately 290 K), it can be significant in very low-noise systems, such as radio telescopes pointing to the sky. Another important noise source in RF systems is the <strong>atmospheric noise</strong>, which is generated by natural phenomena like lightning or in the ionosphere.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>A Note on Circuit Noise Calculations
</div>
</div>
<div class="callout-body-container callout-body">
<p>When doing circuit noise calculations, it is instructive to keep the following points in mind:</p>
<ul>
<li>For circuit calculations involving noise sources it is convenient to replace the power spectral density by equivalent sinusoidal generators in small bandwidths.</li>
<li>The noise power spectral density in a small bandwidth <span class="math inline">\(\Delta f\)</span> is given by <span class="math inline">\(\overline{V_\mathrm{n}^2} = \overline{v_\mathrm{n}^2} / \Delta f\)</span> and <span class="math inline">\(\overline{I_\mathrm{n}^2} = \overline{i_\mathrm{n}^2} / \Delta f\)</span>.</li>
<li>The quantities <span class="math inline">\(\overline{V_\mathrm{n}^2}\)</span> and <span class="math inline">\(\overline{I_\mathrm{n}^2}\)</span> can be considered the mean-square value of sinusoidal generators. Using these values, network noise calculations reduce to familiar sinusoidal circuit-analysis calculations using <span class="math inline">\(V_\mathrm{n}\)</span> and <span class="math inline">\(I_\mathrm{n}\)</span>.</li>
<li>Multiple <em>independent</em> noise sources can be calculated individually at the output, and the total noise in bandwidth <span class="math inline">\(\Delta f\)</span> is calculated as a mean-square value by adding the individual mean-square contributions from each sinusoid.</li>
</ul>
</div>
</div>
</section>
<section id="noise-in-impedance-matched-systems" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="noise-in-impedance-matched-systems"><span class="header-section-number">2.3.2</span> Noise in Impedance-Matched Systems</h3>
<p>We now want to calculate the maximum noise power that can be extracted from a noisy source. We assume the following situation as shown in <a href="#fig-noise-matched-system" class="quarto-xref">Figure&nbsp;10</a>. Note that the voltage source <span class="math inline">\(\overline{V_\mathrm{n,s}^2}\)</span> models the thermal noise of the source resistor <span class="math inline">\(R_\mathrm{s}\)</span> resulting in a Thevenin equivalent circuit.</p>
<div id="cell-fig-noise-matched-system" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div id="fig-noise-matched-system" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-noise-matched-system-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-noise-matched-system-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;10: A noise-matched system with source and load impedances."><img src="rfic_files/figure-html/fig-noise-matched-system-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-noise-matched-system-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: A noise-matched system with source and load impedances.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We know that the noise of the source resistor is given by <span class="math inline">\(\overline{V_\mathrm{n,s}^2} = 4 k T R_\mathrm{s}\)</span>. We assume the load resistor <span class="math inline">\(R_\mathrm{load}\)</span> as noiseless and matched to the source resistor, i.e., <span class="math inline">\(R_\mathrm{load} = R_\mathrm{s}\)</span> for <a href="https://en.wikipedia.org/wiki/Maximum_power_transfer_theorem">maximum power transfer</a>. The noise power spectral density delivered to the load resistor is then given by</p>
<p><span id="eq-noise-power-matched"><span class="math display">\[
P_\mathrm{n,load} = \frac{\overline{V_\mathrm{n,load}^2}}{R_\mathrm{load}} = \frac{\overline{V_\mathrm{n,d}^2}}{4 R_\mathrm{s}} = k T
\tag{15}\]</span></span></p>
<p>The calculation of <a href="#eq-noise-power-matched" class="quarto-xref">Equation&nbsp;15</a> confirms the initial statement that the maximum noise power spectral density that can be extracted from a noisy source is <span class="math inline">\(k T\)</span> (in W/Hz). This result is independent of the actual value of the source resistance <span class="math inline">\(R_\mathrm{s}\)</span>.</p>
<p>We can further generalize the thermal noise of any impedance as</p>
<p><span id="eq-thermal-noise-impedance"><span class="math display">\[
\overline{V_\mathrm{n}^2} = 4 k T \Re \{ Z \}
\tag{16}\]</span></span></p>
<p>as for example in the complex impedance <span class="math inline">\(Z_\mathrm{ant}\)</span> of an antenna. Since an antenna is a reciprocal device, if we measure its radiation impedance <span class="math inline">\(Z_\mathrm{rad}\)</span> (for example with a vector network analyzer), we can calculate its thermal noise with <a href="#eq-thermal-noise-impedance" class="quarto-xref">Equation&nbsp;16</a> to <span class="math inline">\(\overline{V_\mathrm{n}^2} = 4 k T \Re \{ Z_\mathrm{rad} \}\)</span>.</p>
</section>
<section id="sec-noise-figure" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-noise-figure"><span class="header-section-number">2.3.3</span> Noise Figure</h3>
<p>In RF systems, we often want to quantify the noise performance of a circuit block or a complete system. The most widely used metric is the <strong>noise factor (F)</strong>, which is defined as the ratio of the signal-to-noise ratio (SNR) at the input to the SNR at the output of a circuit block or system. If we express the noise factor in dB, we call it the <strong>noise figure (NF)</strong> <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span>. The noise factor is given by</p>
<p><span id="eq-noise-figure"><span class="math display">\[
F = \frac{\text{SNR}_\mathrm{in}}{\text{SNR}_\mathrm{out}} = \frac{(P_\mathrm{s}/P_\mathrm{n})_\mathrm{in}}{(P_\mathrm{s}/P_\mathrm{n})_\mathrm{out}}
\tag{17}\]</span></span></p>
<p>where <span class="math inline">\(P_\mathrm{s}\)</span> is the signal power and <span class="math inline">\(P_\mathrm{n}\)</span> is the noise power. The noise factor is always larger than or equal to 1 (or 0 dB), as no circuit can improve the SNR!</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>SNR Improvement
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the SNR can be improved by filtering, as filtering reduces the noise power. If the noise bandwidth is larger than the signal bandwidth, then the SNR can be improved without affecting the signal. However, this is not considered in the noise factor, as the noise factor assumes that both signal and noise pass through the same bandwidth.</p>
</div>
</div>
<p>Let us look at a simple model of a noise circuit block as shown in <a href="#fig-noise-block" class="quarto-xref">Figure&nbsp;11</a>. The input signal <span class="math inline">\(S_\mathrm{in}\)</span> is accompanied by noise <span class="math inline">\(N_\mathrm{in}\)</span>. By definition it is assumed that the input noise power results from a matched resistor at <span class="math inline">\(T_0 = 290\,\text{K}\)</span>, so that <span class="math inline">\(N_\mathrm{in} = k T_0\)</span>. The circuit block has a power gain <span class="math inline">\(G\)</span> and adds its own noise <span class="math inline">\(N_\mathrm{dut}\)</span> to the output signal. For simplicity, we assume that the input and output of the circuit block are <strong>impedance matched</strong> to avoid reflections.</p>
<div id="cell-fig-noise-block" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div id="fig-noise-block" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-noise-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-noise-block-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;11: A noise-matched system with source and load impedances and a noisy circuit block."><img src="rfic_files/figure-html/fig-noise-block-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-noise-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: A noise-matched system with source and load impedances and a noisy circuit block.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The output signal and noise powers are then given by</p>
<p><span class="math display">\[
S_\mathrm{out} = G S_\mathrm{in}
\]</span></p>
<p><span class="math display">\[
N_\mathrm{out} = G N_\mathrm{in} + N_\mathrm{dut}
\]</span> The resulting noise factor can then be calculated as</p>
<p><span class="math display">\[
F = \frac{{S_\mathrm{in}}/{N_\mathrm{in}}}{{S_\mathrm{out}}/{N_\mathrm{out}}} = \frac{1}{G} \frac{G N_\mathrm{in} + N_\mathrm{dut}}{N_\mathrm{in}} = 1 + \frac{N_\mathrm{dut}}{G N_\mathrm{in}},
\]</span></p>
<p>in other words, the noise factor is 1 plus the ratio of the noise added by the device under test (DUT) to the amplified input noise.</p>
<p>Note that a noiseless block (<span class="math inline">\(N_\mathrm{dut} = 0\)</span>) has a noise factor of <span class="math inline">\(F=1\)</span>. A passive block with loss factor <span class="math inline">\(L\)</span> (and impedance matched at input and output) has a noise factor of <span class="math inline">\(F=L\)</span> (in linear units), as it attenuates the signal and <span class="math inline">\(N_\mathrm{out} = N_\mathrm{in} = k T\)</span> if everything is in thermal equilibrium.</p>
<div id="cell-fig-noise-cascade" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div id="fig-noise-cascade" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-noise-cascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-noise-cascade-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;12: Block cascade for noise factor calculation showing multiple stages with gains and individual noise factors."><img src="rfic_files/figure-html/fig-noise-cascade-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-noise-cascade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Block cascade for noise factor calculation showing multiple stages with gains and individual noise factors.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we have a cascade of multiple blocks, as shown in <a href="#fig-noise-cascade" class="quarto-xref">Figure&nbsp;12</a>, we can calculate the overall noise factor with the <strong>Friis formula</strong> <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span></p>
<p><span id="eq-friis"><span class="math display">\[
F_\mathrm{total} = 1 + (F_1 - 1) + \frac{F_2 - 1}{G_1} + \frac{F_3 - 1}{G_1 G_2}
\tag{18}\]</span></span></p>
<p>where <span class="math inline">\(F_i\)</span> and <span class="math inline">\(G_i\)</span> are the noise factor and power gain of the <span class="math inline">\(i\)</span>-th block, respectively. Note that all gains have to be in linear units (not dB) when using <a href="#eq-friis" class="quarto-xref">Equation&nbsp;18</a>. We can interpret <a href="#eq-friis" class="quarto-xref">Equation&nbsp;18</a> as follows:</p>
<ul>
<li>The overall noise factor <span class="math inline">\(F_\mathrm{total}\)</span> is always larger than or equal to the noise factor of the first block (<span class="math inline">\(F_1\)</span>).</li>
<li>The noise factor of the first block is the most important one, as the noise factors of the following blocks are reduced by the gain of all preceding blocks. This is especially important in RF receivers, where the first block is usually a low-noise amplifier (LNA) with a very low noise figure (e.g., 1 dB or less) and a high gain (e.g., 10 dB or more). This ensures that the noise of the following blocks is negligible.</li>
<li>The noise factor of the last block is reduced by the gain of all preceding blocks, so it is usually not very important.</li>
</ul>
<p>Here we also see a trade-off between noise and linearity, as shown by <a href="#eq-iip3-cascade" class="quarto-xref">Equation&nbsp;13</a> and <a href="#eq-friis" class="quarto-xref">Equation&nbsp;18</a>. For low noise, we should try to maximize <span class="math inline">\(G_1\)</span>, however, this will affect linearity (IIP3) in a negative way. As in many other situation in RF design, we have to find a good compromise between conflicting requirements.</p>
</section>
<section id="sec-sensitivity" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="sec-sensitivity"><span class="header-section-number">2.3.4</span> Sensitivity</h3>
<p>In RF receivers, we often want to know the minimum input signal power that can be detected with a certain SNR. This minimum input signal power is called the <strong>sensitivity</strong> of the receiver. The sensitivity can be calculated as</p>
<p><span id="eq-sensitivity"><span class="math display">\[
P_\mathrm{in, min} = P_\mathrm{n} \cdot \text{SNR}_\mathrm{min} \cdot F
\tag{19}\]</span></span></p>
<p>where <span class="math inline">\(P_\mathrm{n}\)</span> is the noise power at the input, <span class="math inline">\(\text{SNR}_\mathrm{min}\)</span> is the minimum detectable SNR, and <span class="math inline">\(F\)</span> is the noise factor of the receiver. The input noise power can be calculated as</p>
<p><span class="math display">\[
P_\mathrm{n} = k T B
\]</span></p>
<p>where <span class="math inline">\(k\)</span> is the Boltzmann constant, <span class="math inline">\(T\)</span> is the temperature in Kelvin, and <span class="math inline">\(B\)</span> is the bandwidth of the receiver. Expressing <a href="#eq-sensitivity" class="quarto-xref">Equation&nbsp;19</a> in dBm we get the following formula:</p>
<p><span id="eq-sensitivity-dbm"><span class="math display">\[
P_\mathrm{in, min}|_\mathrm{dBm} = -174\,\text{dBm/Hz} + \text{NF} + 10 \log_{10}(B/\text{Hz}) + \text{SNR}_\mathrm{min}|_\mathrm{dB}
\tag{20}\]</span></span></p>
<p>where -174 dBm/Hz is the thermal noise PSD at room temperature (290 K). We can see that the sensitivity improves with lower noise figure, smaller bandwidth, and lower minimum detectable SNR.</p>
<div id="nte-wifi-sensitivity" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;5: Sensitivity Calculation for WiFi
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s calculate the sensitivity of a WiFi receiver operating at 5 GHz with a bandwidth of <span class="math inline">\(B = 80\,\text{MHz}\)</span>, a noise figure of <span class="math inline">\(NF = 7\,\text{dB}\)</span>, and a minimum detectable SNR of 25 dB. This high SNR means that a high-order modulation scheme (like 64-QAM) is used for high data rates.</p>
<p>Using <a href="#eq-sensitivity-dbm" class="quarto-xref">Equation&nbsp;20</a> we get: <span class="math display">\[
P_\mathrm{in, min} = -174\,\text{dBm/Hz} + 7\,\text{dB} + 10 \log_{10} (80 \times 10^6) + 25\,\text{dB} \approx -63\,\text{dBm}
\]</span></p>
<p>This means that the minimum input signal power that can be detected by the WiFi receiver is approximately -63 dBm.</p>
</div>
</div>
</section>
</section>
<section id="sec-fundamentals-modulation" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-fundamentals-modulation"><span class="header-section-number">2.4</span> Modulation</h2>
<p>In order to transmit information via an EM wave, we need to modulate the EM wave with the information signal. Looking at a simple sinusoidal carrier wave</p>
<p><span class="math display">\[
s(t) = A \cos(\omega_0 t + \varphi)
\]</span></p>
<p>we see that we can change one or more of the following parameters to encode information:</p>
<ul>
<li>Amplitude <span class="math inline">\(A(t)\)</span> (amplitude modulation, AM; the digital form is called amplitude-shift keying, <strong>ASK</strong>)</li>
<li>Frequency <span class="math inline">\(\omega_0(t)\)</span> (frequency modulation, FM; the digital form is called frequency-shift keying, <strong>FSK</strong>)</li>
<li>Phase <span class="math inline">\(\varphi(t)\)</span> (phase modulation, PM; the digital form is called phase-shift keying, <strong>PSK</strong>)</li>
<li>Amplitude <span class="math inline">\(A(t)\)</span> and phase <span class="math inline">\(\varphi(t)\)</span> (quadrature amplitude modulation, <strong>QAM</strong>)</li>
</ul>
<p>The modulation formats FM and PM have the advantage that the carrier amplitude is constant, which makes them more robust against nonlinear distortion.</p>
<p>QAM is widely used in modern communication systems, as it allows to transmit more bits per symbol by combining amplitude and phase modulation. The form with 4 different symbols is called QPSK. Higher-order modulation like 16-QAM, for example, uses 16 different symbols, which can encode 4 bits per symbol (as <span class="math inline">\(2^4 = 16\)</span>). Even higher-order QAM formats like 64-QAM (6 bits per symbol), 256-QAM (8 bits per symbol), 1024-QAM (10 bits per symbol), or 4096-QAM (12 bits per symbol) are also used in modern systems like WiFi or LTE.</p>
<div id="cell-fig-16qam-constellation" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div id="fig-16qam-constellation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16qam-constellation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-16qam-constellation-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;13: 16-QAM constellation diagram with Gray code labeling of constellation points."><img src="rfic_files/figure-html/fig-16qam-constellation-output-1.png" width="543" height="472" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16qam-constellation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: 16-QAM constellation diagram with Gray code labeling of constellation points.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Shown in <a href="#fig-16qam-constellation" class="quarto-xref">Figure&nbsp;13</a> is the “constellation diagram” of a 16-QAM modulation format. The constellation points are arranged in a square grid, with each point representing a unique combination of amplitude and phase. The distance between the constellation points determines the robustness against noise and interference; larger distances result in better performance, but also require more bandwidth. The mapping of bits to constellation points is called “bit mapping” or “symbol mapping”. The example in <a href="#fig-16qam-constellation" class="quarto-xref">Figure&nbsp;13</a> uses a Gray code mapping, which minimizes the number of bit errors in case of a symbol error.</p>
<p>The constellation diagram can be imagined as a complex plane, where the x-axis represents the in-phase component (I) and the y-axis represents the quadrature component (Q) of the modulated signal. During transmission of a specific symbol, the RF carrier is modulated to the corresponding amplitude and phase, resulting in a specific point in the constellation diagram. In <a href="#fig-16qam-constellation" class="quarto-xref">Figure&nbsp;13</a>, the amplitude and phase information for two consecutive symbols, <span class="math inline">\(A_i\)</span>/<span class="math inline">\(\varphi_i\)</span> and <span class="math inline">\(A_{i+1}\)</span>/<span class="math inline">\(\varphi_{i+1}\)</span>, is shown. If we have a bitrate with a bit duration of <span class="math inline">\(T_\mathrm{b}\)</span>, the symbol duration for 16-QAM (4 bits per symbol) is <span class="math inline">\(T_\mathrm{s} = 4 T_\mathrm{b}\)</span>. During the first <span class="math inline">\(T_\mathrm{s}\)</span>, the carrier is modulated to <span class="math inline">\(A_i\)</span>/<span class="math inline">\(\varphi_i\)</span>, and during the next <span class="math inline">\(T_\mathrm{s}\)</span>, it is modulated to <span class="math inline">\(A_{i+1}\)</span>/<span class="math inline">\(\varphi_{i+1}\)</span>.</p>
<p>The table below shows the <strong>SNR requirements for different modulation formats</strong> to achieve a bit error rate (BER) of <span class="math inline">\(10^{-5}\)</span> in an additive white Gaussian noise (AWGN) channel. As we can see, higher-order modulation formats require higher SNR to achieve the same BER. Note that for the SNR values of this table <strong>no error correction coding</strong> is assumed; with error correction coding the required SNR can be significantly reduced!</p>
<div id="tbl-modulation-snr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-modulation-snr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: SNR requirements for different modulation schemes to achieve BER = <span class="math inline">\(10^{-5}\)</span> in AWGN channel
</figcaption>
<div aria-describedby="tbl-modulation-snr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Modulation</th>
<th>Bits/Symbol</th>
<th>Required SNR (dB)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BPSK</td>
<td>1</td>
<td>9.6</td>
</tr>
<tr class="even">
<td>QPSK</td>
<td>2</td>
<td>12.6</td>
</tr>
<tr class="odd">
<td>16-QAM</td>
<td>4</td>
<td>18.2</td>
</tr>
<tr class="even">
<td>64-QAM</td>
<td>6</td>
<td>24.4</td>
</tr>
<tr class="odd">
<td>256-QAM</td>
<td>8</td>
<td>30.6</td>
</tr>
<tr class="even">
<td>1024-QAM</td>
<td>10</td>
<td>36.9</td>
</tr>
<tr class="odd">
<td>4096-QAM</td>
<td>12</td>
<td>43.2</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="sec-fundamentals-pulse-shaping" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-fundamentals-pulse-shaping"><span class="header-section-number">2.5</span> Pulse Shaping and Spectral Efficiency</h2>
<p>When we modulate symbols onto a carrier, we usually do not transmit the symbols as pure sinusoids, but rather as pulses with a certain shape. The pulse shape determines the bandwidth of the transmitted signal and its spectral efficiency. A common pulse shape is the <strong>rectangular pulse</strong>, which has a sinc-shaped spectrum. However, the sinc function <span class="math inline">\(\sin(\pi x)/ \pi x\)</span> has side lobes that extend to infinity, which can cause interference with adjacent channels.</p>
<p>For reference, the spectrum of a random binary sequence with equal probability of 0s and 1s, using rectangular pulses with a duration of <span class="math inline">\(T_\mathrm{b}\)</span> is given by (<span class="math inline">\(S(f)\)</span> is the two-sided power spectral density):</p>
<p><span class="math display">\[
S(f) = \frac{T_\mathrm{b}}{4} \text{sinc}^2(fT_\mathrm{b}) + \frac{1}{4} \delta(f) = \frac{T_\mathrm{b}}{4} \left( \frac{\sin(\pi f T_\mathrm{b})}{\pi f T_\mathrm{b}} \right)^2 + \frac{1}{4} \delta(f)
\]</span></p>
<p>To avoid this, we can use pulse shapes that have better spectral properties, such as the raised cosine pulse or the root-raised cosine pulse. The <strong>raised-cosine pulse</strong> has a roll-off factor <span class="math inline">\(\alpha\)</span> that determines the excess bandwidth beyond the Nyquist bandwidth. The root-raised cosine (RRC) pulse is used in practical systems (with half the pulse filter implemented at the TX, and half at the RX), as it can be implemented with a matched filter at the receiver.</p>
<p>The raised-cosine pulse <span class="math inline">\(p(t)\)</span> (with a spectrum shaped like a raised cosine) is given by:</p>
<p><span class="math display">\[
p(t) = \frac{\sin(\pi t / T_\mathrm{b})}{\pi t / T_\mathrm{b}} \cdot \frac{\cos(\alpha \pi t / T_\mathrm{b})}{1 - (2 \alpha t / T_\mathrm{b})^2}
\]</span></p>
<p>Setting <span class="math inline">\(\alpha = 0\)</span> results in a sinc pulse in the time domain (with a perfect bandwidth containment in the frequency domain), while <span class="math inline">\(\alpha = 1\)</span> results in a pulse with double the Nyquist bandwidth. The pulse shape for <span class="math inline">\(\alpha = 0\)</span> and <span class="math inline">\(\alpha = 0.22\)</span> (used in 3G) is shown in <a href="#fig-raised-cosine-pulse" class="quarto-xref">Figure&nbsp;14</a>.</p>
<div id="cell-fig-raised-cosine-pulse" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div id="fig-raised-cosine-pulse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-raised-cosine-pulse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-raised-cosine-pulse-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;14: Raised cosine pulse shaping in time and frequency domain for different roll-off factors α."><img src="rfic_files/figure-html/fig-raised-cosine-pulse-output-1.png" width="758" height="470" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-raised-cosine-pulse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Raised cosine pulse shaping in time and frequency domain for different roll-off factors α.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Another often-used pulse shape is the <strong>Gaussian pulse</strong>, which is used in Gaussian minimum-shift keying (<strong>GMSK</strong>, used in 2G) modulation, or in Gaussian frequency-shift keying (<strong>GFSK</strong>, used in Bluetooth). The Gaussian pulse has a smooth shape and a narrow spectrum. The Gaussian pulse is given by:</p>
<p><span class="math display">\[
p(t) = \frac{\sqrt{\pi}}{\alpha} e^{-(\pi t / \alpha)^2} \quad \text{with} \quad \alpha = \frac{\sqrt{\ln 2}}{\sqrt{2}} \cdot \frac{T_\mathrm{b}}{B T_\mathrm{b}}
\]</span></p>
<p>where <span class="math inline">\(B T_\mathrm{b}\)</span> controls the width of the pulse. The spectrum of the Gaussian pulse is also Gaussian-shaped, which helps to minimize inter-symbol interference (ISI).</p>
<p>The Gaussian pulse for <span class="math inline">\(BT=0.5\)</span> as used in Bluetooth is shown in <a href="#fig-gaussian-pulse" class="quarto-xref">Figure&nbsp;15</a>.</p>
<div id="cell-fig-gaussian-pulse" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div id="fig-gaussian-pulse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gaussian-pulse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-gaussian-pulse-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;15: Gaussian pulse shaping in time and frequency domain for different bandwidth-time products BT."><img src="rfic_files/figure-html/fig-gaussian-pulse-output-1.png" width="758" height="470" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gaussian-pulse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Gaussian pulse shaping in time and frequency domain for different bandwidth-time products BT.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For both the raised-cosine and Gaussian pulse, the trade-off between time- and frequency-domain containment is clearly visible. This is also captured in “<strong>Küpfmüller’s uncertainty principle</strong>”, which states that the product of the time duration and the bandwidth of a pulse is lower-bounded by a constant. In other words, if we want to have a pulse that is very short in time, it will have a wide bandwidth, and vice versa.</p>
</section>
<section id="sec-fundamentals-ofdm" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="sec-fundamentals-ofdm"><span class="header-section-number">2.6</span> Orthogonal Frequency-Division Multiplexing (OFDM)</h2>
<p>As we have seen in the previous section, if we make the symbol rate high, we need to use pulses with a wide bandwidth. The problem with a wide bandwidth in wireless communication is <strong>multi-path propagation</strong>, which causes frequency-selective fading. This means that some frequencies are attenuated more than others, which can cause errors in the received signal. Equalizing such a frequency-selective channel can be very complex, especially if the channel changes rapidly (as in mobile communication). We now face a dilemma: How can we achieve high data rates (which require high symbol rates and thus wide bandwidth) while avoiding frequency-selective fading? The key idea, implemented in <strong>OFDM</strong>, is to split the wideband channel into multiple narrowband sub-channels (subcarriers), each with a low symbol rate. This way, each subcarrier experiences flat fading, which is much easier to equalize.</p>
<p>The key question is now how to implement this idea efficiently, as we now have to apply modulation to hundreds or thousands of individual subcarriers. The solution is to use the <strong>inverse fast Fourier transform (IFFT)</strong> at the transmitter to generate the time-domain OFDM signal from the frequency-domain symbols, and the <strong>fast Fourier transform (FFT)</strong> at the receiver to recover the frequency-domain symbols from the time-domain OFDM signal. This is illustrated in <a href="#fig-ofdm-transceiver" class="quarto-xref">Figure&nbsp;16</a>.</p>
<div id="cell-fig-ofdm-transceiver" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div id="fig-ofdm-transceiver" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ofdm-transceiver-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-ofdm-transceiver-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Figure&nbsp;16: OFDM transmission system block diagram showing transmitter and receiver processing chains."><img src="rfic_files/figure-html/fig-ofdm-transceiver-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ofdm-transceiver-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: OFDM transmission system block diagram showing transmitter and receiver processing chains.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The OFDM transmitter takes a block of <span class="math inline">\(N\)</span> symbols (e.g., 64-QAM symbols) and maps them onto <span class="math inline">\(N\)</span> subcarriers, thereby reducing the symbol rate for each subcarrier to <span class="math inline">\(T_\mathrm{b} / N\)</span>. The IFFT then generates the time-domain OFDM signal, which is transmitted over the wireless channel. Before transmission the <strong>cyclic prefix (CP)</strong> is added to each OFDM symbol.</p>
<p>At the receiver, first the CP is removed, and then the FFT recovers the frequency-domain symbols, which can then be equalized (fairly simply by multiplying each subcarrier with a complex factor to correct amplitude and phase) and demodulated.</p>
<p>A key property of OFDM is that the subcarriers are <strong>orthogonal</strong> to each other, which means that they do not interfere with each other, even if they overlap in frequency. This is achieved by choosing the subcarrier spacing <span class="math inline">\(\Delta f\)</span> such that it is equal to the symbol rate <span class="math inline">\(1/T_\mathrm{b}\)</span>, i.e., <span class="math inline">\(\Delta f = 1/T_\mathrm{b}\)</span>. This way, the integral of the product of two different subcarriers over one symbol period is zero, which means that they are orthogonal.</p>
<p>To further improve the robustness against multi-path propagation, a CP is added to each OFDM symbol. The CP is a copy of the last part of the OFDM symbol, which is added to the beginning of the symbol. This way, if there are delayed copies of the OFDM symbol due to multi-path propagation, they will still fall within the CP and will not cause inter-symbol interference (ISI). The length of the CP should be longer than the maximum delay spread of the channel.</p>
<div id="nte-lte-ofdm" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;6: OFDM in LTE
</div>
</div>
<div class="callout-body-container callout-body">
<p>In LTE OFDM is used for the downlink (base station to user equipment) with the following parameters:</p>
<ul>
<li>Subcarrier spacing: 15 kHz</li>
<li>CP length: 5.2 µs (normal), 4.7 µs (extended)</li>
<li>Number of subcarriers: 1200 (for 20 MHz bandwidth)</li>
<li>Modulation: QPSK, 16-QAM, 64-QAM, 256-QAM</li>
</ul>
<p>From the subcarrier spacing we can calculate the symbol duration as <span class="math inline">\(T_\mathrm{b} = 1 / \Delta f = 1 / 15\,\text{kHz} \approx 66.7\,\mu\text{s}\)</span>.</p>
<p>We can calculate the raw bitrate for a 20 MHz LTE channel as</p>
<p><span class="math display">\[
\text{Bitrate} = N_\mathrm{sc} \cdot N_\mathrm{sym} \cdot \frac{1}{T_\mathrm{b} + T_\mathrm{CP}} = 1200 \cdot 8 \cdot \frac{1}{66.7\,\mu\text{s} + 5.2\,\mu\text{s}} \approx 133\,\text{Mbps}
\]</span></p>
<p>Without the overhead for control channels and error correction coding a user datarate of approximately 100 Mbps can be achieved in a 20 MHz LTE channel.</p>
</div>
</div>
</section>
<section id="sec-fundamentals-multiple-access" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="sec-fundamentals-multiple-access"><span class="header-section-number">2.7</span> Multiple Access Techniques</h2>
<p>In wireless communication systems, multiple users need to share the same frequency spectrum. This is achieved by using <strong>multiple access techniques</strong>, which allow multiple users to transmit and receive data simultaneously without interfering with each other. The most common multiple access techniques are:</p>
<ol type="1">
<li><p><strong>Time division multiple access (TDMA)</strong>: Users are assigned specific time slots for transmission, allowing multiple users to share the same frequency channel by dividing the time into slots.</p></li>
<li><p><strong>Frequency division multiple access (FDMA)</strong>: Users are assigned specific frequency bands within the overall frequency spectrum, allowing multiple users to transmit simultaneously on different frequencies.</p></li>
<li><p><strong>Code division multiple access (CDMA)</strong>: Users are assigned unique spreading codes, allowing them to transmit simultaneously over the same frequency band. The receiver uses the code to extract the desired signal. A variant of CDMA is frequency-hopping spread spectrum (FHSS), where the carrier frequency is changed rapidly according to a pseudo-random sequence known to both the transmitter and receiver. This is used in Bluetooth.</p></li>
<li><p><strong>Orthogonal frequency division multiple access (OFDMA)</strong>: A variant of OFDM, where multiple users are assigned different subcarriers for transmission, allowing for efficient use of the frequency spectrum. This is used in 4G LTE and 5G NR.</p></li>
<li><p><strong>Spatial division multiple access (SDMA)</strong>: Uses multiple antennas to create spatially separated channels, allowing multiple users to transmit simultaneously in the same frequency band.</p></li>
</ol>
<p>In addition, all of these techniques can be combined to create more efficient and flexible communication systems. For example, OFDMA can be used in conjunction with SDMA to allow multiple users to share the same frequency resources while also taking advantage of spatial diversity. Also, TDMA can be combined with FDMA to create a hybrid multiple access scheme (which has been used in 2G GSM).</p>
</section>
</section>
<section id="sec-trx" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Transceivers</h1>
<p>Nowadays, the various small-signal RF functions for receive and transmit are integrated into so-called transceivers (TRX). A TRX is a device that can both transmit and receive signals, and is usually called an “RFIC”. While high monolithic integration is certainly the norm for radio-frequency devices intended for standards like Bluetooth, WiFi, cellular, etc., it is increasingly used also for mm-wave frequencies for applications like automotive radar and 5G cellular.</p>
<p>Typically TRX include components like amplifiers, mixers, filters, oscillators, and phase-locked loops. When digital interfaces are used for the baseband data transport also functions like analog-to-digital conversion (ADC) and digital-to-analog conversion (DAC) are integrated together with digital signal processing (DSP) blocks and potentially high-speed interfaces.</p>
<p>In this lecture we will focus on the RF part of a TRX, which is responsible for the upconversion of baseband or intermediate frequency (IF) signals to the desired transmit frequency during transmission, and the downconversion of received signals from the carrier frequency to baseband or IF during reception. For filters, low-frequency amplifiers, ADCs, DACs, and DSP blocks we refer to related courses and literature, for example <a href="https://iic-jku.github.io/analog-circuit-design/analog_circuit_design.html">our analog circuit design course</a>.</p>
<section id="sec-trx-direct-conversion" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-trx-direct-conversion"><span class="header-section-number">3.1</span> Direct-Conversion Transceiver</h2>
<p>The following typical functions have to be performed by a TRX:</p>
<ul>
<li>Pulse-shaping filtering of the baseband signal (can be implemented analog or in most cases digital).</li>
<li>Modulating the baseband signal onto a carrier frequency (upconversion) in the TX or downconversion in the RX.</li>
<li>Contain the RF signal in a small bandwidth (TX), or single out the wanted signal in the RX.</li>
<li>Adapt gain (and linearity) to the signal strength in the RX, and to the output power in the TX.</li>
<li>Generate the carrier frequency (local oscillator, LO) with low phase noise.</li>
</ul>
<p>The dominant architecture for the TRX is the so-called direct-conversion (or Zero-IF) architecture, where the upconversion and downconversion is performed in a single step. This is in contrast to superheterodyne architectures, where the signal is first converted to an intermediate frequency (IF) before being converted to baseband. The direct-conversion architecture has the advantage of reduced complexity and cost, as it requires fewer components and less filtering. However, it also has some disadvantages, such as increased susceptibility to DC offsets and I/Q imbalance. A typical TRX block diagram is shown in Figure <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a>.</p>
<div id="cell-fig-trx-block" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div id="fig-trx-block" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-block-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;17: Block diagram of a typical transceiver (TRX) showing the main functional blocks of RX and TX. The modem provides the digital baseband processing and interfaces to the rest of the system. For implementation options of the RF front-end, see Section&nbsp;3.5."><img src="rfic_files/figure-html/fig-trx-block-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Block diagram of a typical transceiver (TRX) showing the main functional blocks of RX and TX. The modem provides the digital baseband processing and interfaces to the rest of the system. For implementation options of the RF front-end, see <a href="#sec-trx-duplexing" class="quarto-xref">Section&nbsp;3.5</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As can be seen in <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a>, this generic example can be adapted in various ways. Generally, the amplifier gains are adjustable to adapt to different signal levels. If various channel bandwidths are to be supported, the corner frequencies of the low-pass filters (LPF) can be adjusted, as well as (optionally) the sampling rate of the ADCs and DACs. The local oscillator (LO) frequency is generated by a phase-locked loop (PLL) synthesizer, which can be tuned to the desired carrier frequency. In case of frequency-division duplex (FDD) operation, two PLLs are used to generate the TX and RX LO frequencies, which are separated by the duplex distance. In time-division duplex (TDD) operation, a single PLL is sufficient, supplying the LO signal to both RX and TX.</p>
<p>The modem that is shown in <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a> is responsible for the digital baseband processing, including functions like channel coding/decoding, modulation/demodulation, equalization, and error correction. The modem is usually implemented as a digital System-on-Chip (SoC) consisting of (multiple) CPUS, DSPs, and fixed-function blocks for time-critical processing. For an in-depth discussion we recommend <span class="citation" data-cites="Sklar_Digital_Communications">(<a href="#ref-Sklar_Digital_Communications" role="doc-biblioref">Sklar and Harris 2020</a>)</span> or <span class="citation" data-cites="Molisch_Wireless_Communications">(<a href="#ref-Molisch_Wireless_Communications" role="doc-biblioref">Molisch 2022</a>)</span>.</p>
</section>
<section id="sec-trx-mod-demod" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-trx-mod-demod"><span class="header-section-number">3.2</span> Modulation and Demodulation</h2>
<p>Modulation is the process of varying a carrier signal at frequency <span class="math inline">\(f_\mathrm{c}\)</span> in order to transmit information. The complex baseband signal (after converting the real-valued digital <span class="math inline">\(s_\mathrm{I}\)</span> and <span class="math inline">\(s_\mathrm{Q}\)</span> signals to analog and pulse-shaping filtering) is represented as (<span class="math inline">\(\tilde{s}_\mathrm{BB} \in \mathbb{C}\)</span>; <span class="math inline">\(s_\mathrm{I}, s_\mathrm{Q} \in \mathbb{R}\)</span>):</p>
<p><span class="math display">\[
\tilde{s}_\mathrm{BB}(t) = s_\mathrm{I}(t) + j \cdot s_\mathrm{Q}(t).
\]</span></p>
<p>We want to shift this signal to the carrier frequency <span class="math inline">\(f_\mathrm{c}\)</span>, which can be done by multiplying with a complex exponential (<span class="math inline">\(e^{j \omega_\mathrm{c} t}\)</span>, with <span class="math inline">\(\omega_\mathrm{c} = 2 \pi f_\mathrm{c}\)</span>):</p>
<p><span class="math display">\[
\tilde{s}_\mathrm{RF}(t) = \tilde{s}_\mathrm{BB}(t) \cdot e^{j \omega_\mathrm{c} t} = [s_\mathrm{I}(t) + j \cdot s_\mathrm{Q}(t)] \cdot [\cos(\omega_\mathrm{c} t) + j \cdot \sin(\omega_\mathrm{c} t)].
\]</span></p>
<p>The real-valued RF signal is obtained by taking the real part of this expression (<span class="math inline">\(s_\mathrm{RF} \in \mathbb{R}\)</span>, <span class="math inline">\(\tilde{s}_\mathrm{RF} \in \mathbb{C}\)</span>):</p>
<p><span id="eq-modulation"><span class="math display">\[
s_\mathrm{RF}(t) = \Re \{ \tilde{s}_\mathrm{RF}(t) \} = s_\mathrm{I}(t) \cos(\omega_\mathrm{c} t) - s_\mathrm{Q}(t) \sin(\omega_\mathrm{c} t).
\tag{21}\]</span></span></p>
<p>The process formulated in <a href="#eq-modulation" class="quarto-xref">Equation&nbsp;21</a> is done in the TX, as shown in <a href="#fig-tx-modulation" class="quarto-xref">Figure&nbsp;18</a>.</p>
<div id="cell-fig-tx-modulation" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div id="fig-tx-modulation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tx-modulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-tx-modulation-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;18: TX modulator."><img src="rfic_files/figure-html/fig-tx-modulation-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tx-modulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: TX modulator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The RF signal generation according to <a href="#eq-modulation" class="quarto-xref">Equation&nbsp;21</a> is called quadrature modulation. This is the modulation used most often in modern communication systems, as it allows to transmit two independent signals (I and Q) in the same bandwidth. The I and Q signals are also called quadrature components, as they are 90° out of phase with each other.</p>
<p>Alternatively, a modulation called polar modulation can be used, where the amplitude and phase of the carrier are varied according to the baseband signal. This is done by converting the I and Q signals to polar coordinates</p>
<p><span class="math display">\[
s_\mathrm{RF}(t) = \Re \{ A(t) \cdot e^{j \varphi(t)} \cdot e^{j \omega_\mathrm{c} t} \}
\]</span></p>
<p>with</p>
<p><span class="math display">\[
A(t) = \sqrt{s_\mathrm{I}^2(t) + s_\mathrm{Q}^2(t)}, \quad \varphi(t) = \tan^{-1} \left[ \frac{s_\mathrm{I}(t)}{s_\mathrm{Q}(t)} \right].
\]</span></p>
<p>As the mathematical operations required for the cartesian to polar transformation are quite nonlinear, the <span class="math inline">\(A(t)\)</span> and <span class="math inline">\(\phi(t)\)</span> signals are wideband. Some wireless standards allow efficient use of polar modulation, for example Bluetooth, where basically all TX are realized as polar modulators.</p>
<p>In the RX, the received RF signal is downconverted to baseband by a similar process, as shown in <a href="#fig-rx-demodulation" class="quarto-xref">Figure&nbsp;19</a>.</p>
<div id="cell-fig-rx-demodulation" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display">
<div id="fig-rx-demodulation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rx-demodulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-rx-demodulation-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;19: RX demodulator."><img src="rfic_files/figure-html/fig-rx-demodulation-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rx-demodulation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: RX demodulator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For demodulation we have to shift the RF signal down to baseband, which mathematically is done by multiplying with the complex conjugate of the carrier (<span class="math inline">\(e^{-j \omega_\mathrm{c} t}\)</span>)</p>
<p><span id="eq-demodulation"><span class="math display">\[
\tilde{s}_\mathrm{BB}(t) = s_\mathrm{RF}(t) \cdot e^{-j \omega_\mathrm{c} t} = s_\mathrm{RF}(t) \cdot [\cos(\omega_\mathrm{c} t) - j \cdot \sin(\omega_\mathrm{c} t)]
\tag{22}\]</span></span></p>
</section>
<section id="filtering" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="filtering"><span class="header-section-number">3.3</span> Filtering</h2>
<p>Filtering is an essential function in both TX and RX. In the TX, filtering is used to limit the bandwidth of the transmitted signal to the allocated channel bandwidth, and to suppress out-of-band emissions. In the RX, filtering is used to select the wanted signal from a crowded spectrum, and to suppress unwanted signals (blockers) that can cause interference or desensitization of the RX. A typical example of filtering in the RX is shown in <a href="#fig-filtering-rx" class="quarto-xref">Figure&nbsp;20</a>, where a bandpass filter is used to attenuate strong unwanted blockers while only slightly attenuating the wanted signal.</p>
<div id="cell-fig-filtering-rx" class="cell" data-execution_count="20">
<div class="cell-output cell-output-display">
<div id="fig-filtering-rx" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-filtering-rx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-filtering-rx-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;20: Filtering of wanted channel amid strong unwanted blockers. Exemplary shown in an RX scenario around 900 MHz. The strong blockers (top figure) are attenuated by an RF bandpass filter (bottom figure) with a bandwidth of 20 MHz, achieving more than 40 dB rejection of the blockers while only slightly attenuating the wanted signal."><img src="rfic_files/figure-html/fig-filtering-rx-output-1.png" width="662" height="470" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-filtering-rx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Filtering of wanted channel amid strong unwanted blockers. Exemplary shown in an RX scenario around 900 MHz. The strong blockers (top figure) are attenuated by an RF bandpass filter (bottom figure) with a bandwidth of 20 MHz, achieving more than 40 dB rejection of the blockers while only slightly attenuating the wanted signal.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In any filter there exists a fundamental trade-off between selectivity (steepness of the filter skirts), bandwidth, and insertion loss. A very selective filter with steep skirts and large BW will have a high insertion loss. Conversely, a filter with low insertion loss will have a gentle roll-off and may not sufficiently suppress unwanted signals. A useful metric to quantify the performance of a filter is the quality factor <span class="math inline">\(Q\)</span>, defined as</p>
<p><span class="math display">\[
Q = \frac{f_\mathrm{c}}{\Delta f}
\]</span></p>
<p>where <span class="math inline">\(f_\mathrm{c}\)</span> is the center frequency and <span class="math inline">\(\Delta f\)</span> is the –3 dB bandwidth of the filter. A higher <span class="math inline">\(Q\)</span> indicates a more selective filter.</p>
<p>The achievable <span class="math inline">\(Q\)</span> depends on the filter technology used. For example, on-chip LC filters can achieve <span class="math inline">\(Q\)</span> values of around 10-20, while off-chip SAW or BAW/FBAR filters can achieve <span class="math inline">\(Q\)</span> values of several hundreds, and a crystal filter can achieve <span class="math inline">\(Q\)</span> values of several thousands. The choice of filter technology depends on the application requirements, such as frequency range, bandwidth, insertion loss, and cost. Generally speaking, the required filtering to single out the wanted signal in the RX spectrum and decrease the power of strong blockers to a tolerable level is one of the most critical design choices, and is usually distributed at different locations in the RX chain:</p>
<ul>
<li><strong>RF filters</strong> (between antenna and LNA) provide a first level of filtering, and are usually implemented as off-chip SAW or BAW/FBAR filters. They provide high <span class="math inline">\(Q\)</span> and good selectivity, but have a fixed center frequency and bandwidth. They are used to pass the wanted band of interest, and to attenuate strong out-of-band blockers.</li>
<li><strong>IF filters</strong> (in case of a super-heterodyne receiver) provide additional filtering, and can be implemented as on-chip LC filters or off-chip SAW/BAW filters. They provide moderate <span class="math inline">\(Q\)</span> and selectivity, and can be tuned to some extent.</li>
<li><strong>BB filters</strong> (after downconversion) provide the final level of filtering before entering the ADCs, and are usually implemented as on-chip active RC filters. They provide channel selection, and can be easily adjusted to different bandwidths.</li>
<li><strong>Digital filters</strong> (in the DSP block) provide the final level of filtering and signal processing, and can be implemented as FIR or IIR filters. They provide high flexibility and can be easily adapted to different standards and requirements. Digital filters show now variations, so they can be designed to be very selective.</li>
</ul>
<p>It is important to note (because this dictates a lot of choices in RF design) that high-<span class="math inline">\(Q\)</span> filters are usually fixed-frequency and fixed-bandwidth. Only baseband and digital filters can be easily adjusted to different bandwidths!</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Filter Technologies
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Baseband filters (analog)</strong> are usually implemented as active <span class="math inline">\(RC\)</span> filters on-chip. They are very flexible and can have adjustable bandwidth by either changing <span class="math inline">\(R\)</span> and/or <span class="math inline">\(C\)</span>. For medium frequencies <span class="math inline">\(g_\mathrm{m}-C\)</span> filters can be used, which are also tunable by changing the transconductance <span class="math inline">\(g_\mathrm{m}\)</span> and/or <span class="math inline">\(C\)</span>. For even higher bandwidths, on-chip LC filters can be used, which have a limited <span class="math inline">\(Q\)</span> of around 10-20.</p>
<p><strong>Baseband filters (digital)</strong> are implemented as FIR or IIR filters in the DSP block. They are very flexible and can be easily adapted to different standards and requirements. Digital filters show no variations, so they can be designed to be very selective.</p>
<p><strong>Surface acoustic wave (SAW)</strong> and <strong>bulk acoustic wave (BAW/FBAR)</strong> filters are off-chip components that can achieve high <span class="math inline">\(Q\)</span> values of several hundreds. They have a fixed center frequency and bandwidth. Usually 1-2 such filters are required per supported band of interest.</p>
<p><strong>Crystal filters</strong> can achieve very high <span class="math inline">\(Q\)</span> values of several thousands, but are usually bulky and expensive.</p>
<p><strong>LC filters</strong> can be either implemented off-chip (using discrete components) or on-chip. Off-chip LC filters can achieve higher <span class="math inline">\(Q\)</span> values than on-chip LC filters, but are usually larger and more expensive. On-chip LC filters are limited in <span class="math inline">\(Q\)</span> (around 10-20), but are very compact and can be integrated into the RFIC. Off-chip LC filters can achieve <span class="math inline">\(Q\)</span> values of around 50-100, depending on the frequency and component quality.</p>
<p><strong>Ceramic filters</strong> are another off-chip filter technology that can achieve moderate to high <span class="math inline">\(Q\)</span> values (up to several hundreds). They are usually smaller and less expensive than SAW or BAW/FBAR filters, but also lower performance.</p>
<p><strong>Waveguide filters</strong> are used at very high frequencies (above 10 GHz) and can achieve very high <span class="math inline">\(Q\)</span> values (up to several thousands). They are usually bulky and expensive, and are not commonly used in mobile applications, but rather in fixed installations like base stations or satellite communication.</p>
</div>
</div>
<p>Fundamentally, the choice of filter technology is a trade-off between performance, size, cost, and flexibility. In most cases, a combination of different filter technologies is used to achieve the desired performance.</p>
</section>
<section id="direct-conversion-architecture" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="direct-conversion-architecture"><span class="header-section-number">3.4</span> Direct-Conversion Architecture</h2>
<p>The transceiver architecture shown in <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a> is called direct-conversion or zero-IF architecture, as the downconversion in the RX and upconversion in the TX is done in a single step. This architecture has several advantages:</p>
<ul>
<li>Per RX and TX a single LO is required (which can even be shared between RX and TX in TDD operation).</li>
<li>There are a minimum number of RF blocks, which is good for cost and power consumption.</li>
<li>This architecture is very flexible and can be easily adapted to different standards and requirements, and generally shows very good performance if the disadvantages can be overcome by good design.</li>
<li>This architecture allows a high integration level, as basically all blocks can be implemented on-chip.</li>
<li>Direct conversion is the de-facto standard architecture for cellular, WiFi, Bluetooth (with the exception of the TX), and GNSS.</li>
</ul>
<p>However, the direct-conversion architecture also has some disadvantages:</p>
<ul>
<li>LO-RF coupling can cause self-mixing and desensitization of the RX, as well as LO leakage in the TX. This is an issue because the LO frequency is the same as the RF frequency.</li>
<li>Even-order distortion products (especially IIP2) cause sensitivity degradation due to strong amplitude-modulated blockers.</li>
<li>LO pulling can occur in the TX (again, LO and RF are at the same frequency).</li>
<li>IQ errors (gain and phase mismatch) of the <span class="math inline">\(I\)</span> and <span class="math inline">\(Q\)</span> paths can cause constellation distortion leading to increased error vector magnitude (EVM).</li>
<li>DC offsets can occur due to self-mixing of LO leakage and even-order distortion products.</li>
<li>Flicker noise (1/f noise) upconversion can cause increased phase noise close to the carrier, as well as increased RX noise figure.</li>
</ul>
<p>Nowadays there exist good design techniques to mitigate these disadvantages. However, in some cases (for example very high linearity requirements, or very high frequencies) other architectures like low-IF or super-heterodyne may be preferred.</p>
</section>
<section id="sec-trx-duplexing" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sec-trx-duplexing"><span class="header-section-number">3.5</span> Duplexing</h2>
<p>In the block diagram of <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a>, we have not yet considered how to share the antenna between RX and TX. Essentially, there are two main methods to achieve this: <strong>frequency-division duplex (FDD)</strong> and <strong>time-division duplex (TDD)</strong>.</p>
<section id="frequency-division-duplex-fdd" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="frequency-division-duplex-fdd"><span class="header-section-number">3.5.1</span> Frequency-Division Duplex (FDD)</h3>
<p>In FDD, the RX and TX operate at different frequencies, separated by a duplex distance. This allows simultaneous transmission and reception, which is beneficial for applications like voice communication where low latency is required. However, FDD requires two separate frequency bands, which can be a limitation in terms of spectrum availability. Additionally, FDD requires two PLLs to generate the RX and TX LO frequencies, which increases complexity and power consumption.</p>
<p>The RF RX and TX paths are connected to the antenna via a duplexer, which is a three-port device that allows signals to pass between the antenna and the RX or TX path, while isolating the RX and TX paths from each other. A typical FDD TRX block diagram is shown in <a href="#fig-trx-fdd" class="quarto-xref">Figure&nbsp;21</a>.</p>
<div id="cell-fig-trx-fdd" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display">
<div id="fig-trx-fdd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-fdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-fdd-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;21: Block diagram of an FDD RF front-end."><img src="rfic_files/figure-html/fig-trx-fdd-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-fdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Block diagram of an FDD RF front-end.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Advantages of FDD:</p>
<ul>
<li>RX and TX can operate simultaneously, which is beneficial for low-latency applications.</li>
<li>There is no need for fast switching between RX and TX, which simplifies the design.</li>
<li>Relaxed synchronization requirements between RX and TX and different users.</li>
</ul>
<p>Disadvantages of FDD:</p>
<ul>
<li>Duplexers are costly components with significant insertion loss depending on filtering requirements.</li>
<li>Requires two separate frequency bands, which can be a limitation in terms of spectrum availability, and MIMO channel estimation.</li>
<li>The strong TX causes severe desensitization of the RX, which requires high linearity and good filtering (50 dB to 60 dB).</li>
</ul>
</section>
<section id="time-division-duplex-tdd" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="time-division-duplex-tdd"><span class="header-section-number">3.5.2</span> Time-Division Duplex (TDD)</h3>
<p>In TDD, the RX and TX share the same frequency band but operate at different times. This allows for more efficient use of the available spectrum, as the same frequency can be used for both transmission and reception. TDD is particularly well-suited for applications with asymmetric traffic patterns, where the data rate in one direction is significantly higher than in the other. However, TDD requires precise timing control to avoid interference between RX and TX periods, which can increase complexity. In TDD, a single PLL can be used to generate the LO frequency for both RX and TX, which reduces complexity and power consumption. The RF RX and TX paths are connected to the antenna via a switch, which alternates between connecting the antenna to the RX path and the TX path. A typical TDD TRX block diagram is shown in <a href="#fig-trx-tdd" class="quarto-xref">Figure&nbsp;22</a>.</p>
<div id="cell-fig-trx-tdd" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display">
<div id="fig-trx-tdd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-tdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-tdd-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-22" title="Figure&nbsp;22: Block diagram of a TDD RF front-end."><img src="rfic_files/figure-html/fig-trx-tdd-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-tdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22: Block diagram of a TDD RF front-end.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Advantages of TDD:</p>
<ul>
<li>More efficient use of the available spectrum, as the same frequency can be used for both RX and TX.</li>
<li>A single PLL can be used for both RX and TX, which reduces complexity and power consumption.</li>
<li>No duplexer is required (just a single band filter), which reduces cost and insertion loss.</li>
<li>No RX blocking by own TX, which relaxes linearity and filtering requirements.</li>
<li>Easier to implement MIMO, as all antennas can operate in the same frequency band.</li>
</ul>
<p>Disadvantages of TDD:</p>
<ul>
<li>RX and TX cannot operate simultaneously, which can be a limitation for low-latency applications.</li>
<li>Requires precise timing control to avoid interference between RX and TX periods, which can increase complexity.</li>
<li>Synchronization between RX and TX and different users is required, which can be challenging in some scenarios.</li>
</ul>
</section>
<section id="comparison-of-fdd-and-tdd" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="comparison-of-fdd-and-tdd"><span class="header-section-number">3.5.3</span> Comparison of FDD and TDD</h3>
<p>Below is a summary of important wireless standards and their duplexing method as shown in <a href="#tbl-duplexing-standards" class="quarto-xref">Table&nbsp;4</a>:</p>
<div id="tbl-duplexing-standards" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-duplexing-standards-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Comparison of duplexing methods used by major wireless standards
</figcaption>
<div aria-describedby="tbl-duplexing-standards-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 22%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Wireless Standard</th>
<th style="text-align: left;">Duplexing Method</th>
<th style="text-align: left;">Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GSM (2G)</td>
<td style="text-align: left;">FDD &amp; TDMA</td>
<td style="text-align: left;">TX and RX operate at different frequencies (FDD) and different times (TDMA)</td>
</tr>
<tr class="even">
<td style="text-align: left;">UMTS (3G)</td>
<td style="text-align: left;">FDD</td>
<td style="text-align: left;">Traditional cellular standard using paired spectrum</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LTE (4G)</td>
<td style="text-align: left;">FDD/TDD</td>
<td style="text-align: left;">FDD is used mostly &lt;2.7 GHz, TDD is used &gt;2.3 GHz</td>
</tr>
<tr class="even">
<td style="text-align: left;">5G NR</td>
<td style="text-align: left;">FDD/TDD</td>
<td style="text-align: left;">FDD is used mostly &lt;2.7 GHz, TDD is used &gt;2.3 GHz</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WiFi (802.11)</td>
<td style="text-align: left;">TDD</td>
<td style="text-align: left;">Unlicensed spectrum operation</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bluetooth</td>
<td style="text-align: left;">TDD</td>
<td style="text-align: left;">Short-range personal area network</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zigbee</td>
<td style="text-align: left;">TDD</td>
<td style="text-align: left;">Low-power IoT applications</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>As you can see in <a href="#tbl-duplexing-standards" class="quarto-xref">Table&nbsp;4</a>, there is a tendency to use FDD for lower frequencies and long communication distances, while TDD is preferred for higher frequencies and shorter distances.</p>
</section>
</section>
<section id="specialty-architectures" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="specialty-architectures"><span class="header-section-number">3.6</span> Specialty Architectures</h2>
<p>In some cases, other architectures may be preferred over the direct-conversion architecture. During the evolution of wireless communication, many different architectures have been proposed and used. However, only a few of them are still relevant today. Some examples are shown next.</p>
<section id="super-heterodyne-architecture" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="super-heterodyne-architecture"><span class="header-section-number">3.6.1</span> Super-Heterodyne Architecture</h3>
<p>The super-heterodyne architecture is a widely used approach in radio. It works by mixing the incoming/outgoing RF signal with an LO to produce an intermediate frequency (IF) signal. This IF signal is then amplified and processed, allowing for better selectivity and sensitivity compared to direct-conversion architectures. Super-heterodyne receivers/transmitters are known for their excellent performance in terms of image rejection and dynamic range, making them suitable for a variety of applications, including traditional analog TV and radio broadcasting. A simplified block diagram of a super-heterodyne transceiver is shown in <a href="#fig-trx-superheterodyne" class="quarto-xref">Figure&nbsp;23</a>.</p>
<div id="cell-fig-trx-superheterodyne" class="cell" data-execution_count="23">
<div class="cell-output cell-output-display">
<div id="fig-trx-superheterodyne" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-superheterodyne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-superheterodyne-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-23" title="Figure&nbsp;23: Block diagram of a super-heterodyne transceiver (TRX) showing the main functional blocks of RX and TX."><img src="rfic_files/figure-html/fig-trx-superheterodyne-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-superheterodyne-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23: Block diagram of a super-heterodyne transceiver (TRX) showing the main functional blocks of RX and TX.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When you compare <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a> with <a href="#fig-trx-superheterodyne" class="quarto-xref">Figure&nbsp;23</a>, you can immediately appreciate the increased complexity of the super-heterodyne architecture. It requires two PLLs to generate the RX and TX LO frequencies, as well as additional mixers and filters for the IF stage. This increases cost, power consumption, and size. However, the super-heterodyne architecture can provide better performance in terms of selectivity and sensitivity, especially in challenging RF environments with strong blockers, as it allows filtering at RF, IF, and baseband frequencies.</p>
<p>One important aspect of super-heterodyne receivers is the choice of the intermediate frequency (IF). The IF should be high enough to allow for effective filtering and <strong>image rejection</strong>, but low enough to avoid excessive complexity and power consumption. Common IF frequencies range from a few MHz to several hundred MHz, depending on the application and frequency band.</p>
<p>An important issue in super-heterodyne receivers is the <strong>image frequency</strong>. The image frequency is a spurious frequency that can interfere with the desired signal, and is located at <span class="math inline">\(f_\mathrm{image} = f_\mathrm{RF} \pm 2 f_\mathrm{IF}\)</span> (the sign depends on the choice of high-side or low-side mixing). To suppress the image frequency, an image-reject filter is either placed before (RX) or after (TX) the mixer. The design of this filter is critical, as it must provide sufficient attenuation of the image frequency while maintaining low insertion loss for the desired signal.</p>
<p>An alternative to image filtering is the use of active image rejection techniques, such as the <strong>Hartley</strong> or <strong>Weaver</strong> architectures. These techniques use additional mixers and phase shifters to cancel out the image frequency, allowing for improved performance without the need for a dedicated image-reject filter.</p>
</section>
<section id="low-if-architecture" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="low-if-architecture"><span class="header-section-number">3.6.2</span> Low-IF Architecture</h3>
<p>To avoid some of the issues of direct-conversion architectures (like dc offsets and flicker noise), a low-IF architecture can be used. In a low-IF architecture, the RX and TX signals are mixed to a low intermediate frequency (typically a few MHz to tens of MHz) instead of directly to baseband. This allows for easier filtering of DC offsets and flicker noise, while still maintaining the benefits of a single LO and reduced complexity compared to super-heterodyne architectures. A low-IF architecture is shown in <a href="#fig-trx-lowif" class="quarto-xref">Figure&nbsp;24</a>.</p>
<div id="cell-fig-trx-lowif" class="cell" data-execution_count="24">
<div class="cell-output cell-output-display">
<div id="fig-trx-lowif" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-lowif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-lowif-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-24" title="Figure&nbsp;24: Block diagram of a low-IF transceiver (TRX) showing the main functional blocks of RX and TX. Note the usage of complex analog and digital baseband filters. Otherwise, the structure is similar to a zero-IF TRX as shown in Figure&nbsp;17."><img src="rfic_files/figure-html/fig-trx-lowif-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-lowif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24: Block diagram of a low-IF transceiver (TRX) showing the main functional blocks of RX and TX. Note the usage of complex analog and digital baseband filters. Otherwise, the structure is similar to a zero-IF TRX as shown in <a href="#fig-trx-block" class="quarto-xref">Figure&nbsp;17</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The low-IF architecture is the de facto standard for Bluetooth receivers. Its advantage compared to direct-conversion vanishes for larger channel bandwidths, which is why it is not used for cellular or WiFi (GSM receivers might be an exception).</p>
<p>One noteworthy disadvantage of low-IF architectures is the required 2xBW compared to direct-conversion. This might cause increased power consumption in the analog baseband filters and ADCs/DACs. Additionally, the low-IF architecture still requires careful design to mitigate issues like IQ imbalance and LO leakage, although these issues are generally less severe than in direct-conversion architectures.</p>
</section>
<section id="super-simple-architecture" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="super-simple-architecture"><span class="header-section-number">3.6.3</span> Super Simple Architecture</h3>
<p>For some applications with very low cost and low performance requirements, a super simple architecture can be used (think garage door opener). In this architecture, the RX and TX paths are stripped down to the bare minimum. A super simple receiver just uses a bandpass filter and an envelope detector, while a super simple transmitter uses an oscillator and power amplifier. These simplified architectures are shown in <a href="#fig-trx-supersimple" class="quarto-xref">Figure&nbsp;25</a>.</p>
<div id="cell-fig-trx-supersimple" class="cell" data-execution_count="25">
<div class="cell-output cell-output-display">
<div id="fig-trx-supersimple" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trx-supersimple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-trx-supersimple-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-25" title="Figure&nbsp;25: Block diagram of a super simple TX and RX."><img src="rfic_files/figure-html/fig-trx-supersimple-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trx-supersimple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25: Block diagram of a super simple TX and RX.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Despite the simple architecture, digital amplitude-shift-keying (ASK) or on-off-keying (OOK) can be used. If the receiver is able to discriminate between frequencies (e.g., by using two RF filters with an envelope detector each), also frequency-shift-keying (FSK) can be used.</p>
</section>
</section>
<section id="iq-imbalance" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="iq-imbalance"><span class="header-section-number">3.7</span> I/Q Imbalance</h2>
<p>In direct-conversion and low-IF architectures, the I and Q paths are used to process the in-phase and quadrature components of the signal. Ideally, these paths should have identical gain and a 90° phase difference. However, in practice, there are always some mismatches between the I and Q paths, leading to <strong>I/Q imbalance</strong>. This imbalance can cause constellation distortion, leading to increased error vector magnitude (EVM) and degraded system performance.</p>
<p>I/Q imbalance can be characterized by two parameters: gain mismatch (<span class="math inline">\(\Delta G\)</span>) and phase mismatch (<span class="math inline">\(\Delta \varphi\)</span>). Gain mismatch refers to the difference in gain between the I and Q paths, while phase mismatch refers to the deviation from the ideal 90° phase difference. The impact of I/Q imbalance on system performance depends on the modulation scheme used, with higher-order modulations being more sensitive to these impairments.</p>
<p>There are two ways to quantify I/Q imbalance:</p>
<ul>
<li><strong>Image rejection ratio (IRR)</strong>: The IRR is a measure of how well the receiver can reject the image frequency caused by I/Q imbalance. It is defined as the ratio of the power of the desired signal to the power of the image (unwanted) signal, typically expressed in dB. A higher IRR indicates better performance, with values above 30 dB to 40 dB generally considered acceptable for most applications.</li>
<li><strong>Error vector magnitude (EVM)</strong>: The EVM is a measure of the difference between the ideal transmitted signal and the received signal, expressed as a percentage of the signal’s magnitude. It quantifies the overall distortion in the received signal, including the effects of I/Q imbalance. Lower EVM values indicate better performance, with typical requirements ranging from 1% to 10% depending on the modulation scheme and application.</li>
</ul>
<p>The EVM (in rms) is defined as</p>
<p><span id="eq-evm-definition"><span class="math display">\[
\text{EVM} = \frac{\sqrt{\frac{1}{N} \sum_{i=1}^{N} |s_\mathrm{ideal}(i) - s_\mathrm{meas}(i)|^2}}{\sqrt{\frac{1}{N} \sum_{i=1}^{N} |s_\mathrm{ideal}(i)|^2}}
\tag{23}\]</span></span></p>
<p>where <span class="math inline">\(s_\mathrm{ideal}(i)\)</span> is the ideal transmitted symbol, <span class="math inline">\(s_\mathrm{meas}(i)\)</span> is the measured received symbol, and <span class="math inline">\(N\)</span> is the number of symbols. EVM is expressed either in percent or in dB using</p>
<p><span class="math display">\[
\text{EVM}|_\mathrm{dB} = 20 \cdot \log_{10}(\text{EVM}).
\]</span></p>
<p>In order to make the I/Q mismatch sufficiently small, among the possible techniques are:</p>
<ul>
<li>Careful layout and matching of the components in the I and Q paths to minimize gain and phase mismatches. This usually involves good layout techniques. Further, the LO I/Q generation should be done with high accuracy.</li>
<li>Calibration techniques can be used to measure and compensate for I/Q imbalance. This can be done either in the analog domain (e.g., using variable gain amplifiers and phase shifters) or in the digital domain (e.g., using digital signal processing algorithms). Digital compensation is usually preferred, as it is more flexible and can adapt to changing conditions. A <a href="https://en.wikipedia.org/wiki/CORDIC">CORDIC</a> can be readily used for this purpose.</li>
</ul>
</section>
</section>
<section id="sec-lna" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Low Noise Amplifiers</h1>
<p>As shown in <a href="#sec-sensitivity" class="quarto-xref">Section&nbsp;2.3.4</a>, the sensitivity of a receiver is determined (besides the channel bandwidth) mainly by the noise figure of the receiver. The noise figure is in turn determined by the noise figure of the first active component in the receive chain, which is usually a low noise amplifier (LNA), as exemplified in <a href="#eq-friis" class="quarto-xref">Equation&nbsp;18</a>. Hence, as shown in <a href="#fig-trx-fdd" class="quarto-xref">Figure&nbsp;21</a> and <a href="#fig-trx-tdd" class="quarto-xref">Figure&nbsp;22</a>, low noise amplifiers (LNAs) are the first active building block in a receiver after the antenna and some initial RF filtering.</p>
<div id="cell-fig-lna-block" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div id="fig-lna-block" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-block-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Figure&nbsp;26: Block diagram of an LNA. Typically, the LNA input is impedance matched to 50 Ω, while the output is often not matched if the LNA is kept on chip. Often, the LNA gain is adjustable to allow for gain control in the receiver depending on the signal conditions. The LNA also might have a low-power bypass mode to reduce the power consumption of the LNA for sufficiently strong signals."><img src="rfic_files/figure-html/fig-lna-block-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26: Block diagram of an LNA. Typically, the LNA input is impedance matched to 50 Ω, while the output is often not matched if the LNA is kept on chip. Often, the LNA gain is adjustable to allow for gain control in the receiver depending on the signal conditions. The LNA also might have a low-power bypass mode to reduce the power consumption of the LNA for sufficiently strong signals.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The LNA as a building block is shown in <a href="#fig-lna-block" class="quarto-xref">Figure&nbsp;26</a>. The main purpose of the LNA is to amplify the received signal with as little additional noise as possible. The LNA is usually designed for a specific frequency band, e.g., the 2.4 GHz ISM band or the 5 GHz WLAN band, and is typically designed for a specific impedance, e.g., 50 Ω, which is the standard impedance for RF systems. Impedance matching is usually required at the input; the output impedance matching is only required if the output of the LNA goes off-chip; if it is kept on-chip, impedance matching is often not required. The LNA is also designed to be sufficiently linear, i.e., to not introduce significant distortion to the amplified signal; however, compared to the noise requirements, linearity is often less critical.</p>
<p>Why is impedance matching at the input of the LNA so important?</p>
<ul>
<li>The antenna is usually designed for a specific impedance, e.g., 50 Ω, and if the LNA input is not matched to this impedance, a significant portion of the received signal will be reflected back to the antenna, resulting in a loss of signal power.</li>
<li>Filters at the input of the LNA need to be terminated with the correct impedance to achieve the desired filter characteristics.</li>
<li>Any transmission line in front of the LNA needs to be matched to avoid reflections and standing waves.</li>
</ul>
<p>To quantify the “quality” of an impedance match, the reflection coefficient <span class="math inline">\(\Gamma\)</span> is often used, which is defined as <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span>:</p>
<p><span class="math display">\[
\Gamma = \frac{Z_{\mathrm{in}} - Z_0}{Z_{\mathrm{in}} + Z_0}
\]</span></p>
<p>where <span class="math inline">\(Z_0\)</span> is the characteristic impedance of the system (usually 50 Ω) and <span class="math inline">\(Z_{\mathrm{in}}\)</span> is the input impedance of the LNA. The reflection coefficient <span class="math inline">\(\Gamma\)</span> is a complex number with a magnitude between 0 and 1, where 0 indicates a perfect match and 1 indicates a complete mismatch. This reflection coefficient can be represented on a Smith chart shown in <a href="#fig-smith-chart" class="quarto-xref">Figure&nbsp;27</a>.</p>
<div id="cell-fig-smith-chart" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display">
<div id="fig-smith-chart" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-smith-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-smith-chart-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Figure&nbsp;27: Smith chart showing constant resistance and reactance circles for impedance matching in RF circuits."><img src="rfic_files/figure-html/fig-smith-chart-output-1.png" width="463" height="463" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-smith-chart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27: Smith chart showing constant resistance and reactance circles for impedance matching in RF circuits.
</figcaption>
</figure>
</div>
</div>
</div>
<p>However, in practice, the more commonly used metric for impedance matching is the return loss (RL), which is defined as <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span>:</p>
<p><span class="math display">\[
\text{RL} = -20 \log_{10} |\Gamma| = 20 \log_{10} \left| \frac{Z_\mathrm{in} + Z_0}{Z_\mathrm{in} - Z_0} \right|.
\]</span></p>
<p>A higher return loss indicates a better impedance match. A return loss of 10 dB indicates that 10% of the signal power is reflected back, while a return loss of 20 dB indicates that only 1% of the signal power is reflected back. In practice, a return loss of at least 10 dB is desired, with higher (positive) values being better <span class="citation" data-cites="Bird.2009">(<a href="#ref-Bird.2009" role="doc-biblioref">Bird 2009</a>)</span>.</p>
<section id="sec-lna-resistive-matching" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-lna-resistive-matching"><span class="header-section-number">4.1</span> Resistively Matched Common-Source LNA</h2>
<p>The key question is now how to design an LNA with low noise figure and an input impedance matched to 50 Ω? In order to appreciate this design challenge, we will first try a naive approach, using a common-source amplifier with resistive termination, as shown in <a href="#fig-lna-naive" class="quarto-xref">Figure&nbsp;28</a>.</p>
<div id="cell-fig-lna-naive" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display">
<div id="fig-lna-naive" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-naive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-naive-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-28" title="Figure&nbsp;28: A simple LNA with resistive input matching and a tank circuit as a load (biasing details are omitted). The LNA is driven by a 50 Ω source."><img src="rfic_files/figure-html/fig-lna-naive-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-naive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: A simple LNA with resistive input matching and a tank circuit as a load (biasing details are omitted). The LNA is driven by a 50 Ω source.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we assume the gate capacitance of <span class="math inline">\(M_1\)</span> is negligible, we can achieve good input impedance matching by choosing <span class="math inline">\(R_\mathrm{s} = R_\mathrm{p} = 50\,\Omega\)</span>. The voltage gain of this simple common-source LNA is given by <span class="math inline">\(A_\mathrm{v} = -g_\mathrm{m}R_\mathrm{D}\)</span>, neglecting capacitances and <span class="math inline">\(g_\mathrm{ds}\)</span> of <span class="math inline">\(M_1\)</span> (we assume that the load tank is tuned to the desired frequency with <span class="math inline">\(\omega_0 = 1 / \sqrt{L C}\)</span>).</p>
<p>How can we calculate the noise figure of this simple LNA? We formulate</p>
<p><span id="eq-lna-noise-factor"><span class="math display">\[
F = \frac{\text{total noise at output}}{\text{noise at output due to source only}}.
\tag{24}\]</span></span></p>
<p>We derive a small-signal equivalent circuit of <a href="#fig-lna-naive" class="quarto-xref">Figure&nbsp;28</a>, which is shown in <a href="#fig-lna-naive-noise" class="quarto-xref">Figure&nbsp;29</a>, to calculate the total noise at the output of the LNA.</p>
<div id="cell-fig-lna-naive-noise" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display">
<div id="fig-lna-naive-noise" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-naive-noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-naive-noise-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-29" title="Figure&nbsp;29: Equivalent circuit of resistively matched common-source LNA."><img src="rfic_files/figure-html/fig-lna-naive-noise-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-naive-noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Equivalent circuit of resistively matched common-source LNA.
</figcaption>
</figure>
</div>
</div>
</div>
<p>With the help of <a href="#fig-lna-naive-noise" class="quarto-xref">Figure&nbsp;29</a>, we can calculate the total output noise power spectral density as</p>
<p><span class="math display">\[
\overline{V_\mathrm{n,out,1}^2} = A_\mathrm{v}^2 \cdot 4 k T (R_\mathrm{s} \parallel R_\mathrm{p}) = (g_\mathrm{m}R_\mathrm{D})^2 \cdot 4 k T (R_\mathrm{s} \parallel R_\mathrm{p})
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\overline{I_\mathrm{n,out}^2} = 4 k T \gamma g_\mathrm{m}+ \frac{4 k T}{R_\mathrm{D}}
\]</span> <span class="math display">\[
\overline{V_\mathrm{n,out,2}^2} = R_\mathrm{D}^2 \cdot \overline{I_\mathrm{n,out}^2} = 4 k T \gamma g_\mathrm{m}R_\mathrm{D}^2 + 4 k T R_\mathrm{D}
\]</span></p>
<p>so that in total</p>
<p><span id="eq-lna-naive-noise-total"><span class="math display">\[
\overline{V_\mathrm{n,out}^2} = \overline{V_\mathrm{n,out,1}^2} + \overline{V_\mathrm{n,out,2}^2} = 4 k T \left[ (g_\mathrm{m}R_\mathrm{D})^2 (R_\mathrm{s} \parallel R_\mathrm{p}) + \gamma g_\mathrm{m}R_\mathrm{D}^2 + R_\mathrm{D} \right].
\tag{25}\]</span></span></p>
<p>We now need to find the output noise coming from the source only. For this we can use the equivalent circuit in <a href="#fig-lna-naive-noise-input" class="quarto-xref">Figure&nbsp;30</a>, to formulate the output noise due to the source only.</p>
<div id="cell-fig-lna-naive-noise-input" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display">
<div id="fig-lna-naive-noise-input" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-naive-noise-input-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-naive-noise-input-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-30" title="Figure&nbsp;30: Eqivalent circuit to calculate the output noise from the input."><img src="rfic_files/figure-html/fig-lna-naive-noise-input-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-naive-noise-input-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Eqivalent circuit to calculate the output noise from the input.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We find that</p>
<p><span id="eq-lna-naive-noise-input"><span class="math display">\[
\overline{V_\mathrm{n,out,s}^2} = A_\mathrm{v}^2 \cdot 4 k T R_\mathrm{s} \cdot \left(\frac{R_\mathrm{p}}{R_\mathrm{s} + R_\mathrm{p}}{} \right)^2.
\tag{26}\]</span></span></p>
<p>Finally, we can use <a href="#eq-lna-naive-noise-total" class="quarto-xref">Equation&nbsp;25</a> and <a href="#eq-lna-naive-noise-input" class="quarto-xref">Equation&nbsp;26</a> with <a href="#eq-lna-noise-factor" class="quarto-xref">Equation&nbsp;24</a> to calculate the noise figure of the simple resistively matched common-source LNA as</p>
<p><span id="eq-lna-naive-noise-factor"><span class="math display">\[
F = \frac{\overline{V_\mathrm{n,out}^2}}{\overline{V_\mathrm{n,out,s}^2}} = 1 + \frac{R_\mathrm{s}}{R_\mathrm{p}} + \frac{\gamma R_\mathrm{s}}{g_\mathrm{m}(R_\mathrm{s} \parallel R_\mathrm{p})^2} + \frac{R_\mathrm{s}}{g_\mathrm{m}^2 (R_\mathrm{s} \parallel R_\mathrm{p})^2 R_\mathrm{D}}.
\tag{27}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Common-source LNA with Resistive Matching
</div>
</div>
<div class="callout-body-container callout-body">
<p>As an exercise to calculate circuits with noise, re-confirm and derive yourself the result of <a href="#eq-lna-naive-noise-factor" class="quarto-xref">Equation&nbsp;27</a>.</p>
</div>
</div>
<p>How can we interpret <a href="#eq-lna-naive-noise-factor" class="quarto-xref">Equation&nbsp;27</a>? We see that we can minimize the noise factor by making <span class="math inline">\(g_\mathrm{m}\)</span> large. Then we have a noise factor of</p>
<p><span class="math display">\[
F = 1 + \frac{R_\mathrm{s}}{R_\mathrm{p}} = 2
\]</span></p>
<p>so we see that we are limited to a minimum noise figure of 3 dB, even if we spend the bias current to make <span class="math inline">\(g_\mathrm{m}\)</span> very large. We can go below 3 dB noise figure only if we choose <span class="math inline">\(R_\mathrm{p} &gt; R_\mathrm{s}\)</span>, however, this means that the input is no longer matched to 50 Ω, which is usually not acceptable. Hence, this simple resistively matched common-source LNA is not a good choice for a low-noise amplifier, with one exception: For very wideband amplifiers, where a NF of larger than 3 dB is acceptable, this configuration might be a good choice.</p>
<p>We see that we are stuck at high noise figures if we realize the real part of the input impedance with a resistor. This leaves us with the question of how to realize a real part of the input impedance then. We will answer this question in the next section.</p>
</section>
<section id="sec-lna-common-gate" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-lna-common-gate"><span class="header-section-number">4.2</span> Common-Gate LNA</h2>
<p>We remember from our <a href="https://iic-jku.github.io/analog-circuit-design/analog_circuit_design.html">analog circuit design lecture</a> that the common-gate configuration has an input impedance of <span class="math inline">\(1/g_\mathrm{m}\)</span>, neglecting parasitic capacitances. Hence, if we choose <span class="math inline">\(g_\mathrm{m}= 1/50\,\Omega = 20\,\text{mS}\)</span>, we can achieve input matching to 50 Ω without using a resistor at the input. This is the key idea of the common-gate LNA, which is shown in <a href="#fig-lna-cg" class="quarto-xref">Figure&nbsp;31</a>.</p>
<div id="cell-fig-lna-cg" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display">
<div id="fig-lna-cg" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-cg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-cg-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="Figure&nbsp;31: Circuit diagram of a common-gate LNA."><img src="rfic_files/figure-html/fig-lna-cg-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-cg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;31: Circuit diagram of a common-gate LNA.
</figcaption>
</figure>
</div>
</div>
</div>
<p>By inspecting <a href="#fig-lna-cg" class="quarto-xref">Figure&nbsp;31</a> and following the practice from <a href="#sec-lna-resistive-matching" class="quarto-xref">Section&nbsp;4.1</a>, we can directly write down the output noise voltage as (with <span class="math inline">\(1/g_\mathrm{m}= R_\mathrm{s}\)</span>)</p>
<p><span id="eq-lna-cg-noise-total"><span class="math display">\[
\overline{V_\mathrm{n,out}^2} = k T \left[ (g_\mathrm{m}R_\mathrm{D})^2 R_\mathrm{s} + \gamma g_\mathrm{m}R_\mathrm{D}^2 + 4 R_\mathrm{D} \right] = k T \left( \frac{R_\mathrm{D}^2}{R_\mathrm{s}} + \gamma \frac{R_\mathrm{D}^2}{R_\mathrm{s}} + 4 R_\mathrm{D} \right).
\tag{28}\]</span></span></p>
<p>The output noise due to the source only is given by</p>
<p><span id="eq-lna-cg-noise-source"><span class="math display">\[
\overline{V_\mathrm{n,out,s}^2} = \frac{R_\mathrm{D}^2}{R_\mathrm{s}}.
\tag{29}\]</span></span></p>
<p>Finally, we can use <a href="#eq-lna-cg-noise-total" class="quarto-xref">Equation&nbsp;28</a> and <a href="#eq-lna-cg-noise-source" class="quarto-xref">Equation&nbsp;29</a> with <a href="#eq-lna-noise-factor" class="quarto-xref">Equation&nbsp;24</a> to calculate the noise figure of the common-gate LNA as</p>
<p><span id="eq-lna-cg-noise-factor"><span class="math display">\[
F = 1 + \gamma + \frac{4 R_\mathrm{s}}{R_\mathrm{D}}  \xrightarrow{R_\mathrm{D} \gg R_\mathrm{s}} F = 1 + \gamma .
\tag{30}\]</span></span></p>
<p>With a classical long-channel <span class="math inline">\(\gamma = 2/3\)</span>, we can achieve a minimum noise figure of 2.2 dB, which is already better than the resistively matched common-source LNA. However, with modern short-channel devices, <span class="math inline">\(\gamma\)</span> is often larger than 1, so that the minimum noise figure of the common-gate LNA is often larger than 3 dB <span class="citation" data-cites="Razavi_RFIC">(<a href="#ref-Razavi_RFIC" role="doc-biblioref">Behzad Razavi 2011</a>)</span>.</p>
</section>
<section id="sec-lna-inductive-degeneration" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-lna-inductive-degeneration"><span class="header-section-number">4.3</span> Inductively-Degenerated Common-Source LNA</h2>
<p>As we have seen in <a href="#sec-lna-common-gate" class="quarto-xref">Section&nbsp;4.2</a>, using circuit techniques can realize a real part of an input impedance without the associated thermal noise of a resistor. We now try something different, in the hope that it will result in an even lower noise figure. We construct an LNA based on a common-source MOSFET amplifier, but we add an impedance <span class="math inline">\(Z_\mathrm{deg}\)</span> into the source line. This arrangement is shown in <a href="#fig-lna-inductive-degeneration" class="quarto-xref">Figure&nbsp;32</a>.</p>
<div id="cell-fig-lna-inductive-degeneration" class="cell" data-execution_count="32">
<div class="cell-output cell-output-display">
<div id="fig-lna-inductive-degeneration" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-inductive-degeneration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-inductive-degeneration-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-32" title="Figure&nbsp;32: A common-source MOSFET stage with degeneration impedance."><img src="rfic_files/figure-html/fig-lna-inductive-degeneration-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-inductive-degeneration-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32: A common-source MOSFET stage with degeneration impedance.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We now extract the small-signal equivalent circuit of <a href="#fig-lna-inductive-degeneration" class="quarto-xref">Figure&nbsp;32</a>, which is shown in <a href="#fig-lna-inductive-degeneration-zin" class="quarto-xref">Figure&nbsp;33</a>, to calculate the input impedance.</p>
<div id="cell-fig-lna-inductive-degeneration-zin" class="cell" data-execution_count="33">
<div class="cell-output cell-output-display">
<div id="fig-lna-inductive-degeneration-zin" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-inductive-degeneration-zin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-inductive-degeneration-zin-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-33" title="Figure&nbsp;33: Equivalent small-signal circuit of the input stage around M_1."><img src="rfic_files/figure-html/fig-lna-inductive-degeneration-zin-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-inductive-degeneration-zin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33: Equivalent small-signal circuit of the input stage around <span class="math inline">\(M_1\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We find that</p>
<p><span class="math display">\[
V_\mathrm{x} = V_\mathrm{gs}+ Z_\mathrm{deg} (I_\mathrm{x} + g_\mathrm{m}V_\mathrm{gs}), \quad V_\mathrm{gs}= \frac{I_\mathrm{x}}{s C_\mathrm{gs}}
\]</span></p>
<p>so that we can write the input impedance as</p>
<p><span id="eq-lna-inductive-degeneration-zin"><span class="math display">\[
Z_\mathrm{in} = \frac{V_\mathrm{x}}{I_\mathrm{x}} = \frac{1}{s C_\mathrm{gs}} + Z_\mathrm{deg} + \frac{g_\mathrm{m}Z_\mathrm{deg}}{s C_\mathrm{gs}}.
\tag{31}\]</span></span></p>
<p>The final term in <a href="#eq-lna-inductive-degeneration-zin" class="quarto-xref">Equation&nbsp;31</a> is the interesting one: By choosing <span class="math inline">\(Z_\mathrm{deg}\)</span> to be inductive (which we can do by either use an on-chip or off-chip inductor), we can realize a real part of the input impedance. If we choose <span class="math inline">\(Z_\mathrm{deg} = s L\)</span>, we find that</p>
<p><span class="math display">\[
Z_\mathrm{in} = \frac{1}{s C_\mathrm{gs}} + s L + \frac{g_\mathrm{m}L}{C_\mathrm{gs}}.
\]</span></p>
<p>By proper choice of <span class="math inline">\(L\)</span> and <span class="math inline">\(C_\mathrm{gs}\)</span>, we can achieve input matching to 50 Ω at the desired frequency <span class="math inline">\(\omega_0\)</span>. We find that the real part of the input impedance is given by</p>
<p><span class="math display">\[
\Re \{ Z_\mathrm{in} \} = \frac{g_\mathrm{m}L}{C_\mathrm{gs}}
\]</span></p>
<p>Without proof (refer to <span class="citation" data-cites="Razavi_RFIC">(<a href="#ref-Razavi_RFIC" role="doc-biblioref">Behzad Razavi 2011</a>)</span> or <span class="citation" data-cites="Darabi_RFIC">(<a href="#ref-Darabi_RFIC" role="doc-biblioref">Darabi 2020</a>)</span> for a derivation) we find for the noise factor of this input stage (with some simplification) as</p>
<p><span id="eq-lna-inductive-degeneration-noise-factor"><span class="math display">\[
F = 1 + \frac{\gamma R_\mathrm{s} \omega_0^2 C_\mathrm{gs}^2}{g_\mathrm{m}}.
\tag{32}\]</span></span></p>
<p>Finally, we have an LNA input stage configuration that allows us to achieve a noise figure below 3 dB, even with <span class="math inline">\(\gamma &gt; 1\)</span>, by proper choice of <span class="math inline">\(g_\mathrm{m}\)</span>. Making <span class="math inline">\(g_\mathrm{m}\)</span> large (by spending more bias current) results in (to first order) arbitrarily low noise figure. The inductively-degenerated common-source LNA is a widely used LNA input stage configuration in modern RFICs. A somewhat detailed schematic is shown in <a href="#fig-lna-inductive-degeneration-detailed" class="quarto-xref">Figure&nbsp;34</a>.</p>
<div id="cell-fig-lna-inductive-degeneration-detailed" class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<div id="fig-lna-inductive-degeneration-detailed" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-inductive-degeneration-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-inductive-degeneration-detailed-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-34" title="Figure&nbsp;34: An (almost complete) common-source MOSFET stage with degeneration impedance and cascode."><img src="rfic_files/figure-html/fig-lna-inductive-degeneration-detailed-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-inductive-degeneration-detailed-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;34: An (almost complete) common-source MOSFET stage with degeneration impedance and cascode.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The inductor <span class="math inline">\(L_\mathrm{match}\)</span> is used to match the input impedance to 50 Ω at the desired frequency, <span class="math inline">\(L_\mathrm{deg}\)</span> is used to realize the real part of the input impedance, <span class="math inline">\(R_\mathrm{bias}\)</span> is used to set the bias current of <span class="math inline">\(M_1\)</span>, <span class="math inline">\(M_2\)</span> is a cascode transistor which increases the output impedance and thus the gain of the stage (plus it improves the reverse isolation), and <span class="math inline">\(R_\mathrm{D}\)</span>, <span class="math inline">\(L_\mathrm{D}\)</span>, and <span class="math inline">\(C_\mathrm{D}\)</span> form a load tank which provides high gain at the desired frequency. A dc block is used at the input so that the bias point of <span class="math inline">\(M_1\)</span> is not corrupted by the input signal source. The bias voltage <span class="math inline">\(V_\mathrm{bias2}\)</span> sets the operating point of the cascode transistor <span class="math inline">\(M_2\)</span>.</p>
<p>What is missing in <a href="#fig-lna-inductive-degeneration-detailed" class="quarto-xref">Figure&nbsp;34</a> is any form of frequency tuning of the load to the frequency of interest, and the support of different gain modes. Apart from these details this LNA circuit is a good starting point for a practical LNA design.</p>
</section>
<section id="sec-lna-feedback" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-lna-feedback"><span class="header-section-number">4.4</span> Feedback LNA</h2>
<p>One drawback of the inductively-degenerated common-source LNA is the usage of at least one inductor. If the inductor is placed on-chip, it has a comparatively large size, and if it is implemented in the package (via a bondwire) or on the PCB, it adds to the bill-of-materials (BOM) cost.</p>
<p>If the CMOS technology is sufficiently fast, a shunt feedback LNA, as shown in <a href="#fig-lna-shunt-fb" class="quarto-xref">Figure&nbsp;35</a>, might be a good choice.</p>
<div id="cell-fig-lna-shunt-fb" class="cell" data-execution_count="35">
<div class="cell-output cell-output-display">
<div id="fig-lna-shunt-fb" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lna-shunt-fb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lna-shunt-fb-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-35" title="Figure&nbsp;35: A shunt-feedback LNA."><img src="rfic_files/figure-html/fig-lna-shunt-fb-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lna-shunt-fb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;35: A shunt-feedback LNA.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Without proof, the input impedance of the shunt feedback LNA is given by</p>
<p><span id="eq-lna-shunt-fb-zin"><span class="math display">\[
Z_\mathrm{in} = \frac{Z_\mathrm{F} + Z_\mathrm{L}}{1 + g_\mathrm{m}Z_\mathrm{L}}.
\tag{33}\]</span></span></p>
<p>The noise factor of the shunt feedback LNA is given by</p>
<p><span id="eq-lna-shunt-fb-noise-factor"><span class="math display">\[
F = 1 + \left| \frac{Z_\mathrm{F} + R_\mathrm{s}}{g_\mathrm{m}Z_\mathrm{F} + 1} \right|^2 \cdot \frac{\gamma g_\mathrm{m}+ \Re \{ Y_\mathrm{L} \} }{\Re \{ Z_\mathrm{in} \}}
\tag{34}\]</span></span></p>
<p>As you can see from <a href="#eq-lna-shunt-fb-noise-factor" class="quarto-xref">Equation&nbsp;34</a>, by making <span class="math inline">\(g_\mathrm{m}\)</span> large (by spending more bias current) the noise figure can be made arbitrarily small! Depending on the choice of <span class="math inline">\(Z_\mathrm{F}\)</span> and <span class="math inline">\(Z_\mathrm{L}\)</span>, the input impedance of this LNA can be changed in interesting ways.</p>
<p>By setting <span class="math inline">\(Z_\mathrm{L} \rightarrow \infty\)</span> (e.g., by biasing with a current source and high-impedance loading), we find that</p>
<p><span class="math display">\[
Z_\mathrm{in} = \frac{1}{g_\mathrm{m}}
\]</span></p>
<p>which is independent of <span class="math inline">\(Z_\mathrm{F}\)</span> and is a well-known result for a common-source stage. The disadvantage of this configuration is the noise factor, which (given that <span class="math inline">\(Z_\mathrm{F}\)</span> is sufficiently large) tends to <span class="math inline">\(F = 1 + \gamma\)</span>, which is the same as for the common-gate LNA.</p>
<p>A bit more interesting is the case when <span class="math inline">\(g_\mathrm{m}Z_\mathrm{L} = A_0\)</span> and <span class="math inline">\(Z_\mathrm{L} \gg Z_\mathrm{F}\)</span>, which results in</p>
<p><span class="math display">\[
Z_\mathrm{in} = \frac{Z_\mathrm{L}}{1 + A_0}
\]</span></p>
<p>which is the well-known result that the input impedance of an amplifier with feedback is reduced by the factor <span class="math inline">\(1 + A_0\)</span>, where <span class="math inline">\(A_0\)</span> is the open-loop gain of the amplifier. The noise factor can be made small by making <span class="math inline">\(g_\mathrm{m}\)</span> large, as we have already noted above.</p>
<p>A very interesting case can be achieved by choosing <span class="math inline">\(Z_\mathrm{L} = 1 / s C_\mathrm{L}\)</span> and <span class="math inline">\(Z_\mathrm{F} = 1 / s C_\mathrm{F}\)</span>, which results in</p>
<p><span id="eq-lna-shunt-fb-yin"><span class="math display">\[
Y_\mathrm{in} = \frac{1}{Z_\mathrm{in}} = \frac{g_\mathrm{m}C_\mathrm{F}}{C_\mathrm{L} + C_\mathrm{F}} + s \frac{C_\mathrm{L} C_\mathrm{F}}{C_\mathrm{L} + C_\mathrm{F}}
\tag{35}\]</span></span></p>
<p>Looking at <a href="#eq-lna-shunt-fb-yin" class="quarto-xref">Equation&nbsp;35</a>, we see that the input admittance has a <strong>real part</strong>! By proper choice of components, we can achieve an input impedance matched to 50 Ω at the desired frequency. The noise factor can again be made small by making <span class="math inline">\(g_\mathrm{m}\)</span> large.</p>
<p>There is also an option, by proper choice of <span class="math inline">\(Z_\mathrm{F}\)</span> and <span class="math inline">\(Z_\mathrm{L}\)</span>, to achieve an inductive input impedance component, which can be used to resonate out the input capacitance of the LNA, similar to the inductively-degenerated common-source LNA. However, in contrast to the inductively-degenerated common-source LNA, no inductor is required in this case. This configuration is called a reactance-canceling LNA.</p>
</section>
</section>
<section id="sec-mixer" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Mixers</h1>
<p>As we have seen in <a href="#sec-trx-mod-demod" class="quarto-xref">Section&nbsp;3.2</a>, we are using mixers to “upconvert” and “downconvert” signals, i.e., we shift the frequency of a signal to a higher or lower frequency with the help of an auxiliary signal, called the “<strong>local oscillator</strong>” (LO) signal. The block diagram of a mixer is shown in <a href="#fig-mixer-block" class="quarto-xref">Figure&nbsp;37</a>.</p>
<div id="cell-fig-mixer-square" class="cell" data-execution_count="36">
<div class="cell-output cell-output-display">
<div id="fig-mixer-square" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mixer-square-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-mixer-square-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-36" title="Figure&nbsp;36: A squarer as a nonlinear mixer."><img src="rfic_files/figure-html/fig-mixer-square-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mixer-square-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36: A squarer as a nonlinear mixer.
</figcaption>
</figure>
</div>
</div>
</div>
<p>What we usually want in a mixer is that the input signal at <span class="math inline">\(\omega_\mathrm{in}\)</span> is shifted by <span class="math inline">\(\omega_\mathrm{LO}\)</span>, so that the output signal is located at</p>
<p><span class="math display">\[
\omega_\mathrm{out} = \omega_\mathrm{in} \pm \omega_\mathrm{LO}.
\]</span></p>
<p>It should be noted that the output signal usually contains additional frequency components, which are not desired. These so-called “<strong>spurious</strong>” components are usually filtered out in a subsequent filtering stage.</p>
<p>Recalling the properties of <a href="https://en.wikipedia.org/wiki/Linear_time-invariant_system">linear time-invariant (LTI)</a> systems, we know that in an LTI system <em>no new frequency components</em> (which are not already present in the input signal) are generated. In conclusion, in order to generate new frequency components, a mixer has to be either</p>
<ul>
<li>a <strong>non-linear</strong> system, or</li>
<li>a <strong>time-variant</strong> system.</li>
</ul>
<p>Next we will look at two options on how to implement a mixer.</p>
<section id="sec-mixer-nonlinear" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sec-mixer-nonlinear"><span class="header-section-number">5.1</span> Non-Linear Mixer</h2>
<p>Generally speaking, we can use any non-linear device to implement a mixer (often, this generation of new frequency components in a nonlinear system is highly undesired; in a mixer, we want this effect). As a simple example we look at the case of a square function, shown in <a href="#fig-mixer-square" class="quarto-xref">Figure&nbsp;36</a>.</p>
<div id="cell-fig-mixer-block" class="cell" data-execution_count="37">
<div class="cell-output cell-output-display">
<div id="fig-mixer-block" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mixer-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-mixer-block-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-37" title="Figure&nbsp;37: Mixer block diagram."><img src="rfic_files/figure-html/fig-mixer-block-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mixer-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;37: Mixer block diagram.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When we apply the sum of the signals <span class="math inline">\(s_\mathrm{in}(t) = \cos( \omega_\mathrm{in} t)\)</span> and <span class="math inline">\(s_\mathrm{LO}(t) = \cos(\omega_\mathrm{LO} t)\)</span> to the input of a squarer, we get the output signal</p>
<p><span id="eq-mixer-square-output"><span class="math display">\[
\begin{split}
s_\mathrm{out}(t) = [ s_\mathrm{in}(t) + s_\mathrm{LO}(t) ]^2 &amp;= \cos(\omega_\mathrm{in} t + \omega_\mathrm{LO} t) + \cos(\omega_\mathrm{in} t - \omega_\mathrm{LO} t) \\
&amp;+ 1 + \frac{1}{2} \cos(2 \omega_\mathrm{in} t) + \frac{1}{2} \cos(2 \omega_\mathrm{LO} t).
\end{split}
\tag{36}\]</span></span></p>
<p>We see that the output signal contains the desired frequency components at <span class="math inline">\(\omega_\mathrm{in} \pm \omega_\mathrm{LO}\)</span>, but also additional components at dc (0 Hz), <span class="math inline">\(2 \omega_\mathrm{in}\)</span>, and <span class="math inline">\(2 \omega_\mathrm{LO}\)</span>. These additional components are usually unwanted and have to be filtered out in a subsequent filtering stage. As a side-note, in some circuits a <strong>frequency doubler</strong> is desired, which can be implemented by simply filtering out the other frequency components. In a doubler no LO signal is required, as the input signal is simply squared.</p>
<p>A simple example circuit is a diode, which has a non-linear current-voltage characteristic. The block diagram of a simple diode mixer is shown in <a href="#fig-diode-mixer" class="quarto-xref">Figure&nbsp;38</a>.</p>
<div id="cell-fig-diode-mixer" class="cell" data-execution_count="38">
<div class="cell-output cell-output-display">
<div id="fig-diode-mixer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diode-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-diode-mixer-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-38" title="Figure&nbsp;38: A diode mixer."><img src="rfic_files/figure-html/fig-diode-mixer-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diode-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;38: A diode mixer.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This structure is conceptionally simple, it just requires a (fast) diode, filters to couple the desired frequency components in and out, and an RF choke to provide a dc bias voltage for the diode. However, the performance of such a simple mixer is usually not very good, as the diode is a highly non-linear device, which generates many spurious frequency components. More advanced mixer circuits use more complex non-linear devices (for example, a ring of diodes) to improve the performance. The advantage of these mixers is that they can operate up to very high frequencies (in the mm-wave range and beyond). If you can make a nonlinear device, you can make a mixer (think also of <a href="https://en.wikipedia.org/wiki/Nonlinear_optics">nonlinear optics</a>, for example).</p>
</section>
<section id="sec-mixer-time-variant" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sec-mixer-time-variant"><span class="header-section-number">5.2</span> Time-Variant Mixer</h2>
<p>In contrast to the non-linear mixer, a time-variant mixer uses an ideally <strong>linear</strong> device, but changes its properties over time. A simple example is a switch, which is opened and closed at the LO frequency. The block diagram of such a mixer is shown in <a href="#fig-switch-mixer" class="quarto-xref">Figure&nbsp;39</a>. This system is ideally linear from input to output, but very nonlinear when considering the LO input.</p>
<div id="cell-fig-switch-mixer" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<div id="fig-switch-mixer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-switch-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-switch-mixer-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-39" title="Figure&nbsp;39: A switch as a time-variant mixer."><img src="rfic_files/figure-html/fig-switch-mixer-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-switch-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;39: A switch as a time-variant mixer.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When the switch is closed (<span class="math inline">\(s_\mathrm{LO} \ge 0\)</span>), the input signal is passed to the output, i.e., <span class="math inline">\(s_\mathrm{out}(t) = s_\mathrm{in}(t)\)</span>; when the switch is open (<span class="math inline">\(s_\mathrm{LO} &lt; 0\)</span>), no signal is passed, i.e., <span class="math inline">\(s_\mathrm{out}(t) = 0\)</span>. The output signal can be expressed as</p>
<p><span class="math display">\[
s_\mathrm{out}(t) = s_\mathrm{in}(t) \cdot \frac{1}{2} \left\{ 1 + \mathrm{sgn}[ s_\mathrm{LO}(t) ] \right\},
\]</span></p>
<p>where <span class="math inline">\(\mathrm{sgn}(\cdot)\)</span> is the sign function. The term in curly brackets is a square wave that switches between 0 and 1 at the LO frequency. This square wave can be expressed as a Fourier series, which contains the fundamental frequency at <span class="math inline">\(\omega_\mathrm{LO}\)</span> and all odd harmonics <span class="math inline">\(3 \omega_\mathrm{LO}\)</span>, <span class="math inline">\(5 \omega_\mathrm{LO}\)</span>, and so on. In conclusion, if the input signal is expressed as <span class="math inline">\(\cos(\omega_\mathrm{in} t)\)</span>, we get the output signal</p>
<p><span id="eq-mixer-single-output"><span class="math display">\[
s_\mathrm{out}(t) = \frac{1}{\pi} \cos(\omega_\mathrm{in} t \pm \omega_\mathrm{LO} t) + \ldots
\tag{37}\]</span></span></p>
<p>Again, we see that the output signal contains the desired frequency components at <span class="math inline">\(\omega_\mathrm{in} \pm \omega_\mathrm{LO}\)</span>, but also additional components at <span class="math inline">\(3 \omega_\mathrm{LO}\)</span>, <span class="math inline">\(5 \omega_\mathrm{LO}\)</span>, and so on. These additional components are usually unwanted and have to be filtered out in a subsequent filtering stage. The advantage of a time-variant mixer is that it can be implemented readily in CMOS, as shown in <a href="#fig-cmos-single-mixer" class="quarto-xref">Figure&nbsp;40</a>.</p>
<div id="cell-fig-cmos-single-mixer" class="cell" data-execution_count="40">
<div class="cell-output cell-output-display">
<div id="fig-cmos-single-mixer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cmos-single-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-cmos-single-mixer-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-40" title="Figure&nbsp;40: A MOSFET as a switch used as a mixer, with ac-coupled LO signal."><img src="rfic_files/figure-html/fig-cmos-single-mixer-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cmos-single-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40: A MOSFET as a switch used as a mixer, with ac-coupled LO signal.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The implementation in <a href="#fig-cmos-single-mixer" class="quarto-xref">Figure&nbsp;40</a> uses a single NMOS transistor as a switch. The LO signal is ac-coupled to the gate of the transistor, so that the dc operating point is set by the bias voltage <span class="math inline">\(V_\mathrm{bias}\)</span>. When the LO signal is high enough, the transistor is switched on and the input signal <span class="math inline">\(v_\mathrm{in}(t)\)</span> is passed to the output; when the LO signal is low, the transistor is switched off and no signal is passed. Note that with the MOSFET we can switch voltages as well as currents, so the mixer can work in both modes, voltage mode or current mode.</p>
<p>A big disadvantage of this simple implementation is that the input signal is “lost” for half of the cycle when the MOSFET switch is open. A fully differential implementation (having differential ports at input, output and LO input) can alleviate this problem, as the input signal is always connected to one of the two output ports. This configuration is called a “<strong>double-balanced mixer</strong>” and is widely used in practice. It is shown in <a href="#fig-cmos-double-mixer" class="quarto-xref">Figure&nbsp;41</a>.</p>
<div id="cell-fig-cmos-double-mixer" class="cell" data-execution_count="41">
<div class="cell-output cell-output-display">
<div id="fig-cmos-double-mixer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cmos-double-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-cmos-double-mixer-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-41" title="Figure&nbsp;41: A fully-differential double-balanced MOSFET mixer."><img src="rfic_files/figure-html/fig-cmos-double-mixer-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cmos-double-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;41: A fully-differential double-balanced MOSFET mixer.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that with a double-balanced mixer, we have 6 dB more conversion gain compared to the single-balanced mixer (refer to <a href="#eq-mixer-single-output" class="quarto-xref">Equation&nbsp;37</a>), as can be seen in <a href="#eq-mixer-double-output" class="quarto-xref">Equation&nbsp;38</a>. Note that the factor of <span class="math inline">\(2/\pi\)</span> represents the conversion loss of an ideal double-balanced mixer of 3.9 dB.</p>
<p><span id="eq-mixer-double-output"><span class="math display">\[
s_\mathrm{out}(t) = \frac{2}{\pi} \cos(\omega_\mathrm{in} t \pm \omega_\mathrm{LO} t) + \ldots
\tag{38}\]</span></span></p>
<p>Note that no dc current needs to flow through the mixer structures shown in <a href="#fig-cmos-single-mixer" class="quarto-xref">Figure&nbsp;40</a> and <a href="#fig-cmos-double-mixer" class="quarto-xref">Figure&nbsp;41</a>, which is a huge advantage when thinking of flicker noise. Flicker noise in a MOSFET is proportional to the dc current flowing through the device, so if no dc current flows, no flicker noise is generated!</p>
<p>In order to look at the full picture, we embed the mixer of <a href="#fig-cmos-double-mixer" class="quarto-xref">Figure&nbsp;41</a> in a complete RX front-end, as shown in <a href="#fig-rx-mixer-simplified" class="quarto-xref">Figure&nbsp;42</a>. An LNA (essentially a <span class="math inline">\(g_\mathrm{m}\)</span> cell) creates a current signal from the received voltage signal at the antenna. This current signal is then fed to the mixer in the current domain, and further sinked into a transimpedance amplifier (TIA), which also implements a lowpass pole. The simplified circuit is shown in <a href="#fig-rx-mixer-simplified" class="quarto-xref">Figure&nbsp;42</a>.</p>
<div id="cell-fig-rx-mixer-simplified" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display">
<div id="fig-rx-mixer-simplified" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rx-mixer-simplified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-rx-mixer-simplified-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-42" title="Figure&nbsp;42: An RX front-end using a current-mode (passive) mixer."><img src="rfic_files/figure-html/fig-rx-mixer-simplified-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rx-mixer-simplified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;42: An RX front-end using a current-mode (passive) mixer.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The capacitors connected directly to ground at the mixer outputs are good practice, as they shunt high-frequency switching noise to ground, and in this way help the performance of the TIA, which otherwise would have to sink these currents. Note that all blocker currents originating at the LNA output and passing through the mixer are shunt by the feedback capacitors to the output of the TIA, and need to be actively driven by the TIA’s output stage!</p>
</section>
<section id="sec-mixer-gilbert" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="sec-mixer-gilbert"><span class="header-section-number">5.3</span> Gilbert Cell Mixer</h2>
<p>As we have seen in <a href="#sec-mixer-time-variant" class="quarto-xref">Section&nbsp;5.2</a>, in CMOS we have quite a few options to implement a mixer as the MOSFET is a good current and voltage switch. This is in stark contrast to the BJT, as the bipolar transistor can only be used as an (excellent) current switch in the differential pair configuration. Hence, we need to implement a current-mode mixer in bipolar technology. The most widely used structure is the so-called “<strong>Gilbert cell</strong>”, shown in <a href="#fig-gilbert-mixer" class="quarto-xref">Figure&nbsp;43</a>.</p>
<div id="cell-fig-gilbert-mixer" class="cell" data-execution_count="43">
<div class="cell-output cell-output-display">
<div id="fig-gilbert-mixer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gilbert-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-gilbert-mixer-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-43" title="Figure&nbsp;43: A Gilbert mixer based on bipolar differential pairs."><img src="rfic_files/figure-html/fig-gilbert-mixer-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gilbert-mixer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;43: A Gilbert mixer based on bipolar differential pairs.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The idea is that an input transconductor creates currents, which are switched in the double differential pair, and converts the mixed currents back to voltage in the load impedances. There are many known variations of this circuit, like skipping the current source at the bottom to increase linearity and headroom, or swap the input transconductor for another structure. It might also be useful to “bleed” some bias current from the LO switching stage to improve noise.</p>
</section>
<section id="sec-mixer-npath" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="sec-mixer-npath"><span class="header-section-number">5.4</span> N-Path Filter</h2>
<p>Without much deliberation or diving into the background, it has to be stated that passive mixers (based on MOSFET switches) have a few very interesting properties. One of them is that they can be used to implement very high-quality bandpass filters, called “<strong>N-path filters</strong>” <span class="citation" data-cites="Lepage.1953">(<a href="#ref-Lepage.1953" role="doc-biblioref">Lepage, Cahn, and Brown 1953</a>)</span>. The basic idea is shown in <a href="#fig-npath-filter" class="quarto-xref">Figure&nbsp;44</a>. We use 4 phases of an LO signal to switch the 4 capacitors to ground in a round-robin fashion. The duty cycle of each LO phase is 25% to have a non-overlapping clock.</p>
<div id="cell-fig-npath-filter" class="cell" data-execution_count="44">
<div class="cell-output cell-output-display">
<div id="fig-npath-filter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-npath-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-npath-filter-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-44" title="Figure&nbsp;44: A 4-phase N-path filter."><img src="rfic_files/figure-html/fig-npath-filter-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-npath-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44: A 4-phase N-path filter.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The key observation to make is that a switch that is opened and closed at a certain frequency (the LO frequency) can be seen as a time-variant resistor. This time-variant resistor converts impedance seen at one one to the other end, and also changes the frequency of this apparent impedance. In other words, if we connect grounded capacitors at one end of the mixer switches and look into the other end, we see a <strong>bandpass filter centered at the LO</strong> frequency! In this way we can build bandpass filters (and also bandstop filters <span class="citation" data-cites="Vazny.2010">(<a href="#ref-Vazny.2010" role="doc-biblioref">Vazny et al. 2010</a>)</span>) at very high frequencies which are precisely centered (without component variations) around <span class="math inline">\(\omega_\mathrm{LO}\)</span>.</p>
<p>The impedance characteristics of such a tank circuit exhibit first-order bandpass behavior, as shown in <a href="#fig-tank-bandpass" class="quarto-xref">Figure&nbsp;45</a>. The peak impedance reaches 5.3 times the switch resistance (<span class="math inline">\(R_\mathrm{sw}\)</span>), and importantly, the bandwidth is inversely proportional to the capacitance value, i.e., <span class="math inline">\(\mathrm{BW} \propto 1/C\)</span>. This relationship allows for precise control of the filter bandwidth by adjusting the capacitor values.</p>
<div id="cell-fig-tank-bandpass" class="cell" data-execution_count="45">
<div class="cell-output cell-output-display">
<div id="fig-tank-bandpass" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tank-bandpass-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-tank-bandpass-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45" title="Figure&nbsp;45: First-order bandpass behavior and impedance of an N-path filter."><img src="rfic_files/figure-html/fig-tank-bandpass-output-1.png" width="656" height="465" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tank-bandpass-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;45: First-order bandpass behavior and impedance of an N-path filter.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-mixer-lo" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="sec-mixer-lo"><span class="header-section-number">5.5</span> LO Generation</h2>
<p>As you have seen in <a href="#sec-trx-mod-demod" class="quarto-xref">Section&nbsp;3.2</a>, for complex-valued modulation schemes (like QPSK, QAM, OFDM, and so on) we need to generate quadrature LO signals (i.e., two LO signals with a 90° phase shift). There are many ways to generate such signals, and we will now study a few of them.</p>
<section id="sec-lo-rc" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="sec-lo-rc"><span class="header-section-number">5.5.1</span> RC/CR Phase Shift Network</h3>
<p>The probably simplest way to generate quadrature LO signals is to use a simple RC/CR phase shift network, as shown in <a href="#fig-rc-cr-phase-shift" class="quarto-xref">Figure&nbsp;46</a>. The RC network (a first-order lowpass) generates a phase shift between 0° and -90°, while the CR network (a first-order highpass) generates a phase shift between 0° and +90°. By operating the network at <span class="math inline">\(\omega_0 = 1/RC\)</span>, we can achieve a 90° phase shift between the two outputs.</p>
<div id="cell-fig-rc-cr-phase-shift" class="cell" data-execution_count="46">
<div class="cell-output cell-output-display">
<div id="fig-rc-cr-phase-shift" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rc-cr-phase-shift-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-rc-cr-phase-shift-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-46" title="Figure&nbsp;46: An RC/CR IQ generation network."><img src="rfic_files/figure-html/fig-rc-cr-phase-shift-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rc-cr-phase-shift-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;46: An RC/CR IQ generation network.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The advantage of this network is its simplicity, as it only requires a few passive components, and it can generate I and Q phases from an incoming signal at the target frequency. The disadvantage is that the phase shift is frequency-dependent, so the quadrature signals are only perfectly in phase at one frequency. Furthermore, the amplitude of the two outputs is not equal, which might require additional gain stages to equalize the amplitudes. Additionally, this passive network has a 3 dB loss, so we need additional gain stages to compensate for this loss.</p>
</section>
<section id="sec-lo-polyphase" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="sec-lo-polyphase"><span class="header-section-number">5.5.2</span> Polyphase Filter</h3>
<p>We can create a more advanced phase shift network (following the idea of <a href="#sec-lo-rc" class="quarto-xref">Section&nbsp;5.5.1</a>) by using a so-called “<strong>polyphase filter</strong>” <span class="citation" data-cites="Kaukovuori.2008">(<a href="#ref-Kaukovuori.2008" role="doc-biblioref">Kaukovuori et al. 2008</a>)</span>. The idea is to use multiple RC sections to create a more ideal phase shift network. An example is shown in <a href="#fig-polyphase-filter" class="quarto-xref">Figure&nbsp;47</a>.</p>
<div id="cell-fig-polyphase-filter" class="cell" data-execution_count="47">
<div class="cell-output cell-output-display">
<div id="fig-polyphase-filter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polyphase-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-polyphase-filter-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-47" title="Figure&nbsp;47: A two-stage polyphase network."><img src="rfic_files/figure-html/fig-polyphase-filter-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polyphase-filter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;47: A two-stage polyphase network.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in the figure above, we can use multiple stages (with <span class="math inline">\(R_1 C_1 \ne R_2 C_2\)</span>) in cascade to broaden the frequency range over which we have a good 90° phase shift between the four outputs. The more stages we use, the better the performance, but also the more components are required. Note that this network is still passive, so it has an inherent loss, which also increases with the number of stages. The idea behind this network is that the network is transparent for positive frequencies, and blocks negative frequencies (or vice versa). We enter the network with real signals (having positive and negative frequency components), and at the output we get complex signals (having only positive or negative frequency components). In this sense this network is a complex filter.</p>
<p>Note that polyphase filters are popular when we have to create complex signals from real signals. We can use the polyphase filter in the LO path, or also in the signal path (e.g., in a receiver). The benefit is that we can work with a signal where input frequency is equal to the output frequency. This is in strong contrast to the approach we will discuss next.</p>
</section>
<section id="sec-lo-ff" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="sec-lo-ff"><span class="header-section-number">5.5.3</span> Flip-Flop Based Phase Generation</h3>
<p>The most widely used approach to generate quadrature LO signals is to use digital circuits, as shown in <a href="#fig-iq-divider" class="quarto-xref">Figure&nbsp;48</a>. The idea is to use a flip-flop (or a latch) to divide the frequency of an incoming clock signal by 2. If we drive the two flip-flops (which are connected as toggle flip-flops) by inverted clocks, then the resulting output signals are 90° phase-shifted, as shown in <a href="#fig-ff-phase-diagram" class="quarto-xref">Figure&nbsp;49</a>.</p>
<div id="cell-fig-iq-divider" class="cell" data-execution_count="48">
<div class="cell-output cell-output-display">
<div id="fig-iq-divider" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iq-divider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-iq-divider-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-48" title="Figure&nbsp;48: I/Q generation with a divide-by-2."><img src="rfic_files/figure-html/fig-iq-divider-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iq-divider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;48: I/Q generation with a divide-by-2.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-ff-phase-diagram" class="cell" data-execution_count="49">
<div class="cell-output cell-output-display">
<div id="fig-ff-phase-diagram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ff-phase-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-ff-phase-diagram-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-49" title="Figure&nbsp;49: Input and output waveforms of I/Q generation with a divide-by-2."><img src="rfic_files/figure-html/fig-ff-phase-diagram-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ff-phase-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;49: Input and output waveforms of I/Q generation with a divide-by-2.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is important to note that the circuit shown in <a href="#fig-iq-divider" class="quarto-xref">Figure&nbsp;48</a> has to be implemented in a way so that there is no phase ambiguity, i.e., the I-phase is lagging the Q-phase by exactly 90°. This can be achieved by using a reset signal to set the flip-flops to a known state at startup, or by implementing flip-flops using a differential clock input.</p>
<p>If the input clock is not 2x the target frequency but higher (e.g., 4x), then we can use a frequency divider approach to generate more than four phases. This could be useful in an N-path filter, where we could need more than four phases (see <a href="#sec-mixer-npath" class="quarto-xref">Section&nbsp;5.4</a>).</p>
<p>Often, we need four-phase LO signals with 25% duty cycle (instead of the 50% duty cycle shown in <a href="#fig-ff-phase-diagram" class="quarto-xref">Figure&nbsp;49</a>). This can be achieved by using additional logic gates to combine the outputs of the flip-flops, as shown in <a href="#fig-logen-25" class="quarto-xref">Figure&nbsp;50</a>. The resulting LO waveforms are shown in <a href="#fig-logen-25-waveforms" class="quarto-xref">Figure&nbsp;51</a>.</p>
<div id="cell-fig-logen-25" class="cell" data-execution_count="50">
<div class="cell-output cell-output-display">
<div id="fig-logen-25" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-logen-25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-logen-25-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-50" title="Figure&nbsp;50: I/Q generation with a divide-by-2 and 25% duty cycle generation."><img src="rfic_files/figure-html/fig-logen-25-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logen-25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;50: I/Q generation with a divide-by-2 and 25% duty cycle generation.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-logen-25-waveforms" class="cell" data-execution_count="51">
<div class="cell-output cell-output-display">
<div id="fig-logen-25-waveforms" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-logen-25-waveforms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-logen-25-waveforms-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-51" title="Figure&nbsp;51: Input and output waveforms of I/Q generation with a divide-by-2 and 25% duty cycle generation."><img src="rfic_files/figure-html/fig-logen-25-waveforms-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logen-25-waveforms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;51: Input and output waveforms of I/Q generation with a divide-by-2 and 25% duty cycle generation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The advantage of using flip-flops to generate multi-phase LO signals is that very precise phase shifts can be achieved, which can be produced over a very wide frequency range. They can be implemented in different logic styles, like CMOS, ECL, CML, and so on. The disadvantage is that we need a high-frequency clock signal above the target frequency, which might be difficult to generate. Still, I/Q generation with flip-flops is the de-facto standard approach in modern RFICs.</p>
</section>
<section id="sec-lo-delay" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="sec-lo-delay"><span class="header-section-number">5.5.4</span> Delay-Based Phase Generation</h3>
<p>The final approach we want to mention is to use a delay line (or multiple ones) to generate phase shifts. Using transmission lines, this approach is widely used at very high frequencies, where other approaches (like the ones shown in <a href="#sec-lo-polyphase" class="quarto-xref">Section&nbsp;5.5.2</a> or <a href="#sec-lo-ff" class="quarto-xref">Section&nbsp;5.5.3</a>) are difficult to implement. One well-known approach is the 90° hybrid coupler, realized with <span class="math inline">\(\lambda/4\)</span> transmission lines <span class="citation" data-cites="Pozar_RF">(<a href="#ref-Pozar_RF" role="doc-biblioref">Pozar 2011</a>)</span>. When the frequencies are high enough (and the resulting wavelengths short enough), this approach can even be implemented on-chip. The disadvantage is that the phase shift is frequency-dependent, so the quadrature signals are only perfectly in phase at one frequency. Furthermore, this passive network has a 3 dB loss, so we need additional gain stages to compensate for this loss. A branch-line hybrid coupler is shown in <a href="#fig-branch-line-coupler" class="quarto-xref">Figure&nbsp;52</a>.</p>
<div id="cell-fig-branch-line-coupler" class="cell" data-execution_count="52">
<div class="cell-output cell-output-display">
<div id="fig-branch-line-coupler" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-branch-line-coupler-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-branch-line-coupler-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52" title="Figure&nbsp;52: Branch-line hybrid coupler schematic showing the transmission line structure with characteristic impedances and λ/4 length sections."><img src="rfic_files/figure-html/fig-branch-line-coupler-output-1.png" width="772" height="657" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-branch-line-coupler-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;52: Branch-line hybrid coupler schematic showing the transmission line structure with characteristic impedances and λ/4 length sections.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The 3-port S-parameter matrix of an ideal branch-line coupler (assuming port 4 is poperly terminated with <span class="math inline">\(Z_0\)</span>) is given by</p>
<p><span id="eq-branch-line-coupler-sparams"><span class="math display">\[
S = \frac{1}{\sqrt{2}} \begin{bmatrix}
0 &amp; -j &amp; -1 \\
-j &amp; 0 &amp; 0 \\
-1 &amp; 0 &amp; 0
\end{bmatrix}.
\tag{39}\]</span></span></p>
<p>A feature of the coupler in <a href="#fig-branch-line-coupler" class="quarto-xref">Figure&nbsp;52</a> is that it is single-ended; a differential implementation needs either two couplers or a coupler with subsequent baluns.</p>
<p>Another approach, which is similar to the flip-flop based approach, is to use a delay line to generate the required phase shifts. This can be done with a single delay line and multiple taps, or with multiple delay lines. The idea is that we delay the input clock signal by a certain amount of time, which corresponds to a 90° phase shift at the target frequency. This approach is shown in <a href="#fig-logen-dll" class="quarto-xref">Figure&nbsp;53</a>. Since the delay of a delay line is frequency dependent, and the delay will change with process, voltage, and temperature (PVT) variations, we have to implement a tuning mechanism to adjust the delay. This implementation is called a delay-locked loop (DLL), which is similar to a phase-locked loop (PLL, see <a href="#sec-pll" class="quarto-xref">Section&nbsp;7</a>).</p>
<div id="cell-fig-logen-dll" class="cell" data-execution_count="53">
<div class="cell-output cell-output-display">
<div id="fig-logen-dll" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-logen-dll-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-logen-dll-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-53" title="Figure&nbsp;53: LO multiphase generation by delay-locked loop (DLL). An extension to more than four phases is straightforward."><img src="rfic_files/figure-html/fig-logen-dll-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logen-dll-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;53: LO multiphase generation by delay-locked loop (DLL). An extension to more than four phases is straightforward.
</figcaption>
</figure>
</div>
</div>
</div>
<p>With a phase detector (PD) we can compare the phase of the output signal with the input signal, and regulate the delay per stage so that after four delays the edges line up. Then we can tap the equally-spaced phases and use them as LO signals. The advantage of this approach is that we can flexibly create a required number of phases from an input clock. This feature is also used in wireline communication systems to generate multiple phases for the data sampling.</p>
</section>
</section>
</section>
<section id="sec-oscillator" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Oscillators</h1>
<p>For the generation of the LO frequency to be used in a mixer for frequency conversion, oscillators are used. Ideally, oscillators produce a stable, noise-free sinusoidal signal, independent of environmental conditions like temperature or supply voltage variations. The circuit symbol of an oscillator is shown in <a href="#fig-oscillator-symbol" class="quarto-xref">Figure&nbsp;54</a>.</p>
<div id="cell-fig-oscillator-symbol" class="cell" data-execution_count="54">
<div class="cell-output cell-output-display">
<div id="fig-oscillator-symbol" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oscillator-symbol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-oscillator-symbol-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-54" title="Figure&nbsp;54: Oscillator symbol."><img src="rfic_files/figure-html/fig-oscillator-symbol-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oscillator-symbol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;54: Oscillator symbol.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The question is how to construct an oscillator. In summary, we need to build something that oscillates, i.e., produces a sustained periodic signal with frequency <span class="math inline">\(\omega_0\)</span>. One way to achieve this is to construct a feedback loop where <span class="math inline">\(|H(s = j \omega_0)| = 1\)</span> and <span class="math inline">\(\angle H(s = j \omega_0) = n \cdot 2 \pi\)</span>; these conditions are called the “<a href="https://en.wikipedia.org/wiki/Barkhausen_criterion">Barkhausen criterion</a>” (here, <span class="math inline">\(H(s)\)</span> is the loop gain around the feedback loop). A ring oscillator is one example of such a feedback oscillator. For the 3-stage single-ended <em>ring oscillator</em> shown in <a href="#fig-ring-oscillator" class="quarto-xref">Figure&nbsp;55</a>, each inverter provides a phase shift of <span class="math inline">\(2 \pi / 3\)</span> at the oscillation frequency <span class="math inline">\(\omega_0\)</span>, resulting in a total phase shift of <span class="math inline">\(2 \pi\)</span> for the three inverters. The gain condition is fulfilled by the gain of the inverters, which must be larger than unity to compensate for losses in the loop. By using an odd number of inverters, a stable locking point at dc is avoided.</p>
<div id="cell-fig-ring-oscillator" class="cell" data-execution_count="55">
<div class="cell-output cell-output-display">
<div id="fig-ring-oscillator" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ring-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-ring-oscillator-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-55" title="Figure&nbsp;55: Three stage single-ended ring oscillator."><img src="rfic_files/figure-html/fig-ring-oscillator-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ring-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;55: Three stage single-ended ring oscillator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the output frequency of the ring oscillator shown above is ill-controlled, as it only depends on the delay (i.e., phase shift) of the inverters, which are usually dependent on process, voltage, and temperature (PVT) variations. Also, the inherent quality factor of such an oscillator is low, as exemplified by the definition of the quality factor <span class="math inline">\(Q\)</span> as <span class="citation" data-cites="Razavi.1996">(<a href="#ref-Razavi.1996" role="doc-biblioref">B. Razavi 1996</a>)</span></p>
<p><span id="eq-definition-q"><span class="math display">\[
Q = 2 \pi \frac{\text{Average energy stored}}{\text{Energy loss per cycle}} = \frac{\omega_0}{\Delta \omega} = \frac{\omega_0}{2} \sqrt{ \left( \frac{d A}{d \omega} \right)^2 + \left( \frac{d \varphi}{d \omega} \right)^2 }
\tag{40}\]</span></span></p>
<p>with a ring oscillator having very low <span class="math inline">\(dA / d \omega\)</span> and <span class="math inline">\(d \varphi / d \omega\)</span> slopes (<span class="math inline">\(A(\omega)\)</span> and <span class="math inline">\(\varphi(\omega)\)</span> are the open loop gain and phase shift, respectively). It can be shown that <span class="math inline">\(Q \approx 1.3\)</span> for a 3-stage ring oscillator <span class="citation" data-cites="Razavi.1996">(<a href="#ref-Razavi.1996" role="doc-biblioref">B. Razavi 1996</a>)</span>. For some applications, this might be sufficient, but in many cases, a higher <span class="math inline">\(Q\)</span> is desired to reduce phase noise and improve frequency stability (as we will see later in this chapter).</p>
<p>According to <a href="#eq-definition-q" class="quarto-xref">Equation&nbsp;40</a>, a high <span class="math inline">\(Q\)</span> can be achieved by using a resonator with high energy storage capability and low energy loss per cycle. We then add an amplifier in a feedback loop to compensate for the losses of the resonator. This principle is shown in <a href="#fig-lc-oscillator" class="quarto-xref">Figure&nbsp;56</a> for a parallel LC tank circuit as the resonator. Sometimes the action of the feedback loop around the amplifier is modelled as a negative resistance <span class="math inline">\(-R_\mathrm{amp}\)</span> that compensates for the losses of the tank circuit represented by the resistor <span class="math inline">\(R_\mathrm{p}\)</span>. The single parallel resistor <span class="math inline">\(R_\mathrm{p}\)</span> models the losses of the inductor <span class="math inline">\(L\)</span> and the capacitor <span class="math inline">\(C\)</span>.</p>
<div id="cell-fig-lc-oscillator" class="cell" data-execution_count="56">
<div class="cell-output cell-output-display">
<div id="fig-lc-oscillator" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lc-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lc-oscillator-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-56" title="Figure&nbsp;56: LC parallel tank with connected negative resistance forming an LC oscillator."><img src="rfic_files/figure-html/fig-lc-oscillator-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lc-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;56: LC parallel tank with connected negative resistance forming an LC oscillator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When <span class="math inline">\(|-R_\mathrm{amp}| = R_\mathrm{p}\)</span>, the losses of the tank circuit are fully compensated, and we have a sustained oscillation at the resonance frequency <span class="math inline">\(\omega_0 = 1 / \sqrt{L C}\)</span>. In practice, the amplifier gain is usually set slightly higher than required for loss compensation to <strong>start the oscillation from noise</strong>. Then, as the oscillation amplitude increases, some <strong>non-linear mechanism in the amplifier reduces the effective gain</strong> until a stable oscillation amplitude is reached. Various implementations of such LC oscillators exist, which will be discussed in the following sections.</p>
<ul>
<li><p>An alternative implementation of setting the oscillation amplitude is to use an <em>automatic level control</em> (ALC) loop, which measures the oscillation amplitude and adjusts the amplifier gain accordingly to maintain a constant output amplitude. This approach can improve the stability of the oscillation amplitude over process, voltage, and temperature variations.</p></li>
<li><p>As an alternative to start the oscillation from thermal noise (which can take considerable time depending on the <span class="math inline">\(Q\)</span> of the resonator) is to provide a known initial condition to the resonator, e.g., by pre-charging the capacitor <span class="math inline">\(C\)</span> to a certain voltage before enabling the amplifier. This way, the oscillation can start immediately from this initial energy stored in the resonator.</p></li>
</ul>
<p>As a first hint on how to optimize an LC oscillator for low phase noise, we can try to maximize <span class="math inline">\(Q\)</span> according to <a href="#eq-definition-q" class="quarto-xref">Equation&nbsp;40</a>. The energy stored in the capacitor at peak voltage is</p>
<p><span class="math display">\[
E_\mathrm{stored} = \frac{C V_\mathrm{osc,p}^2}{2}
\]</span></p>
<p>so to maximize this we should maximize both <span class="math inline">\(C\)</span> and the peak oscillation voltage <span class="math inline">\(V_\mathrm{osc,p}\)</span>. On the other hand, the energy loss per cycle is related to the power dissipated in the resistor <span class="math inline">\(R_\mathrm{p}\)</span> by</p>
<p><span class="math display">\[
E_\mathrm{loss} = \frac{V_\mathrm{osc,p}^2}{2 R_\mathrm{p}} \cdot \frac{1}{f_0}
\]</span></p>
<p>which we can minimize by maximizing <span class="math inline">\(R_\mathrm{p}\)</span>. In summary, to maximize <span class="math inline">\(Q\)</span> we should use a large capacitance <span class="math inline">\(C\)</span>, a high oscillation amplitude <span class="math inline">\(V_\mathrm{osc,p}\)</span>, and a high tank resistance <span class="math inline">\(R_\mathrm{p}\)</span>. Note that increasing <span class="math inline">\(C\)</span> will reduce <span class="math inline">\(L\)</span> for a given <span class="math inline">\(\omega_0\)</span>. Calculating <span class="math inline">\(Q\)</span> from these expressions yields</p>
<p><span class="math display">\[
Q = 2 \pi \frac{E_\mathrm{stored}}{E_\mathrm{loss}} = \omega_0 C R_\mathrm{p}
\]</span></p>
<p>which confirms the above observations.</p>
<p>Fundamentally, if we describe the output voltage of the oscillator as</p>
<p><span class="math display">\[
v_\mathrm{osc}(t) = V_\mathrm{osc,p}(t) \cdot \cos[ \omega_0(t) t + \varphi(t) ]
\]</span></p>
<p>we want to keep the amplitude variations small, i.e., <span class="math inline">\(V_\mathrm{osc,p}(t) = V_\mathrm{osc,p}\)</span>, and also the frequency variations small, i.e., <span class="math inline">\(\omega_0(t) = \omega_0\)</span>. We further want to minimize any phase fluctuations, i.e., <span class="math inline">\(\varphi(t) = \varphi_0\)</span>.</p>
<p>As a side note, the definition of <span class="math inline">\(Q\)</span> in <a href="#eq-definition-q" class="quarto-xref">Equation&nbsp;40</a> can also be understood as describing how many oscillation cycles it takes until the energy stored in the resonator is dissipated. For example, if <span class="math inline">\(Q = 1000\)</span> at <span class="math inline">\(f_0 = 1\,\text{GHz}\)</span>, the energy stored in the resonator will last for approximately 1000 cycles, which is 1 µs. This time duration is sometimes called the “ring-down time” of the resonator.</p>
<section id="sec-oscillator-noise" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sec-oscillator-noise"><span class="header-section-number">6.1</span> Oscillator Noise</h2>
<p>For calculating the noise of an oscillator, we assume that an LC-based oscillator as shown in <a href="#fig-lc-oscillator" class="quarto-xref">Figure&nbsp;56</a> is used. We assume that the oscillator is in steady-state operation, i.e., <span class="math inline">\(-R_\mathrm{amp} = R_\mathrm{p}\)</span>. We can then simplify the circuit to the one shown in <a href="#fig-lc-oscillator-noise-model" class="quarto-xref">Figure&nbsp;57</a>.</p>
<div id="cell-fig-lc-oscillator-noise-model" class="cell" data-execution_count="57">
<div class="cell-output cell-output-display">
<div id="fig-lc-oscillator-noise-model" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lc-oscillator-noise-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-lc-oscillator-noise-model-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-57" title="Figure&nbsp;57: LC parallel tank with oscillator in steady-state operation."><img src="rfic_files/figure-html/fig-lc-oscillator-noise-model-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lc-oscillator-noise-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;57: LC parallel tank with oscillator in steady-state operation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can calculate</p>
<p><span class="math display">\[
Z_\mathrm{tank}(s) = \frac{s L \frac{1}{s C}}{s L + \frac{1}{s C}} = \frac{s L}{1 + s^2 L C}.
\]</span></p>
<p>At <span class="math inline">\(s = j \omega_0\)</span>, we have <span class="math inline">\(Z_\mathrm{tank}(s) \to \infty\)</span>, so let’s approximate around <span class="math inline">\(\omega_0\)</span>:</p>
<p><span class="math display">\[
Z_\mathrm{tank}(j \omega_0 + j \Delta \omega) =\frac{j (\omega_0 + \Delta \omega) L}{1 - (\omega_0 + \Delta \omega)^2 L C}
\]</span></p>
<p>For <span class="math inline">\(\Delta \omega \ll \omega_0\)</span>, we can approximate <span class="math inline">\((\omega_0 + \Delta \omega)^2 \approx \omega_0^2 + 2 \omega_0 \Delta \omega\)</span> and <span class="math inline">\(\omega_0 + \Delta \omega \approx \omega_0\)</span>, which yields (using <span class="math inline">\(\omega_0^2 L C = 1\)</span>)</p>
<p><span class="math display">\[
Z_\mathrm{tank}(j \omega_0 + j \Delta \omega) = -\frac{j}{2 \Delta \omega C}.
\]</span></p>
<p>We now use the correspondence <span class="math inline">\(C = 1 / \omega_0^2 L\)</span> and express <span class="math inline">\(L = R_\mathrm{p} / \omega_0 Q\)</span> to get</p>
<p><span class="math display">\[
|Z_\mathrm{tank}(j \omega_0 + j \Delta \omega)| = \frac{R_\mathrm{p}}{2 Q} \left( \frac{\omega_0}{\Delta \omega} \right)
\]</span></p>
<p>which provides us with an expression for the magnitude of the tank impedance around resonance. We now calculate the noise power if a noise current is injected into this impedance. We use the single-sided noise current of <span class="math inline">\(R_\mathrm{p}\)</span> (see <a href="#sec-noise-types" class="quarto-xref">Section&nbsp;2.3.1</a>), increased by a factor <span class="math inline">\(F\)</span> contributed by the active circuit providing <span class="math inline">\(-R_\mathrm{amp}\)</span>:</p>
<p><span class="math display">\[
\overline{I_n^2} = \frac{4 k T F}{R_\mathrm{p}}
\]</span></p>
<p>The noise voltage across the tank at a frequency offset <span class="math inline">\(\Delta \omega\)</span> from <span class="math inline">\(\omega_0\)</span> is then</p>
<p><span class="math display">\[
\overline{V_n^2}(\Delta \omega) = |Z_\mathrm{tank}(j \omega_0 + j \Delta \omega)|^2 \cdot \frac{4 k T F}{R_\mathrm{p}} = \frac{k T F R_\mathrm{p}}{Q^2} \left( \frac{\omega_0}{\Delta \omega} \right)^2
\]</span></p>
<p>This absolute noise voltage is not of much interest per se. We normalize it to the oscillation amplitude <span class="math inline">\(V_\mathrm{p}\)</span>, and only account for 1/2 of the noise, as the total noise power is split equally into amplitude noise and phase noise <span class="citation" data-cites="Razavi.1996">(<a href="#ref-Razavi.1996" role="doc-biblioref">B. Razavi 1996</a>)</span>, and we are only interested in the <strong>phase noise</strong>. This is because we assume the amplitude noise is removed by amplitude clipping in the LO chain routing the oscillator signal to the mixer. This is often a valid assumption. We introduce the symbol <span class="math inline">\(\mathcal{L}\left\{\cdot\right\}\)</span> to denote this normalized phase noise of the oscillator:</p>
<p><span id="eq-leeson-equation"><span class="math display">\[
\mathcal{L}\left\{\Delta \omega\right\} = \frac{\frac{1}{2} \frac{k T F R_\mathrm{p}}{Q^2} \left( \frac{\omega_0}{\Delta \omega} \right)^2}{\left( \frac{V_\mathrm{p}}{\sqrt{2}} \right)^2} = \frac{k T F R_\mathrm{p}}{V_\mathrm{p}^2} \cdot \frac{1}{Q^2} \cdot \left( \frac{\omega_0}{\Delta \omega} \right)^2
\tag{41}\]</span></span></p>
<p>This equation is known as “<strong>Leeson’s equation</strong>” <span class="citation" data-cites="Leeson.1966">(<a href="#ref-Leeson.1966" role="doc-biblioref">Leeson 1966</a>)</span>, and it provides us with important insights on how to design low phase noise oscillators:</p>
<ol type="1">
<li>Use a resonator with high quality factor <span class="math inline">\(Q\)</span> to reduce phase noise. On-chip LC tanks usually provide moderate <span class="math inline">\(Q\)</span> values (e.g., 10 to 30), while off-chip crystals can provide very high <span class="math inline">\(Q\)</span> values (e.g., 10,000 to 100,000).</li>
<li>Maximize the oscillation amplitude <span class="math inline">\(V_\mathrm{p}\)</span> to increase the stored energy in the resonator. In CMOS implementations, this is often limited by the supply voltage and/or device breakdown voltages.</li>
<li>Use an active circuit with low noise factor <span class="math inline">\(F\)</span> to minimize the noise contribution of the negative resistance <span class="math inline">\(-R_\mathrm{amp}\)</span>. A good value to aim for is <span class="math inline">\(F \approx 2\)</span> or lower.</li>
<li>Maximize the tank resistance <span class="math inline">\(R_\mathrm{p}\)</span> to minimize the thermal noise contribution. This can be achieved by using high-Q inductors and low-loss capacitors.</li>
</ol>
<p>The phase noise <span class="math inline">\(\mathcal{L}\left\{\Delta \omega\right\}\)</span> is expressed in the unit of dBc/Hz, i.e., in decibels of phase noise relative to the carrier power per 1 Hz of bandwidth. When expressing the phase noise of an oscillator in dBc/Hz it is important to state both the oscillation frequency <span class="math inline">\(\omega_0\)</span> and the offset frequency <span class="math inline">\(\Delta \omega\)</span> at which the phase noise is evaluated. For example, we could say that an oscillator has a phase noise of -137 dBc/Hz at 3 MHz offset from a carrier frequency of 2 GHz.</p>
<p>The phase noise expressed with <a href="#eq-leeson-equation" class="quarto-xref">Equation&nbsp;41</a> describes an important region of the total oscillator phase noise where the phase noise decreases with <span class="math inline">\(1 / (\Delta \omega)^2\)</span>, i.e., with 20 dB per decade. This region is often called the “thermal noise region” as it is dominated by thermal noise from the tank resistor and the active circuit. However, at lower offset frequencies, other noise mechanisms (like flicker noise) can dominate, leading to different slopes of the phase noise vs.&nbsp;offset frequency curve. At larger offset frequencies, the phase noise can flatten out due to thermal noise floor limitation of buffer amplifiers following the oscillator. A typical phase noise plot of an LC oscillator is shown in <a href="#fig-phase-noise-spectrum" class="quarto-xref">Figure&nbsp;58</a>.</p>
<div id="cell-fig-phase-noise-spectrum" class="cell" data-execution_count="58">
<div class="cell-output cell-output-display">
<div id="fig-phase-noise-spectrum" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-phase-noise-spectrum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-phase-noise-spectrum-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58" title="Figure&nbsp;58: Phase noise spectrum of a typical LC oscillator showing characteristic 1/f³ and 1/f² slopes vs.&nbsp;frequency offset from carrier. The flicker noise corner (where the 1/f³ region transitions to the 1/f² region) is around 10 kHz, and the thermal noise floor onset is marked at 10 MHz."><img src="rfic_files/figure-html/fig-phase-noise-spectrum-output-1.png" width="656" height="463" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-phase-noise-spectrum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;58: Phase noise spectrum of a typical LC oscillator showing characteristic 1/f³ and 1/f² slopes vs.&nbsp;frequency offset from carrier. The flicker noise corner (where the 1/f³ region transitions to the 1/f² region) is around 10 kHz, and the thermal noise floor onset is marked at 10 MHz.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is important to note that the phase noise does not go to infinity as <span class="math inline">\(\Delta \omega\)</span> approaches zero, as <a href="#eq-leeson-equation" class="quarto-xref">Equation&nbsp;41</a> might suggest. This is an artifact of the simplified model used to derive Leeson’s equation. In reality, the phase noise has the form of a Lorentzian spectrum around the carrier frequency, which means that it flattens out at very low offset frequencies with a trend described by</p>
<p><span class="math display">\[
\mathcal{L}\left\{\Delta \omega \ll\right\} \propto \frac{1}{\omega_\mathrm{B}^2 + \Delta \omega^2}
\]</span></p>
<p>with <span class="math inline">\(\omega_\mathrm{B}\)</span> being the half-power bandwidth of the oscillator spectrum.</p>
<p>Why is phase noise important?</p>
<ol type="1">
<li>In RX and TX the phase noise of the LO creates jitter, which degrades signal quality and contributes to EVM degradation.</li>
<li>In TX, phase noise of the LO creates noise sidebands around the carrier, which can lead to adjacent channel interference together with spectral regrowth due to nonlinearities and thermal noise.</li>
<li>In RX, reciprocal mixing of the phase noise sidebands with the desired signal creates in-band noise, which degrades the SNR and sensitivity of the RX.</li>
<li>In systems using multiple carriers or carriers with high-order modulation schemes (like in OFDM), phase noise can lead to inter-carrier interference (ICI) and symbol misinterpretation, further degrading system performance.</li>
</ol>
</section>
<section id="sec-oscillator-reciprocal-mixing" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-oscillator-reciprocal-mixing"><span class="header-section-number">6.2</span> Reciprocal Mixing</h2>
<p>Reciprocal mixing is a phenomenon that occurs in receivers when the phase noise sidebands of the local oscillator mix with strong adjacent channel signals, resulting in in-band noise that degrades the signal-to-noise ratio of the desired signal. This effect is particularly pronounced in systems with high-order modulation schemes or closely spaced channels, where even small amounts of phase noise can lead to significant performance degradation.</p>
<p>To analyze reciprocal mixing, we consider a scenario where a strong interferer is present at a frequency offset <span class="math inline">\(\Delta f\)</span> from the desired signal. The phase noise of the local oscillator at this offset frequency can be characterized by its power spectral density <span class="math inline">\(\mathcal{L}\left\{\Delta f\right\}\)</span>. When the local oscillator mixes with the interferer, the phase noise sidebands effectively “fold” into the desired signal band, creating additional noise. This noise level can be estimated by multiplying the power of the interferer by the phase noise level at the offset frequency and considering the channel bandwidth <span class="math inline">\(B\)</span> of the RX</p>
<p><span id="eq-reciprocal-mixing-noise"><span class="math display">\[
P_\mathrm{RM} = P_\mathrm{interferer} + \mathcal{L}\left\{\Delta f\right\} + 10 \log_{10}(B)
\tag{42}\]</span></span></p>
<p>where <span class="math inline">\(P_\mathrm{RM}\)</span> is the power of the reciprocal mixing noise introduced into the desired signal band.</p>
<div id="nte-reciprocal-mixing" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;7: Reciprocal Mixing Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let us assume the following example from a Bluetooth LE receiver: The sensitivity target for the RX is -70 dBm with an SNR of 10 dB for a 1 MHz channel. An adjacent channel interferer is present at -27 dB channel to interferer ratio at an offset of 3 MHz. How much phase noise can the LO have to meet the sensitivity target?</p>
<p>From the sensitivity target and the SNR requirement, we can calculate the maximum allowable noise floor in the RX. We add a margin of 3 dB to account for implementation losses:</p>
<p><span class="math display">\[
P_\mathrm{noise,max} = P_\mathrm{sens} - \text{SNR} - P_\mathrm{margin} = -70\,\text{dBm} - 10\,\text{dB} - 3\,\text{dB} = -83\,\text{dBm}
\]</span></p>
<p>The interferer power is:</p>
<p><span class="math display">\[
P_\mathrm{interferer} = P_\mathrm{sens} - \text{C/I} = -70\,\text{dBm} + 27\,\text{dB} = -43\,\text{dBm}
\]</span></p>
<p>Using <a href="#eq-reciprocal-mixing-noise" class="quarto-xref">Equation&nbsp;42</a>, we can express the maximum allowable phase noise at 3 MHz offset at 2.4 GHz as:</p>
<p><span class="math display">\[
\mathcal{L}\left\{3\,\text{MHz}\right\} = P_\mathrm{noise,max} - P_\mathrm{interferer} - 10 \log_{10}(B) = -83\,\text{dBm} + 43\,\text{dBm} - 60\,\text{dB} = -100\,\text{dBc/Hz}
\]</span></p>
</div>
</div>
<p>The reciprocal mixing scenario described in <a href="#nte-reciprocal-mixing" class="quarto-xref">Note&nbsp;7</a> is visualized in <a href="#fig-reciprocal-mixing" class="quarto-xref">Figure&nbsp;59</a>.</p>
<div id="cell-fig-reciprocal-mixing" class="cell" data-execution_count="59">
<div class="cell-output cell-output-display">
<div id="fig-reciprocal-mixing" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-reciprocal-mixing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-reciprocal-mixing-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59" title="Figure&nbsp;59: Reciprocal mixing in a receiver: A strong interferer at offset frequency mixes with LO phase noise sidebands, creating in-band noise that degrades the desired signal SNR. The desired signal shows the same, scaled phase noise profile around it as the interferer, as both mix with the same LO phase noise."><img src="rfic_files/figure-html/fig-reciprocal-mixing-output-1.png" width="657" height="465" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-reciprocal-mixing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;59: Reciprocal mixing in a receiver: A strong interferer at offset frequency mixes with LO phase noise sidebands, creating in-band noise that degrades the desired signal SNR. The desired signal shows the same, scaled phase noise profile around it as the interferer, as both mix with the same LO phase noise.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-single-ended-oscillators" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sec-single-ended-oscillators"><span class="header-section-number">6.3</span> Single-Ended Oscillators</h2>
<p>Single-ended oscillators are commonly used in RF applications due to their simplicity and ease of integration, especially in quartz oscillators. A negative resistance is implemented using a single transistor amplifier as is shown in <a href="#fig-neg-r-single-ended" class="quarto-xref">Figure&nbsp;60</a>. The transistor is configured with two capacitors <span class="math inline">\(C_1\)</span> and <span class="math inline">\(C_2\)</span> to provide a phase-shifted feedback path.</p>
<div id="cell-fig-neg-r-single-ended" class="cell" data-execution_count="60">
<div class="cell-output cell-output-display">
<div id="fig-neg-r-single-ended" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-neg-r-single-ended-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-neg-r-single-ended-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-60" title="Figure&nbsp;60: Circuit diagram of a single-ended negative resistance implementation."><img src="rfic_files/figure-html/fig-neg-r-single-ended-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-neg-r-single-ended-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;60: Circuit diagram of a single-ended negative resistance implementation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It can be shown that the differential input impedance looking into the transistor gate and drain is given by</p>
<p><span class="math display">\[
Z_\mathrm{in}(s) = -\frac{g_\mathrm{m}}{\omega^2 C_1 C_2} + \frac{C_1 + C_2}{s C_1 C_2} = -R_\mathrm{amp} + \frac{1}{s C_\mathrm{amp}}
\]</span></p>
<p>which consists of the series combination of a negative resistance <span class="math inline">\(-R_\mathrm{amp}\)</span> and a capacitance <span class="math inline">\(C_\mathrm{amp}\)</span>. Note that the circuit in <a href="#fig-neg-r-single-ended" class="quarto-xref">Figure&nbsp;60</a> does not show a ground symbol. In fact, any of the three nodes marked with blue numbers can be used as a reference node (ground), and this results in the following well-known oscillator topologies:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Reference Node</th>
<th>Oscillator Topology</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Node 1 (Gate)</td>
<td><a href="https://en.wikipedia.org/wiki/Colpitts_oscillator">Colpitts oscillator</a></td>
</tr>
<tr class="even">
<td>Node 2 (Source)</td>
<td><a href="https://en.wikipedia.org/wiki/Pierce_oscillator">Pierce oscillator</a></td>
</tr>
<tr class="odd">
<td>Node 3 (Drain)</td>
<td><a href="https://en.wikipedia.org/wiki/Clapp_oscillator">Clapp oscillator</a></td>
</tr>
</tbody>
</table>
<p>When we investigate the equivalent electrical circuit of a quartz crystal, we find that it has inductive behavior between its series resonance frequency and its parallel resonance frequency, which are very close together. The quartz crystal equivalent circuit is shown in <a href="#fig-crystal-equivalent-circuit" class="quarto-xref">Figure&nbsp;61</a>.</p>
<div id="cell-fig-crystal-equivalent-circuit" class="cell" data-execution_count="61">
<div class="cell-output cell-output-display">
<div id="fig-crystal-equivalent-circuit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-crystal-equivalent-circuit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-crystal-equivalent-circuit-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-61" title="Figure&nbsp;61: Quartz crystal equivalent circuit."><img src="rfic_files/figure-html/fig-crystal-equivalent-circuit-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crystal-equivalent-circuit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;61: Quartz crystal equivalent circuit.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This means we can operate the quartz crystal as a high-Q inductor in an oscillator circuit, which results in the single-ended quartz crystal oscillator shown in <a href="#fig-crystal-oscillator" class="quarto-xref">Figure&nbsp;62</a>, which is a very popular choice for high-performance crystal oscillators. Note that in a simple implementation the current-bias MOSFET can be replaced by an inverter stage biased in the linear region.</p>
<div id="cell-fig-crystal-oscillator" class="cell" data-execution_count="62">
<div class="cell-output cell-output-display">
<div id="fig-crystal-oscillator" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-crystal-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-crystal-oscillator-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-62" title="Figure&nbsp;62: Circuit diagram of a single-ended Pierce crystal oscillator operating the quartz between series and parallel resonance where it acts as a large high-Q inductor. Note that the quartz crystal has no dc path, hence we need a high-ohmic bias resistor to connect M1 into a diode configuration."><img src="rfic_files/figure-html/fig-crystal-oscillator-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-crystal-oscillator-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;62: Circuit diagram of a single-ended Pierce crystal oscillator operating the quartz between series and parallel resonance where it acts as a large high-Q inductor. Note that the quartz crystal has no dc path, hence we need a high-ohmic bias resistor to connect M1 into a diode configuration.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The series combination of <span class="math inline">\(C_1\)</span> and <span class="math inline">\(C_2\)</span> provides the load capacitance required by the crystal to oscillate at its specified frequency. The oscillation frequency can be approximated by (<span class="math inline">\(C_\mathrm{load}^{-1} = 1/C_1 + 1/C_2\)</span>):</p>
<p><span class="math display">\[
f_0 \approx \frac{1}{2 \pi \sqrt{L_\mathrm{m} C_\mathrm{load}}}
\]</span></p>
</section>
<section id="sec-differential-oscillators" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="sec-differential-oscillators"><span class="header-section-number">6.4</span> Differential Oscillators</h2>
<p>After discussing single-ended oscillators in <a href="#sec-single-ended-oscillators" class="quarto-xref">Section&nbsp;6.3</a>, we now turn to differential oscillator topologies, which are widely used in integrated LC oscillators due to their superior common-mode noise rejection and reduced even-order harmonics. A popular way to create a differential negative resistance is to use a cross-coupled pair of transistors as shown in <a href="#fig-cross-coupled-pair" class="quarto-xref">Figure&nbsp;63</a>.</p>
<div id="cell-fig-cross-coupled-pair" class="cell" data-execution_count="63">
<div class="cell-output cell-output-display">
<div id="fig-cross-coupled-pair" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cross-coupled-pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-cross-coupled-pair-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-63" title="Figure&nbsp;63: A cross-coupled differential pair."><img src="rfic_files/figure-html/fig-cross-coupled-pair-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cross-coupled-pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;63: A cross-coupled differential pair.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We assume a symmetrical circuit by setting <span class="math inline">\(g_\mathrm{m1} = g_\mathrm{m2} = g_\mathrm{m}\)</span>. By analyzing the small-signal equivalent circuit, we can derive the differential input impedance looking into the gates of the transistors:</p>
<p><span class="math display">\[
Z_\mathrm{in} = -\frac{2}{g_\mathrm{m}}
\]</span></p>
<p>A practical implementation of a differential LC oscillator using the cross-coupled pair is shown in <a href="#fig-oscillator-lc-nmos" class="quarto-xref">Figure&nbsp;64</a> using a so-called “NMOS core”, as it is using an NMOS-based differential pair.</p>
<div id="cell-fig-oscillator-lc-nmos" class="cell" data-execution_count="64">
<div class="cell-output cell-output-display">
<div id="fig-oscillator-lc-nmos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oscillator-lc-nmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-oscillator-lc-nmos-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-64" title="Figure&nbsp;64: An LC differential oscillator using an NMOS cross-coupled differential pair. L_1 and L_2 are usually implemented as a single on-chip spiral inductor with a center tap."><img src="rfic_files/figure-html/fig-oscillator-lc-nmos-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oscillator-lc-nmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;64: An LC differential oscillator using an NMOS cross-coupled differential pair. <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_2\)</span> are usually implemented as a single on-chip spiral inductor with a center tap.
</figcaption>
</figure>
</div>
</div>
</div>
<p>By putting the circuit in <a href="#fig-oscillator-lc-nmos" class="quarto-xref">Figure&nbsp;64</a> onto its head we obtain a “PMOS core” oscillator, which is also widely used in integrated LC oscillators. This configuration is shown in <a href="#fig-oscillator-lc-pmos" class="quarto-xref">Figure&nbsp;65</a>.</p>
<div id="cell-fig-oscillator-lc-pmos" class="cell" data-execution_count="65">
<div class="cell-output cell-output-display">
<div id="fig-oscillator-lc-pmos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oscillator-lc-pmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-oscillator-lc-pmos-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-65" title="Figure&nbsp;65: An LC differential oscillator using a PMOS cross-coupled differential pair. L_1 and L_2 are usually implemented as a single on-chip spiral inductor with a center tap."><img src="rfic_files/figure-html/fig-oscillator-lc-pmos-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oscillator-lc-pmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;65: An LC differential oscillator using a PMOS cross-coupled differential pair. <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_2\)</span> are usually implemented as a single on-chip spiral inductor with a center tap.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In both oscillator topologies, the oscillation frequency is determined by the LC tank circuit formed by <span class="math inline">\(L = L_1 + L_2\)</span> and <span class="math inline">\(C\)</span>. The oscillation frequency can be approximated by</p>
<p><span class="math display">\[
f_0 = \frac{1}{2 \pi \sqrt{L C}}
\]</span></p>
<p>As both technologies have their inductor middle point tied to a supply rail (ground for NMOS core, <span class="math inline">\(V_\mathrm{DD}\)</span> for PMOS core), the voltage swing across the tank can go well beyond the supply voltage, which is an advantage of these topologies. However, note that the maximum voltage swing is still limited by the device breakdown voltages of <span class="math inline">\(M_1\)</span> and <span class="math inline">\(M_2\)</span>, which can be critical in advanced CMOS technologies with low breakdown voltages. To utilize both an NMOS and a PMOS cross-coupled pair in parallel, a so-called “complementary (or CMOS) LC oscillator” can be used, which is shown in <a href="#fig-oscillator-lc-cmos" class="quarto-xref">Figure&nbsp;66</a>. Here, the voltage swing across the tank is limited to the supply voltage, so it is inherently safe regarding device breakdown. Also, the transconductance of both NMOS and PMOS devices contribute to the negative resistance, which can reduce power consumption for a given oscillation amplitude.</p>
<div id="cell-fig-oscillator-lc-cmos" class="cell" data-execution_count="66">
<div class="cell-output cell-output-display">
<div id="fig-oscillator-lc-cmos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oscillator-lc-cmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-oscillator-lc-cmos-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-66" title="Figure&nbsp;66: An LC differential oscillator using a PMOS and an NMOS cross-coupled differential pair."><img src="rfic_files/figure-html/fig-oscillator-lc-cmos-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oscillator-lc-cmos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;66: An LC differential oscillator using a PMOS and an NMOS cross-coupled differential pair.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that no bias current sources are shown in <a href="#fig-oscillator-lc-cmos" class="quarto-xref">Figure&nbsp;66</a>, but can be added in practice. However, they require some voltage headroom, which lowers the maximum voltage swing across the tank, which is negative for phase noise performance according to Leeson’s equation in <a href="#eq-leeson-equation" class="quarto-xref">Equation&nbsp;41</a>.</p>
<p>The inductor <span class="math inline">\(L\)</span> used in LC tanks is often implemented as a differential spiral inductor, which can be realized on-chip using the top metal layers of the CMOS process. If higher <span class="math inline">\(Q\)</span> is sought, then off-chip inductors must be used, which is more expensive and uses package pins to connect the inductor. Alternatively, bondwire inductors can be used, which utilize the bondwires connecting the die to the package leads as inductors. Bondwire inductors can provide high <span class="math inline">\(Q\)</span> values and are a cost-effective solution for improving oscillator performance without requiring off-chip components. For mm-wave frequencies, transmission line stubs can be used as inductors, which can be implemented on-chip using coplanar waveguide (CPW) or microstrip structures.</p>
</section>
<section id="sec-frequency-tuning-of-oscillators" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="sec-frequency-tuning-of-oscillators"><span class="header-section-number">6.5</span> Frequency Tuning of Oscillators</h2>
<p>Note that all three LC oscillator topologies shown in <a href="#sec-differential-oscillators" class="quarto-xref">Section&nbsp;6.4</a> have a fixed oscillation frequency determined by the LC tank circuit. In practice, it is often desirable to be able to tune the oscillation frequency over a certain range. There are only two ways to achieve this, either by tuning the inductance <span class="math inline">\(L\)</span> or the capacitance <span class="math inline">\(C\)</span> of the tank circuit. In integrated LC oscillators, it is common to use a fixed inductor and a tunable capacitor, which is shown in <a href="#fig-oscillator-lc-nmos" class="quarto-xref">Figure&nbsp;64</a>, <a href="#fig-oscillator-lc-pmos" class="quarto-xref">Figure&nbsp;65</a>, and <a href="#fig-oscillator-lc-cmos" class="quarto-xref">Figure&nbsp;66</a>.</p>
<p>The need to change the oscillator frequency can arise from various requirements:</p>
<ol type="1">
<li>We need to precisely tune the oscillator frequency to match a desired carrier frequency.</li>
<li>The oscillator frequency needs to be adjusted to compensate for process, voltage, and temperature (PVT) variations that can affect the resonant frequency of the LC tank.</li>
</ol>
<p>In order to achieve a tunable capacitance, a so-called “varactor” (variable capacitor) is often used. A varactor is a semiconductor device that exhibits a capacitance that varies with the applied voltage. Common ways to implement a varactor in integrated circuits are:</p>
<ol type="1">
<li>Use the gate-to-channel capacitance of a MOSFET operated in reverse bias. By changing the voltage applied to the gate, the depletion region width in the channel changes, which in turn changes the capacitance.</li>
<li>Use a PN-junction diode operated in reverse bias. The depletion region width of the diode changes with the applied voltage, leading to a change in capacitance.</li>
<li>Use a gate-to-channel capacitance of special MOSFET structure in accumulation mode, which can be achieved by using a NMOS situated in an n-well (in contrast to the usual operation in a p-well). Changing the gate-to-channel voltage changes the accumulation capacitance <span class="citation" data-cites="Andreani.2000">(<a href="#ref-Andreani.2000" role="doc-biblioref">Andreani and Mattisson 2000</a>)</span>.</li>
<li>Use a switched capacitor bank, where multiple capacitors are connected in parallel or series using switches (usually MOSFETs) to achieve discrete capacitance values.</li>
</ol>
<p>In order to characterize the tuning sensitivity of an oscillator, the metric <span class="math inline">\(K_\mathrm{VCO}\)</span> (voltage-controlled oscillator gain) is often used, which is defined as</p>
<p><span class="math display">\[
K_\mathrm{VCO} = \frac{d f_0}{d V_\mathrm{tune}}
\]</span></p>
<p>with <span class="math inline">\(V_\mathrm{tune}\)</span> being the control voltage applied to the varactor. The unit of <span class="math inline">\(K_\mathrm{VCO}\)</span> is usually expressed in MHz/V or GHz/V. A high <span class="math inline">\(K_\mathrm{VCO}\)</span> means that a small change in tuning voltage results in a large change in oscillation frequency, which can be beneficial for wide tuning ranges but can also make the oscillator more sensitive to noise on the tuning voltage line.</p>
<p>Note that the tuning sensitivity <span class="math inline">\(K_\mathrm{VCO}\)</span> is usually quite nonlinear over the tuning range, so it is common to specify <span class="math inline">\(K_\mathrm{VCO}\)</span> at a certain operating point or as an average value over the tuning range.</p>
<p>In order to achieve a wide tuning range while maintaining a sufficiently small <span class="math inline">\(K_\mathrm{VCO}\)</span> for phase noise reasons, a combination of coarse and fine tuning mechanisms can be used <span class="citation" data-cites="Kral.1998">(<a href="#ref-Kral.1998" role="doc-biblioref">Kral, Behbahani, and Abidi 1998</a>)</span>. For example, a switched capacitor bank can provide coarse tuning steps, while a varactor can provide fine tuning within each step. It is important to ensure that the overall tuning range is free of dead zones, where the oscillator cannot be tuned to certain frequencies due to non-overlapping tuning ranges of the coarse and fine tuning elements.</p>
<p>While there are many ways to implement a switched capacitor for use in an oscillator tuning circuit, one popular way is shown in <a href="#fig-switched-capacitor" class="quarto-xref">Figure&nbsp;67</a>. Many such switched capacitors with different values of <span class="math inline">\(C\)</span> (often binary weighted) can be combined to form a capacitor bank for coarse frequency tuning.</p>
<div id="cell-fig-switched-capacitor" class="cell" data-execution_count="67">
<div class="cell-output cell-output-display">
<div id="fig-switched-capacitor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-switched-capacitor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-switched-capacitor-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-67" title="Figure&nbsp;67: An switched capacitor for use in an oscillator switched capacitor tuning bank. The bias resistors tie the drain/source nodes to ground during turn on of M_1 (for low on resistance), while they tie the drain/source nodes to VDD during turn off of M_1 to prevent accidential turn on of the drain/source to bulk diodes of M_1."><img src="rfic_files/figure-html/fig-switched-capacitor-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-switched-capacitor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;67: An switched capacitor for use in an oscillator switched capacitor tuning bank. The bias resistors tie the drain/source nodes to ground during turn on of <span class="math inline">\(M_1\)</span> (for low on resistance), while they tie the drain/source nodes to VDD during turn off of <span class="math inline">\(M_1\)</span> to prevent accidential turn on of the drain/source to bulk diodes of <span class="math inline">\(M_1\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Here, when the control signal <span class="math inline">\(S\)</span> is high, the effective capacitance is <span class="math inline">\(C/2\)</span>, with a parasitic series resistance <span class="math inline">\(R_\mathrm{on}\)</span> due to the switch. When <span class="math inline">\(S\)</span> is low, the effective capacitance is <span class="math inline">\(C_\mathrm{off}\)</span>, which is the parasitic drain-source capacitance of the MOSFET switch.</p>
<p>Note that there exists a trade-off when designing the switched capacitor: A larger switch (with increased <span class="math inline">\(W\)</span>) reduces <span class="math inline">\(R_\mathrm{on}\)</span>, but increases <span class="math inline">\(C_\mathrm{off}\)</span>. A large <span class="math inline">\(R_\mathrm{on}\)</span> leads to increased losses in the tank circuit, which degrades the quality factor <span class="math inline">\(Q\)</span> and increases phase noise according to <a href="#eq-leeson-equation" class="quarto-xref">Equation&nbsp;41</a>. On the other hand, a large <span class="math inline">\(C_\mathrm{off}\)</span> reduces the effective tuning range of the switched capacitor, which can be detrimental if a wide tuning range is required.</p>
<p>In <strong>digitally-controlled oscillators (DCOs)</strong>, the tuning voltage <span class="math inline">\(V_\mathrm{tune}\)</span> is replaced by a digital control word that selects different capacitance values from a capacitor bank. This approach allows for precise and repeatable frequency tuning, which is beneficial in applications requiring frequency synthesis or channel selection. These fine tuning steps can also be implemented according to <a href="#fig-switched-capacitor" class="quarto-xref">Figure&nbsp;67</a>, however, the value of <span class="math inline">\(C\)</span> must be sufficiently small.</p>
</section>
<section id="sec-oscillator-modeling" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="sec-oscillator-modeling"><span class="header-section-number">6.6</span> Oscillator Modelling</h2>
<p>The instantaneous frequency of an oscillator can be expressed as</p>
<p><span class="math display">\[
\omega_\mathrm{VCO}(t) = \omega_0 t + K_\mathrm{VCO} \cdot V_\mathrm{tune}(t)
\]</span></p>
<p>where <span class="math inline">\(\omega_0\)</span> is the nominal oscillation frequency, <span class="math inline">\(K_\mathrm{VCO}\)</span> is the tuning sensitivity, and <span class="math inline">\(V_\mathrm{tune}(t)\)</span> is the tuning voltage applied to the varactor. Looking at the instantaneous phase <span class="math inline">\(\varphi_\mathrm{VCO}(t)\)</span> of the oscillator, we can integrate the instantaneous frequency <span class="math inline">\(\omega_\mathrm{VCO}(t)\)</span> to obtain</p>
<p><span class="math display">\[
\varphi_\mathrm{VCO}(t) = \int_0^t \omega_\mathrm{VCO}(\tau) d\tau = \omega_0 t + K_\mathrm{VCO} \int_0^t V_\mathrm{tune}(\tau) d\tau.
\]</span></p>
<p>Inspecting this equation, we see that with respect to phase, an oscillator is a <strong>perfect</strong> integrator of the tuning voltage over time! For simulation purposes, we can therefore model an oscillator as an integrator block as shown in <a href="#fig-oscillator-model" class="quarto-xref">Figure&nbsp;68</a>.</p>
<div id="cell-fig-oscillator-model" class="cell" data-execution_count="68">
<div class="cell-output cell-output-display">
<div id="fig-oscillator-model" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-oscillator-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-oscillator-model-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-68" title="Figure&nbsp;68: A model of a VCO as a perfect integrator for the excess phase in the s-domain."><img src="rfic_files/figure-html/fig-oscillator-model-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-oscillator-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;68: A model of a VCO as a perfect integrator for the excess phase in the <span class="math inline">\(s\)</span>-domain.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In this model we look at the phase output of the oscillator as an <em>excess phase</em> with respect to the nominal phase <span class="math inline">\(\omega_0 t\)</span>. This delta phase is obtained by integrating the tuning voltage <span class="math inline">\(V_\mathrm{tune}(t)\)</span> scaled by <span class="math inline">\(K_\mathrm{VCO}\)</span>.</p>
</section>
</section>
<section id="sec-pll" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Phase-Locked Loops</h1>
<p>Thinking about oscillators, we face a dilemma:</p>
<ul>
<li>Good phase noise performance is reached with high <span class="math inline">\(Q\)</span> in the resonator (see <a href="#eq-leeson-equation" class="quarto-xref">Equation&nbsp;41</a>).</li>
<li>Oscillator tunability requires a tunable resonator, which usually results in a low-to-moderate <span class="math inline">\(Q\)</span>.</li>
<li>Oscillators have inherent frequency stability issues due to temperature variations, device aging, and supply voltage fluctuations.</li>
</ul>
<section id="sec-pll-basic-architecture" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-pll-basic-architecture"><span class="header-section-number">7.1</span> Basic PLL Architecture</h2>
<p>We solve this dilemma by using a <strong>phase-locked loop (PLL)</strong> to stabilize and control the frequency of a tunable oscillator, mostly in the form of a VCO. A PLL is a feedback control system that locks the phase of the VCO output to the phase of a reference signal, typically generated by a crystal oscillator with excellent frequency stability. The block diagram of a basic PLL is shown in <a href="#fig-pll-block-diagram" class="quarto-xref">Figure&nbsp;69</a>.</p>
<div id="cell-fig-pll-block-diagram" class="cell" data-execution_count="69">
<div class="cell-output cell-output-display">
<div id="fig-pll-block-diagram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-block-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-block-diagram-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-69" title="Figure&nbsp;69: Block diagram of a PLL. A reference phase signal is compared to the phase of a VCO output signal in a phase detector. The phase error is low-pass filtered and used to tune the VCO frequency."><img src="rfic_files/figure-html/fig-pll-block-diagram-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-block-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;69: Block diagram of a PLL. A reference phase signal is compared to the phase of a VCO output signal in a phase detector. The phase error is low-pass filtered and used to tune the VCO frequency.
</figcaption>
</figure>
</div>
</div>
</div>
<p>A reference frequency (often coming from a high-<span class="math inline">\(Q\)</span> crystal oscillator) is compared to the phase of a VCO output signal in a phase detector (PD). The phase error is low-pass filtered and used to tune the VCO frequency. By continuously adjusting the VCO based on the phase difference, the PLL ensures that the VCO output remains synchronized with the reference signal, effectively combining the stability of the reference with the tunability of the VCO. When the output signal of the VCO is fed back to the phase detector through a frequency divider (with division ratio <span class="math inline">\(N\)</span>), the PLL can generate output frequencies that are integer multiples of the reference frequency, given by <span class="math inline">\(f_\mathrm{out} = N \cdot f_\mathrm{ref}\)</span>.</p>
<p>The PD compares the phase of the reference signal with the phase of the VCO output signal. It works in the time domain and produces an output voltage proportional to the arrival time difference (phase difference) between the two input signals. This output voltage, known as the phase error signal, indicates whether the VCO is leading or lagging the reference signal in phase, expressed as</p>
<p><span class="math display">\[
\Delta \varphi = 2 \pi \frac{\Delta t}{T_\mathrm{ref}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
V_\mathrm{error} = K_\mathrm{PD} \cdot \Delta \varphi
\]</span></p>
<p>where <span class="math inline">\(\Delta \varphi\)</span> is the phase difference (caused by the arrival time difference) in rad, <span class="math inline">\(K_\mathrm{PD}\)</span> is the phase detector gain in V/rad, <span class="math inline">\(\Delta t\)</span> is the time difference between the two signals, and <span class="math inline">\(T_\mathrm{ref}\)</span> is the period of the reference signal.</p>
<p>An important consideration of the PD is its linear operating range. The PD can only provide a linear output voltage for small phase differences, typically within ±180° (±π rad). If the phase difference exceeds this range, the PD characteristic “wraps around,” leading to ambiguity in the phase error signal. This can cause the PLL to lose lock or behave unpredictably. Therefore, the PLL design must ensure that the phase difference remains within the linear range of the PD during normal operation, which is especially troublesome if the output frequency <span class="math inline">\(f_\mathrm{out}\)</span> is not yet close enough to its final steady-state value. Note that a simple PD can be implemented by using an XOR gate for digital signals or a mixer for analog signals.</p>
<div id="cell-fig-pd-xor-diagram" class="cell" data-execution_count="70">
<div class="cell-output cell-output-display">
<div id="fig-pd-xor-diagram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pd-xor-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pd-xor-diagram-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-70" title="Figure&nbsp;70: Input and output waveforms of an XOR-based phase-detector."><img src="rfic_files/figure-html/fig-pd-xor-diagram-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pd-xor-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;70: Input and output waveforms of an XOR-based phase-detector.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see in <a href="#fig-pd-xor-diagram" class="quarto-xref">Figure&nbsp;70</a> that the output of the XOR PD is high when the two input signals differ and low when they are the same. The output duty cycle is proportional to the phase difference between the two input signals. Note that this PD has no notion of frequency, only phase! Still, it can be used to lock the frequency of the VCO to the reference frequency, as a constant phase difference implies equal frequencies; however, this only works if the initial frequency difference is small enough. Also, this XOR-based PD does not evaluate the edges of the input signals, only their logic states. Therefore, it is crucial that both input signals are square waves with a 50% duty cycle to ensure proper operation of the PD.</p>
<p>As the output signal of the PD contains high-frequency components (at least at twice the reference frequency), a low-pass filter (LPF) is used to smooth the phase error signal before it is applied to the VCO tuning input. The LPF also determines the dynamic response of the PLL, affecting its stability and transient behavior. A well-designed LPF ensures that the PLL can quickly respond to changes in the reference signal or disturbances while maintaining stability and minimizing overshoot or oscillations in the output frequency. Often, the LPF has voltage-mode inputs and outputs to connect to the PD and VCO, respectively.</p>
<p>Using a digital divider in the feedback path to only pass every <span class="math inline">\(N\)</span>-th cycle of the VCO output to the PD allows the PLL to generate output frequencies that are integer multiples of the reference frequency. This is particularly useful in applications such as frequency synthesis, where a wide range of frequencies is required from a single stable reference source. By adjusting the division ratio <span class="math inline">\(N \in \mathbb{N}\)</span>, the PLL can produce various output frequencies while maintaining phase lock with the reference signal. However, note that the frequency resolution of the output frequencies <span class="math inline">\(\Delta f_\mathrm{out}\)</span> is limited to integer multiples of the reference frequency!</p>
<p>Putting everything together into an <span class="math inline">\(s\)</span>-domain block diagram, the PLL can be modeled as shown in <a href="#fig-pll-block-diagram-s-domain" class="quarto-xref">Figure&nbsp;71</a>.</p>
<div id="cell-fig-pll-block-diagram-s-domain" class="cell" data-execution_count="71">
<div class="cell-output cell-output-display">
<div id="fig-pll-block-diagram-s-domain" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-block-diagram-s-domain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-block-diagram-s-domain-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-71" title="Figure&nbsp;71: Laplace domain model of a PLL. Note that input and output signals are (excess) phase in rad."><img src="rfic_files/figure-html/fig-pll-block-diagram-s-domain-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-block-diagram-s-domain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;71: Laplace domain model of a PLL. Note that input and output signals are (excess) phase in rad.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For the loop filter transfer function <span class="math inline">\(H(s)\)</span> we assume a simple first-order low-pass filter with a cutoff frequency of <span class="math inline">\(\omega_\mathrm{LP} = 1 / T_\mathrm{LP}\)</span> given by</p>
<p><span class="math display">\[
H_\mathrm{LP}(s) = \frac{1}{1 + s T_\mathrm{LP}}.
\]</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Why Regulate Phase Instead of Frequency?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before we proceed, it is worth discussing why PLLs regulate the phase of the VCO output rather than its frequency directly. The reason lies in the relationship between phase and frequency: Frequency is the time derivative of phase. By controlling the phase, the PLL inherently controls the frequency as well. Additionally, even if the phase regulation has a steady-state phase error <span class="math inline">\(\varphi_\mathrm{err}\)</span>, the frequency error in steady state is <strong>zero</strong>, as can be appreciated when inspecting</p>
<p><span class="math display">\[
\omega_\mathrm{out}(t) = \frac{d \varphi_\mathrm{out}(t)}{dt}  = \frac{d}{dt} \left[ N \cdot \varphi_\mathrm{ref}(t) + \varphi_\mathrm{err} \right] = N \cdot \frac{d \varphi_\mathrm{ref}(t)}{dt} = N \cdot \omega_\mathrm{ref}(t).
\]</span></p>
</div>
</div>
<p>We now derive the closed-loop transfer function of the PLL from reference phase <span class="math inline">\(\varphi_\mathrm{ref}(s)\)</span> to output phase <span class="math inline">\(\varphi_\mathrm{out}(s)\)</span>. First, we note that</p>
<p><span class="math display">\[
V_\mathrm{PD}(s) = K_\mathrm{PD} \left[ \varphi_\mathrm{ref}(s) - \frac{\varphi_\mathrm{out}(s)}{N} \right]
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\varphi_\mathrm{out}(s) = \frac{K_\mathrm{VCO}}{s} \cdot H_\mathrm{LP}(s) \cdot V_\mathrm{PD}(s) = \frac{K_\mathrm{VCO}}{s} \cdot \frac{1}{1 + s T_\mathrm{LP}} \cdot K_\mathrm{PD} \left[ \varphi_\mathrm{ref}(s) - \frac{\varphi_\mathrm{out}(s)}{N} \right].
\]</span></p>
<p>Not that this equation has one integrator <span class="math inline">\(1/s\)</span> (which we can also see in <a href="#fig-pll-block-diagram-s-domain" class="quarto-xref">Figure&nbsp;71</a>). We call PLLs with one integrator in the loop a <strong>Type-I PLL</strong>. We can now rearrange to find the closed-loop transfer function <span class="math inline">\(H(s)\)</span> as</p>
<p><span id="eq-pll-transfer-function"><span class="math display">\[
H(s) = \frac{\varphi_\mathrm{out}(s)}{\varphi_\mathrm{ref}(s)} = N \cdot \frac{K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP} / N}{s^2 + s \cdot \omega_\mathrm{LP} + K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP} / N}.
\tag{43}\]</span></span></p>
<p>We can use all techniques known from control theory to analyze the stability and dynamic response of the PLL based on <a href="#eq-pll-transfer-function" class="quarto-xref">Equation&nbsp;43</a>, however, we have to keep the following in mind:</p>
<ul>
<li><span class="math inline">\(H(s)\)</span> is a small-signal model of the PLL around its locked operating point, only valid for small perturbations. Large-signal behavior, such as acquisition and lock range, are not captured by this model.</li>
<li>A PLL is a sampled system, working at instances of <span class="math inline">\(T_\mathrm{ref}\)</span>. <span class="math inline">\(H(s)\)</span> is a continuous-time approximation, which is valid only if the loop bandwidth is much smaller (typically <span class="math inline">\(1/10\)</span>) than the reference frequency <span class="math inline">\(f_\mathrm{ref}\)</span>. If this approximation is not valid, a discrete-time model of the PLL must be used, deriving the <span class="math inline">\(z\)</span>-domain transfer function <span class="math inline">\(H(z)\)</span>.</li>
</ul>
<p>If we compare the canonical form of a second-order system given by</p>
<p><span class="math display">\[
H(s) = K \cdot \frac{\omega_\mathrm{n}^2}{s^2 + s \cdot 2 \zeta \omega_\mathrm{n} + \omega_\mathrm{n}^2},
\]</span></p>
<p>with <a href="#eq-pll-transfer-function" class="quarto-xref">Equation&nbsp;43</a>, we can identify the natural frequency <span class="math inline">\(\omega_n\)</span> and the damping factor <span class="math inline">\(\zeta\)</span> of the PLL as</p>
<p><span class="math display">\[
\omega_\mathrm{n} = \sqrt{\frac{K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP}}{N}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\zeta = \frac{1}{2} \sqrt{\frac{\omega_\mathrm{LP} \cdot N}{K_\mathrm{VCO} \cdot K_\mathrm{PD}}}.
\]</span></p>
<p>This allows us to use standard control theory results to design the PLL parameters <span class="math inline">\(K_\mathrm{PD}\)</span>, <span class="math inline">\(K_\mathrm{VCO}\)</span>, <span class="math inline">\(\omega_\mathrm{LP}\)</span>, and <span class="math inline">\(N\)</span> to achieve the desired dynamic response and stability margins. Note that <span class="math inline">\(\omega_\mathrm{n}\)</span> and <span class="math inline">\(\zeta\)</span> are not independent, as they both depend on the same set of PLL parameters! This seriously limits the design of the loop dynamics, and means that we need a more complex loop filter <span class="math inline">\(H_\mathrm{LP}(s)\)</span> to achieve more freedom in selecting <span class="math inline">\(\omega_\mathrm{n}\)</span> and <span class="math inline">\(\zeta\)</span> independently. Often, we want to choose <span class="math inline">\(\zeta = 1/\sqrt{2} \approx 0.707\)</span> to achieve a Butterworth response for a good step response without overshoot.</p>
<p>The poles of a second-order system are given by</p>
<p><span class="math display">\[
p_{1,2} = -\omega_\mathrm{n} \left( \zeta \pm \sqrt{\zeta^2 - 1} \right)
\]</span></p>
<p>with <span class="math inline">\(\zeta = 1/\sqrt{2}\)</span> resulting in complex conjugate poles at</p>
<p><span class="math display">\[
p_{1,2} = -\frac{\omega_\mathrm{n}}{\sqrt{2}} \pm j \frac{\omega_\mathrm{n}}{\sqrt{2}}.
\]</span></p>
<p>To summarize: We can make a simple PLL using an XOR for a PD, use a first-order LPF, plus a feedback divider to get frequency multiplication of <span class="math inline">\(f_\mathrm{out} = N \cdot f_\mathrm{ref}\)</span>. However, the control over the loop dynamics is very limited, and the locking procedure of the PLL is tricky, as the PD has a limited linear range of ±180°, requiring that the VCO frequency at the start of the locking procedure is already close enough to the desired output frequency. In addition, <span class="math inline">\(N\)</span> is an integer, limiting the frequency resolution of the output frequencies to integer multiples of the reference frequency.</p>
<p>The question is how to improve the PLL design to overcome these limitations? We will explore advanced PLL architectures and techniques in the following section.</p>
</section>
<section id="sec-pll-charge-pump" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-pll-charge-pump"><span class="header-section-number">7.2</span> Charge-Pump PLL</h2>
<p>The fundamental limitations of the simple PLL architecture presented in <a href="#sec-pll-basic-architecture" class="quarto-xref">Section&nbsp;7.1</a> can be addressed by using a more sophisticated phase detector known as a <strong>phase-frequency detector (PFD)</strong> in combination with a <strong>charge pump (CP)</strong> <span class="citation" data-cites="Gardner.1980">(<a href="#ref-Gardner.1980" role="doc-biblioref">Gardner 1980</a>)</span>. This combination allows for better control over the loop dynamics and improved locking behavior.</p>
<p>In order to drive the CP, we envision a PFD with two digital outputs: An “up” signal that indicates when the VCO phase lags behind the reference phase, and a “down” signal that indicates when the VCO phase leads the reference phase. The PFD compares both the phase and frequency of the reference and feedback signals, providing a more robust locking mechanism. The typical implementation of a PFD is shown in <a href="#fig-pfd-implementation" class="quarto-xref">Figure&nbsp;72</a>.</p>
<div id="cell-fig-pfd-implementation" class="cell" data-execution_count="72">
<div class="cell-output cell-output-display">
<div id="fig-pfd-implementation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pfd-implementation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pfd-implementation-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-72" title="Figure&nbsp;72: Implementation of a phase-frequency detector."><img src="rfic_files/figure-html/fig-pfd-implementation-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pfd-implementation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;72: Implementation of a phase-frequency detector.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The PFD operates as follows:</p>
<ul>
<li>If the reference signal leads the feedback signal (its rising edge arrives first), the “UP” output is activated, causing the CP to source current into the integration capacitor, <em>increasing</em> the VCO tuning voltage and thus the VCO frequency.</li>
<li>If the feedback signal leads the reference signal (its rising edge arrives first), the “DOWN” output is activated, causing the CP to sink current from the integration capacitor, <em>decreasing</em> the VCO tuning voltage and thus the VCO frequency.</li>
<li>If both signals are aligned in phase and frequency, both outputs are only activated for a short time (the gate delays of the DFF and the AND), and the CP does not source or sink current; the integration capacitor in the loop filter holds its voltage, maintaining the VCO frequency.</li>
<li>The rising edge that arrives last resets both outputs, ensuring that the CP only sources or sinks current for a duration proportional to the phase difference between the two signals.</li>
</ul>
<p>In the following, we will look at four different cases of PFD operation to illustrate its behavior.</p>
<ol type="1">
<li><em>Reference leads feedback</em>: The “UP” output is activated, and the CP sources current to the loop filter, increasing the VCO frequency.</li>
</ol>
<div id="cell-fig-pfd-diagram1" class="cell" data-execution_count="73">
<div class="cell-output cell-output-display">
<div id="fig-pfd-diagram1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pfd-diagram1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pfd-diagram1-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-73" title="Figure&nbsp;73: Reference leading the VCO feedback signal, frequencies are already aligned."><img src="rfic_files/figure-html/fig-pfd-diagram1-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pfd-diagram1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;73: Reference leading the VCO feedback signal, frequencies are already aligned.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><em>Feedback leads reference</em>: The “DOWN” output is activated, and the CP sinks current from the loop filter, decreasing the VCO frequency.</li>
</ol>
<div id="cell-fig-pfd-diagram2" class="cell" data-execution_count="74">
<div class="cell-output cell-output-display">
<div id="fig-pfd-diagram2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pfd-diagram2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pfd-diagram2-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-74" title="Figure&nbsp;74: VCO feedback signal leading the reference, frequencies are already aligned."><img src="rfic_files/figure-html/fig-pfd-diagram2-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pfd-diagram2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;74: VCO feedback signal leading the reference, frequencies are already aligned.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><em>Both signals aligned</em>: Both outputs are briefly activated, but the CP does not source or sink current, maintaining the VCO frequency.</li>
</ol>
<div id="cell-fig-pfd-diagram3" class="cell" data-execution_count="75">
<div class="cell-output cell-output-display">
<div id="fig-pfd-diagram3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pfd-diagram3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pfd-diagram3-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-75" title="Figure&nbsp;75: VCO feedback and reference signal are aligned in phase and frequency."><img src="rfic_files/figure-html/fig-pfd-diagram3-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pfd-diagram3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;75: VCO feedback and reference signal are aligned in phase and frequency.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><em>Large frequency difference</em>: The PFD continues to source or sink current until the phases align, allowing the PLL to acquire lock even with large initial frequency differences.</li>
</ol>
<div id="cell-fig-pfd-diagram4" class="cell" data-execution_count="76">
<div class="cell-output cell-output-display">
<div id="fig-pfd-diagram4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pfd-diagram4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pfd-diagram4-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-76" title="Figure&nbsp;76: VCO feedback and reference signal have different frequencies (the VCO frequency is too high). There will be some periods with a wrong output (as shown here in the first cycle), but on average the phase-frequency detector output will indicate that the VCO frequency must be decreased."><img src="rfic_files/figure-html/fig-pfd-diagram4-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pfd-diagram4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;76: VCO feedback and reference signal have different frequencies (the VCO frequency is too high). There will be some periods with a wrong output (as shown here in the first cycle), but on average the phase-frequency detector output will indicate that the VCO frequency must be decreased.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Let us now investigate the circuit of the CP. The UP and DOWN signals from the PFD control two current sources/sinks connected to the loop filter capacitor, as shown in <a href="#fig-cp-implementation" class="quarto-xref">Figure&nbsp;77</a>.</p>
<div id="cell-fig-cp-implementation" class="cell" data-execution_count="77">
<div class="cell-output cell-output-display">
<div id="fig-cp-implementation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cp-implementation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-cp-implementation-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-77" title="Figure&nbsp;77: Charge pump consisting of two matched current sources and switches. The resistor in series with the capacitor introduces a zero."><img src="rfic_files/figure-html/fig-cp-implementation-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cp-implementation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;77: Charge pump consisting of two matched current sources and switches. The resistor in series with the capacitor introduces a zero.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When the UP signal is high, the CP <em>sources</em> a constant current <span class="math inline">\(I_\mathrm{CP}\)</span> into the loop filter capacitor <span class="math inline">\(C_\mathrm{int}\)</span>, increasing its voltage linearly over time according to the phase error. Conversely, when the DOWN signal is high, the CP <em>sinks</em> a constant current <span class="math inline">\(I_\mathrm{CP}\)</span> from the capacitor, decreasing its voltage linearly.</p>
<p>Note that the top and bottom current sources must be well matched to ensure symmetric operation of the CP and should have a wide operating range. The output impedance of the CP is ideally very high so that the charge pump current does not depend on the voltage across the loop filter capacitor. Further, the switches introduce charge injection and clock feedthrough, which can cause unwanted ripples on the loop filter voltage, leading to spurious signals in the PLL output. Careful design of the switches and layout techniques are necessary to minimize these effects.</p>
<p>The voltage change on the capacitor can be expressed as</p>
<p><span id="eq-cp-voltage-change"><span class="math display">\[
\Delta V_\mathrm{LF} = \frac{1}{C_\mathrm{LF}} \int_0^{t_\mathrm{on}} I_\mathrm{int} \cdot dt
\tag{44}\]</span></span></p>
<p>where <span class="math inline">\(t_\mathrm{on}\)</span> is the duration for which the UP or DOWN signal is active, proportional to the phase difference between the reference and feedback signals.</p>
<p>Taking the Laplace transform of <a href="#eq-cp-voltage-change" class="quarto-xref">Equation&nbsp;44</a>, we find the transfer function of the CP from the UP/DOWN control signals to the loop filter voltage as</p>
<p><span id="eq-cp-transfer-function"><span class="math display">\[
H_\mathrm{CP}(s) = \frac{I_\mathrm{CP}}{2 \pi} \left( \frac{1}{s C_\mathrm{int}} + R_\mathrm{int} \right)
\tag{45}\]</span></span></p>
<p>where we have added a resistor <span class="math inline">\(R_\mathrm{int}\)</span> in series with the capacitor <span class="math inline">\(C_\mathrm{int}\)</span> to introduce a zero in the loop filter transfer function, clearly showing the zero introduced by the resistor <span class="math inline">\(R_\mathrm{int}\)</span> in series with the capacitor <span class="math inline">\(C_\mathrm{int}\)</span>. The need for this zero will become apparent when we analyze the PLL loop dynamics next.</p>
<p>The resulting PLL using a PFD-CP combination is shown in <a href="#fig-pll-pfd-cp" class="quarto-xref">Figure&nbsp;78</a>.</p>
<div id="cell-fig-pll-pfd-cp" class="cell" data-execution_count="78">
<div class="cell-output cell-output-display">
<div id="fig-pll-pfd-cp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-pfd-cp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-pfd-cp-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-78" title="Figure&nbsp;78: Diagram of a PFD-CP PLL. Note the added first-order lowpass which has been added to reduce the CP switching ripple."><img src="rfic_files/figure-html/fig-pll-pfd-cp-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-pfd-cp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;78: Diagram of a PFD-CP PLL. Note the added first-order lowpass which has been added to reduce the CP switching ripple.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Neglecting <span class="math inline">\(R_\mathrm{lp}\)</span> and <span class="math inline">\(C_\mathrm{lp}\)</span> for now, we can derive the closed-loop transfer function of the PLL from reference phase <span class="math inline">\(\varphi_\mathrm{ref}(s)\)</span> to output phase <span class="math inline">\(\varphi_\mathrm{out}(s)\)</span> as</p>
<p><span id="eq-cp-pll-transfer-function"><span class="math display">\[
H(s) = \frac{\varphi_\mathrm{out}(s)}{\varphi_\mathrm{ref}(s)} = N \cdot \frac{\frac{I_\mathrm{CP} K_\mathrm{VCO}}{2 \pi C_\mathrm{int} N} (1 + s C_\mathrm{int} R_\mathrm{int})}{s^2 + s \frac{I_\mathrm{CP} K_\mathrm{VCO} R_\mathrm{int}}{2 \pi N} + \frac{I_\mathrm{CP} K_\mathrm{VCO}}{2 \pi C_\mathrm{int} N}} = N \cdot \frac{s \cdot 2 \zeta \omega_\mathrm{n} + \omega_\mathrm{n}^2}{s^2 + s \cdot 2 \zeta \omega_\mathrm{n} + \omega_\mathrm{n}^2}
\tag{46}\]</span></span></p>
<p>with</p>
<p><span id="eq-cp-pll-natural-frequency"><span class="math display">\[
\omega_\mathrm{n} = \sqrt{\frac{I_\mathrm{CP} K_\mathrm{VCO}}{2 \pi C_\mathrm{int} N}}
\tag{47}\]</span></span></p>
<p>and</p>
<p><span id="eq-cp-pll-damping-factor"><span class="math display">\[
\zeta = \frac{R_\mathrm{int}}{2} \sqrt{\frac{I_\mathrm{CP} K_\mathrm{VCO} C_\mathrm{int}}{2 \pi N}}.
\tag{48}\]</span></span></p>
<p>Looking at <a href="#eq-cp-pll-natural-frequency" class="quarto-xref">Equation&nbsp;47</a> and <a href="#eq-cp-pll-damping-factor" class="quarto-xref">Equation&nbsp;48</a>, we can see that we now have one <em>independent</em> parameter (<span class="math inline">\(R_\mathrm{int}\)</span>) to set the natural frequency <span class="math inline">\(\omega_\mathrm{n}\)</span> and the damping factor <span class="math inline">\(\zeta\)</span> of the PLL independently. This allows us to design the loop dynamics more flexibly to achieve the desired performance.</p>
<p>With <a href="#eq-cp-pll-damping-factor" class="quarto-xref">Equation&nbsp;48</a>, we can now appreciate the need for the resistor <span class="math inline">\(R_\mathrm{int}\)</span> in series with the capacitor <span class="math inline">\(C_\mathrm{int}\)</span> in the loop filter. Without this resistor, the damping factor <span class="math inline">\(\zeta\)</span> would be zero, leading to an undamped system with oscillatory behavior and poor transient response. The resistor introduces a zero in the loop filter transfer function, providing the necessary damping to stabilize the PLL and improve its dynamic response.</p>
<p>Looking at <a href="#fig-pll-pfd-cp" class="quarto-xref">Figure&nbsp;78</a> and <a href="#eq-cp-transfer-function" class="quarto-xref">Equation&nbsp;45</a>, we can also see that the PFD-CP introduces another integrator in the loop. This integrator, together with the integrator from the VCO, makes the PLL a <strong>Type-II PLL</strong>. A Type-II PLL can achieve zero steady-state phase error for step changes in the reference phase and zero steady-state frequency error for ramp changes in the reference frequency.</p>
<p>In conclusion:</p>
<ul>
<li>The PLL regulates the phase of a VCO to match the phase of a reference signal, using feedback control. Even with a steady-state phase error, the frequency error is zero (Type-I PLL). In a Type-II PLL, both phase and frequency errors are zero in steady state.</li>
<li>The lowpass behavior of the loop filter determines the dynamic response and stability of the PLL.</li>
<li>Further, the PLL transfer function from reference phase to output phase has the form of a lowpass, which passes the reference oscillator phase noise to the output inside the passband. The phase noise of the VCO is suppressed inside the loop bandwidth, as the PLL corrects for phase deviations.</li>
<li>Outside the PLL loop bandwidth, the VCO phase noise dominates, as the PLL cannot correct for phase deviations fast enough.</li>
</ul>
<p>This phase noise shaping behavior is illustrated in <a href="#fig-pll-phase-noise" class="quarto-xref">Figure&nbsp;79</a>, which shows how the reference and VCO phase noise contributions combine to form the total PLL output phase noise.</p>
<div id="cell-fig-pll-phase-noise" class="cell" data-execution_count="79">
<div class="cell-output cell-output-display">
<div id="fig-pll-phase-noise" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-phase-noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-phase-noise-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-79" title="Figure&nbsp;79: PLL phase noise contributions at the PLL output showing reference phase noise (increased by 20*log(N) and low-pass shaped), VCO phase noise (high-pass shaped), and total phase noise. The loop bandwidth determines the crossover frequency between reference and VCO phase noise contributions. For effective rejection of the 1/f³ VCO phase noise, a higher-order loop filter (shown is 3rd order) is beneficial."><img src="rfic_files/figure-html/fig-pll-phase-noise-output-1.png" width="656" height="463" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-phase-noise-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;79: PLL phase noise contributions at the PLL output showing reference phase noise (increased by 20*log(N) and low-pass shaped), VCO phase noise (high-pass shaped), and total phase noise. The loop bandwidth determines the crossover frequency between reference and VCO phase noise contributions. For effective rejection of the 1/f³ VCO phase noise, a higher-order loop filter (shown is 3rd order) is beneficial.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that inside the PLL loop bandwidth the reference phase noise is multiplied by the division ratio <span class="math inline">\(N\)</span> in power, i.e., <span class="math inline">\(20 \log_{10}(N)\)</span> in dB, as the PLL output frequency is <span class="math inline">\(N\)</span> times the reference frequency. In <a href="#fig-pll-phase-noise" class="quarto-xref">Figure&nbsp;79</a>, <span class="math inline">\(N = 100\)</span> and a reference phase noise of -140 dBc/Hz is used. Large values of <span class="math inline">\(N\)</span> can significantly increase the reference phase noise contribution at the PLL output, which is why low phase noise references are essential for high-performance PLLs.</p>
</section>
<section id="sec-pll-all-digital" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-pll-all-digital"><span class="header-section-number">7.3</span> All-Digital PLL</h2>
<p>In the PLL implementations discussed so far, we have used analog components such as the VCO, loop filter, and charge pump. While these analog PLLs can achieve excellent performance, they also come with challenges such as component variability, temperature sensitivity, and integration complexity in modern digital processes. The question arises: Can we implement a PLL using only digital components to overcome these challenges? The answer is yes, leading to the concept of the <strong>all-digital phase-locked loop (ADPLL)</strong> <span class="citation" data-cites="Staszewski.2003">(<a href="#ref-Staszewski.2003" role="doc-biblioref">Staszewski et al. 2003</a>)</span>, where a block diagram is shown in <a href="#fig-adpll-block-diagram" class="quarto-xref">Figure&nbsp;80</a>.</p>
<div id="cell-fig-adpll-block-diagram" class="cell" data-execution_count="80">
<div class="cell-output cell-output-display">
<div id="fig-adpll-block-diagram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-adpll-block-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-adpll-block-diagram-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-80" title="Figure&nbsp;80: Block diagram of an all-digital PLL. A reference phase signal is compared to the phase of a VCO output signal in a time-to-digital converter. The phase error word is digitally low-pass filtered and used to tune the DCO frequency via a frequency control word."><img src="rfic_files/figure-html/fig-adpll-block-diagram-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-adpll-block-diagram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;80: Block diagram of an all-digital PLL. A reference phase signal is compared to the phase of a VCO output signal in a time-to-digital converter. The phase error word is digitally low-pass filtered and used to tune the DCO frequency via a frequency control word.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Conceptually, the ADPLL in <a href="#fig-adpll-block-diagram" class="quarto-xref">Figure&nbsp;80</a> is similar to the analog PLL in <a href="#fig-pll-block-diagram" class="quarto-xref">Figure&nbsp;69</a>, with the key difference being that all components are implemented digitally. The phase detector is replaced by a time-to-digital converter (TDC), which measures the time difference between the reference and feedback signal edges and converts it into a digital phase error word. The loop filter is implemented as a digital filter (FIR, IIR, or similar), processing the phase error word to generate a tuning word for the digitally controlled oscillator (DCO). The DCO generates the output frequency based on the tuning word, completing the feedback loop.</p>
<p>The advantages of the ADPLL are that it can be fully integrated in a digital nm CMOS process, benefiting from scalability, low power consumption, small chip area, and immunity to analog component variations. Additionally, the digital nature of the ADPLL allows for easy programmability and adaptability to different applications. However, the ADPLL also faces challenges such as quantization noise from the TDC and DCO.</p>
<section id="sec-pll-tdc" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-pll-tdc"><span class="header-section-number">7.3.1</span> Time-to-Digital Converter</h3>
<p>The TDC is a crucial component of the ADPLL, responsible for measuring the time difference between the reference and feedback signal edges and converting it into a digital phase error word. The TDC operates by sampling the time interval between two events (the rising edges of the reference and feedback signals) and quantizing this interval into discrete levels. TDCs can be implemented using various techniques. One popular method is using a digital delay line. An exemplary implementation is shown in <a href="#fig-pll-tdc" class="quarto-xref">Figure&nbsp;81</a>.</p>
<div id="cell-fig-pll-tdc" class="cell" data-execution_count="81">
<div class="cell-output cell-output-display">
<div id="fig-pll-tdc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-tdc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-tdc-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-81" title="Figure&nbsp;81: Basic TDC implementation as a delay line with parallel capture flip-flops. The TDC delay resolution is limited two inverter delays."><img src="rfic_files/figure-html/fig-pll-tdc-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-tdc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;81: Basic TDC implementation as a delay line with parallel capture flip-flops. The TDC delay resolution is limited two inverter delays.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-pll-tdc" class="quarto-xref">Figure&nbsp;81</a>, the reference signal edge runs through a series of buffers (delay elements) connected in a delay line configuration. The feedback signal edge is used to sample the state of the delay line at the moment it arrives. The outputs of the DFFs represent the time difference between the reference and feedback signals, which can be encoded into a digital phase error word. The resolution of the TDC is determined by the delay between each stage in the delay line, with finer delays providing higher resolution. However, increasing the resolution also increases the complexity and power consumption of the TDC.</p>
<p>The phase noise of the TDC (at the output of the ADPLL) arising from this time measurement quantization can be modeled as</p>
<p><span class="math display">\[
\mathcal{L}\left\{f\right\} = 10 \cdot \log \left[ \frac{(2 \pi)^2}{12 f_\mathrm{ref}} \cdot \left(  \frac{\Delta T_\mathrm{TDC}}{T_\mathrm{DCO}} \right)^2 \right]
\]</span></p>
<p>where <span class="math inline">\(\Delta T_\mathrm{TDC}\)</span> is the time resolution of the TDC, <span class="math inline">\(T_\mathrm{DCO}\)</span> is the period of the DCO output frequency, and <span class="math inline">\(f_\mathrm{ref}\)</span> is the reference frequency. This equation shows that improving the TDC resolution (reducing <span class="math inline">\(\Delta T_\mathrm{TDC}\)</span>) and increasing the reference frequency can help reduce the phase noise contribution from the TDC.</p>
<div id="nte-channel-limit" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note&nbsp;8: TDC Resolution Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>To get an idea of the performance requirements for the TDC, we assume a DCO output frequency of 2.4 GHz (e.g., for a Bluetooth application) and a reference frequency of 40 MHz. If we aim for a TDC phase noise contribution of -100 dBc/Hz at the DCO output, we can rearrange the above equation to find the required TDC time resolution:</p>
<p><span class="math display">\[
\Delta T_\mathrm{TDC} = T_\mathrm{DCO} \cdot \sqrt{\frac{12 f_\mathrm{ref} \cdot 10^{\mathcal{L}\left\{f\right\}/10}}{(2 \pi)^2}} = \frac{1}{2.4 \times 10^9} \cdot \sqrt{\frac{12 \cdot 40 \times 10^6 \cdot 10^{-10}}{(2 \pi)^2}} \approx 15\,\text{ps}
\]</span></p>
<p>This number is challenging but achievable with modern TDC designs.</p>
</div>
</div>
</section>
<section id="sec-pll-dco" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-pll-dco"><span class="header-section-number">7.3.2</span> Digitally Controlled Oscillator</h3>
<p>With the implementation of the TDC clarified in <a href="#sec-pll-tdc" class="quarto-xref">Section&nbsp;7.3.1</a>, we now turn our attention to the digitally controlled oscillator (DCO), which generates the output frequency of the ADPLL based on a digital tuning word. The DCO is a digital equivalent of the VCO used in analog PLLs, and its frequency is adjusted by changing the digital input value. Fundamentally, two possible implementations exist:</p>
<ol type="1">
<li>An analog-controlled oscillator (e.g., a VCO) is combined with a digital-to-analog converter (DAC) to convert the digital tuning word into an analog control voltage. This approach is shown in <a href="#fig-pll-dco-dac" class="quarto-xref">Figure&nbsp;82</a>.</li>
</ol>
<div id="cell-fig-pll-dco-dac" class="cell" data-execution_count="82">
<div class="cell-output cell-output-display">
<div id="fig-pll-dco-dac" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-dco-dac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-dco-dac-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-82" title="Figure&nbsp;82: Digitally controlled oscillator using a DAC."><img src="rfic_files/figure-html/fig-pll-dco-dac-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-dco-dac-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;82: Digitally controlled oscillator using a DAC.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>A digitally-controlled oscillator is using a large number of small varactors or switched capacitor banks to adjust the oscillation frequency directly based on the digital tuning word. An example implementation of a switched varactor is shown in <a href="#fig-dco-switched-varactor" class="quarto-xref">Figure&nbsp;83</a>, or a switched capacitor like shown in <a href="#fig-switched-capacitor" class="quarto-xref">Figure&nbsp;67</a> is used.</li>
</ol>
<div id="cell-fig-dco-switched-varactor" class="cell" data-execution_count="83">
<div class="cell-output cell-output-display">
<div id="fig-dco-switched-varactor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dco-switched-varactor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-dco-switched-varactor-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-83" title="Figure&nbsp;83: A switched differential varactor used for fine frequency control in a DCO."><img src="rfic_files/figure-html/fig-dco-switched-varactor-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dco-switched-varactor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;83: A switched differential varactor used for fine frequency control in a DCO.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It has to be noted that while an ADPLL seems conceptually simpler than an analog PLL, the design of high-performance TDCs and DCOs can be quite complex and requires careful consideration of quantization noise, linearity, and power consumption. Coupling effects between different circuit blocks can also introduce unwanted spurs and phase noise folding in the ADPLL output. Therefore, while ADPLLs offer many advantages, they also present unique design challenges that must be addressed to achieve optimal performance.</p>
</section>
</section>
<section id="sec-pll-frac-n" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="sec-pll-frac-n"><span class="header-section-number">7.4</span> Fractional-N PLL</h2>
<p>With the PLL architectures discussed so far, the output frequency resolution is limited to integer multiples of the reference frequency, i.e., <span class="math inline">\(f_\mathrm{out} = N \cdot f_\mathrm{ref}\)</span> with <span class="math inline">\(N \in \mathbb{N}\)</span>. For a fine output frequency resolution, this requires a very low reference frequency. With the rule of thumb that the PLL loop bandwidth should be less than <span class="math inline">\(f_\mathrm{ref}/10\)</span> to ensure stable operation, a low reference frequency also limits the achievable loop bandwidth, which is detrimental to phase noise performance and settling time. Further, we have learned in <a href="#sec-pll-charge-pump" class="quarto-xref">Section&nbsp;7.2</a> that large values of <span class="math inline">\(N\)</span> increase the reference phase noise contribution at the PLL output by <span class="math inline">\(20 \log_{10}(N)\)</span> dB, making it challenging to achieve low phase noise performance with high frequency resolution.</p>
<p>How to break these fundamental limitations? The answer lies in the concept of the <strong>fractional-N PLL</strong>, which allows for non-integer frequency multiplication.</p>
<p>Assume we want to generate an output frequency of <span class="math inline">\(f_\mathrm{out} = 2.45\,\text{GHz}\)</span> from a reference frequency of <span class="math inline">\(f_\mathrm{ref} = 40\,\text{MHz}\)</span>. This requires a frequency multiplication factor of <span class="math inline">\(N = 61.25\)</span>, which is not an integer. To achieve this, the fractional-N PLL employs a feedback divider that can switch between two integer division ratios, <span class="math inline">\(N_1\)</span> and <span class="math inline">\(N_2\)</span>, such that the average division ratio over time equals the desired fractional value (the averaging is performed by the lowpass loopfilter, providing the averaged tuning voltage to the VCO / the tuning word to the DCO). In this case, we can choose <span class="math inline">\(N_1 = 61\)</span> and <span class="math inline">\(N_2 = 62\)</span>. By alternating between these two division ratios in a controlled manner, the PLL can effectively achieve an average division ratio of 61.25, allowing it to generate the desired output frequency of 2.45 GHz. The following sequence illustrates this concept over four reference cycles:</p>
<p><span class="math display">\[
N = N_1, N_1, N_1, N_2 \implies \text{Average } N = \frac{61 + 61 + 61 + 62}{4} = 61.25
\]</span></p>
<p>A simple sequence like the one above works, but would lead to significant spurs in the PLL output spectrum due to the periodic nature of the division ratio switching, especially when the fractionality is close to an integer, and thus the sequence is long. Consider the case of <span class="math inline">\(N = 61.01\)</span>, where we would need to switch to <span class="math inline">\(N_2 = 62\)</span> only once every 100 cycles of <span class="math inline">\(N_1 = 61\)</span>:</p>
<p><span class="math display">\[
N = \frac{99 \cdot 61 + 1 \cdot 62}{100} = 61.01
\]</span></p>
<p>This periodic switching introduces spurious tones in the PLL output spectrum at multiples of <span class="math inline">\(f_\mathrm{ref}/100\)</span>, which can potentially pass through the loop filter and appear in the output spectrum, degrading the signal quality.</p>
<p>To minimize these spurs, more sophisticated techniques such as <em>delta-sigma modulation</em> are employed to <em>randomize</em> the switching sequence, spreading the quantization noise over a wider frequency range and reducing its impact on the PLL output. Additionally, the quantization noise introduced by the fractional division is <em>pushed to higher frequencies</em> where it can be more easily filtered out by the loop filter.</p>
<section id="sec-pll-delta-sigma" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="sec-pll-delta-sigma"><span class="header-section-number">7.4.1</span> Delta-Sigma Modulator</h3>
<p>For an in-depth understanding of delta-sigma modulation, we refer to <span class="citation" data-cites="Schreier_DSM">(<a href="#ref-Schreier_DSM" role="doc-biblioref">Schreier, Pavan, and Temes 2017</a>)</span>. Here, we briefly summarize the key concepts relevant to fractional-N PLLs. In a nutshell, a delta-sigma modulator (DSM) is a feedback system that shapes quantization noise to higher frequencies, allowing for high-resolution digital-to-analog conversion or frequency synthesis. The basic structure of a first-order DSM is shown in <a href="#fig-pll-dsm-first-order" class="quarto-xref">Figure&nbsp;84</a>.</p>
<div id="cell-fig-pll-dsm-first-order" class="cell" data-execution_count="84">
<div class="cell-output cell-output-display">
<div id="fig-pll-dsm-first-order" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-dsm-first-order-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-dsm-first-order-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-84" title="Figure&nbsp;84: A first-order continuous time delta-sigma modulator."><img src="rfic_files/figure-html/fig-pll-dsm-first-order-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-dsm-first-order-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;84: A first-order continuous time delta-sigma modulator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-pll-dsm-first-order" class="quarto-xref">Figure&nbsp;84</a>, the input signal <span class="math inline">\(X(s)\)</span> is transferred to the output <span class="math inline">\(Y(s)\)</span> with the following transfer function (we set <span class="math inline">\(Q = 0\)</span>):</p>
<p><span class="math display">\[
Y(s) = X(s) \cdot \frac{1}{1 + s T} = X(s) \cdot H_\mathrm{LP}(s)
\]</span></p>
<p>The quantization noise <span class="math inline">\(Q(s)\)</span> introduced by the quantizer is shaped by the feedback loop, resulting in the following output contribution:</p>
<p><span class="math display">\[
Y(s) = Q(s) \cdot \frac{s T}{1 + s T} = Q(s) \cdot H_\mathrm{HP}(s)
\]</span></p>
<p>We can see that the quantization noise is highpass filtered, pushing it to higher frequencies, where it can be more easily filtered out by a subsequent lowpass filter.</p>
<p>The digital implementation of a first-order DSM is straightforward and one possible form is shown in <a href="#fig-pll-dsm-digital-first-order" class="quarto-xref">Figure&nbsp;85</a>. At the point of truncation from <span class="math inline">\(N+2\)</span> bit to 1 bit (the MSB) we imagine the quantization noise <span class="math inline">\(q[n]\)</span> being added to the signal.</p>
<div id="cell-fig-pll-dsm-digital-first-order" class="cell" data-execution_count="85">
<div class="cell-output cell-output-display">
<div id="fig-pll-dsm-digital-first-order" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-dsm-digital-first-order-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-dsm-digital-first-order-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-85" title="Figure&nbsp;85: A first-order digital delta-sigma modulator."><img src="rfic_files/figure-html/fig-pll-dsm-digital-first-order-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-dsm-digital-first-order-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;85: A first-order digital delta-sigma modulator.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Calculating the <span class="math inline">\(z\)</span>-domain transfer functions from input <span class="math inline">\(X(z)\)</span> to the output <span class="math inline">\(Y(z)\)</span> (the signal transfer function, STF) and quantization noise <span class="math inline">\(Q(z)\)</span> to <span class="math inline">\(Y(z)\)</span> (the noise transfer function, NTF), we find</p>
<p><span class="math display">\[
\frac{Y(z)}{X(z)} = \text{STF}(z) = z^{-1} \implies \text{STF}(z) = z^{-1}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\frac{Y(z)}{Q(z)} = \text{NTF}(z) = (1 - z^{-1}) \implies \text{NTF} = 1 - z^{-1}.
\]</span></p>
<p>We see that the STF is a simple delay, while the NTF has a zero at DC, pushing the quantization noise to higher frequencies. Taking the Laplace transform of the NTF to find the frequency shaped PSD of the quantization noise, we find</p>
<p><span class="math display">\[
S_\mathrm{y}(f) = S_\mathrm{q}(f) |H(f)|^2 = S_\mathrm{q}(f) \cdot 2 \left| 1 - \cos(2 \pi f T_\mathrm{s}) \right| \implies H(f) = \sqrt{ 2 \left| 1 - \cos(2 \pi f T_\mathrm{s}) \right| }.
\]</span></p>
<p>with <span class="math inline">\(T_\mathrm{s}\)</span> being the sampling period of the DSM. The resulting <span class="math inline">\(H(f)\)</span> is shown in <a href="#fig-pll-dsm-ntf-plot" class="quarto-xref">Figure&nbsp;86</a>. With the assumed PLL loop bandwidth of 100 kHz and a reference frequency of 40 MHz, we can see that the quantization noise is significantly attenuated inside the PLL loop bandwidth, minimizing its impact on the PLL output phase noise. The general trend is that higher-order DSMs and faster sampling frequencies lead to better noise shaping and lower in-band quantization noise.</p>
<div id="cell-fig-pll-dsm-ntf-plot" class="cell" data-execution_count="86">
<div class="cell-output cell-output-display">
<div id="fig-pll-dsm-ntf-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-dsm-ntf-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-dsm-ntf-plot-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-86" title="Figure&nbsp;86: NTF H(f) of a first-order delta-sigma modulator showing the high-pass noise shaping characteristic. The quantization noise is suppressed at low frequencies and increases towards the Nyquist frequency. An exemplary loop filter bandwidth of 300 kHz for a 40 MHz reference frequency is indicated."><img src="rfic_files/figure-html/fig-pll-dsm-ntf-plot-output-1.png" width="656" height="464" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-dsm-ntf-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;86: NTF H(f) of a first-order delta-sigma modulator showing the high-pass noise shaping characteristic. The quantization noise is suppressed at low frequencies and increases towards the Nyquist frequency. An exemplary loop filter bandwidth of 300 kHz for a 40 MHz reference frequency is indicated.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we analyze the signal properties of the number sequence generated by the first-order DSM in <a href="#fig-pll-dsm-digital-first-order" class="quarto-xref">Figure&nbsp;85</a>, we find that its randomization properties are not ideal, leading to spurs in the PLL output spectrum. To improve the randomization properties, higher-order DSMs are used in fractional-N PLLs, especially 2nd or 3rd order. A consequence of a higher-order DSM is that the produced sequence can take more values than just <span class="math inline">\(N\)</span> and <span class="math inline">\(N+1\)</span>. The range of produced values is shown in <a href="#tbl-pll-dsm-orders" class="quarto-xref">Table&nbsp;5</a>.</p>
<div id="tbl-pll-dsm-orders" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pll-dsm-orders-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: DSM output ranges and characteristics for different orders
</figcaption>
<div aria-describedby="tbl-pll-dsm-orders-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>DSM Order</th>
<th>Output Range</th>
<th>Noise Shaping</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\(N, N+1\)</span></td>
<td>20 dB/decade</td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\(N-1 \ldots N+2\)</span></td>
<td>40 dB/decade</td>
</tr>
<tr class="odd">
<td>3</td>
<td><span class="math inline">\(N-3 \ldots N+4\)</span></td>
<td>60 dB/decade</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="sec-pll-frac-n-implementation" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="sec-pll-frac-n-implementation"><span class="header-section-number">7.4.2</span> Fractional-N PLL Implementation</h3>
<p>A block diagram of a fractional-N PLL using a DSM and a multi-modulus divider (MMD) is shown in <a href="#fig-pll-frac-n-block" class="quarto-xref">Figure&nbsp;87</a>. In order to ease the timing loop of the jittered clock coming from the MMD, the DSM is typically clocked by the MMD output.</p>
<div id="cell-fig-pll-frac-n-block" class="cell" data-execution_count="87">
<div class="cell-output cell-output-display">
<div id="fig-pll-frac-n-block" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-frac-n-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-frac-n-block-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-87" title="Figure&nbsp;87: Block diagram of a fractional-N PLL. The VCO signal is divided by a sequence of integer divider values div[k] with (on average) is given by N.f, where N is the integer part of the divider value, and f the fractional part of the divider."><img src="rfic_files/figure-html/fig-pll-frac-n-block-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-frac-n-block-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;87: Block diagram of a fractional-N PLL. The VCO signal is divided by a sequence of integer divider values div[k] with (on average) is given by <span class="math inline">\(N.f\)</span>, where <span class="math inline">\(N\)</span> is the integer part of the divider value, and <span class="math inline">\(f\)</span> the fractional part of the divider.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For a practical implementation of a fractional-N PLL it is of utmost importance that the path from the MMD output to the loop filter output is linear, as only the averaging/lowpass filtering of the noise-shaped quantization noise reduces the noise. Any <em>nonlinearity</em> in this path will lead to distortion of the quantization noise, causing quantization noise folding back into the PLL loop bandwidth, degrading the PLL output phase noise!</p>
<p>One prominent source of nonlinearity is the difference between the source and sink currents of the charge pump, as well as any nonlinearity present in the PFD/CP operating point of <span class="math inline">\(\Delta \varphi \approx 0\)</span> (like a deadzone). Since a Type-II PLL ideally operates at exactly this point, with random excursions around it due to the DSM-induced jitter, any nonlinearity here will seriously degrade the PLL performance. There are predominantly two options to mitigate this issue:</p>
<ol type="1">
<li>Use a Type-I PLL architecture with <span class="math inline">\(\Delta \varphi \neq 0\)</span>.</li>
<li>Introduce a phase offset in a Type-II PLL to operate away from <span class="math inline">\(\Delta \varphi = 0\)</span>.</li>
</ol>
<p>A simple way to introduce a phase offset is to add a fixed current source/sink to the charge pump, as shown in <a href="#fig-pll-cp-offset" class="quarto-xref">Figure&nbsp;88</a>.</p>
<div id="cell-fig-pll-cp-offset" class="cell" data-execution_count="88">
<div class="cell-output cell-output-display">
<div id="fig-pll-cp-offset" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-cp-offset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-cp-offset-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-88" title="Figure&nbsp;88: Charge pump with offset current for use in a fractional-N Type-II PLL."><img src="rfic_files/figure-html/fig-pll-cp-offset-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-cp-offset-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;88: Charge pump with offset current for use in a fractional-N Type-II PLL.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As we have seen multiple times in the PLL discussion, using a higher <span class="math inline">\(f_\mathrm{ref}\)</span> is beneficial for phase noise performance, loop bandwidth, and TDC resolution (in an ADPLL). However, in many applications the choice of reference frequency is constrained by other factors. One way to achieve a higher reference frequency is by using a <strong>frequency doubler</strong>. As shown in <a href="#fig-ref-doubler" class="quarto-xref">Figure&nbsp;89</a>, a frequency doubler can be implemented using an XOR gate and a delay line. The delay line is set to a quarter of the period of the reference frequency, i.e., <span class="math inline">\(T_\mathrm{d} = T_\mathrm{ref}/4\)</span>. The XOR gate then produces an output frequency of <span class="math inline">\(f_\mathrm{double} = 2 \cdot f_\mathrm{ref}\)</span>. For stable operation, this delay line must be designed to be relatively insensitive to process, voltage, and temperature (PVT) variations, or must be adjusted with a control loop.</p>
<div id="cell-fig-ref-doubler" class="cell" data-execution_count="89">
<div class="cell-output cell-output-display">
<div id="fig-ref-doubler" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ref-doubler-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-ref-doubler-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-89" title="Figure&nbsp;89: Implementation of reference frequency doubler."><img src="rfic_files/figure-html/fig-ref-doubler-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ref-doubler-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;89: Implementation of reference frequency doubler.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As a final remark, we note that the output of the MMD in <a href="#fig-pll-frac-n-block" class="quarto-xref">Figure&nbsp;87</a> is a jittered clock due to the changing division ratio and the multiple gates and flip-flops making up the MMD. This jitter degrades the PLL phase noise performance. Fortunately, there is an easy fix to this issue by using a retiming flip-flop after the MMD, clocked by the oscillator output, as shown in <a href="#fig-pll-frac-n-block-retiming" class="quarto-xref">Figure&nbsp;90</a>.</p>
<div id="cell-fig-pll-frac-n-block-retiming" class="cell" data-execution_count="90">
<div class="cell-output cell-output-display">
<div id="fig-pll-frac-n-block-retiming" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pll-frac-n-block-retiming-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-pll-frac-n-block-retiming-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-90" title="Figure&nbsp;90: Block diagram of a fractional-N PLL including a retiming flip flop to reduce the MMD-related jitter."><img src="rfic_files/figure-html/fig-pll-frac-n-block-retiming-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pll-frac-n-block-retiming-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;90: Block diagram of a fractional-N PLL including a retiming flip flop to reduce the MMD-related jitter.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This retiming flip-flop effectively synchronizes the MMD output to the oscillator clock domain, significantly reducing the jitter seen by the loop filter and improving the overall phase noise performance of the fractional-N PLL.</p>
</section>
</section>
</section>
<section id="sec-poweramp" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Power Amplifiers</h1>
<p>Power amplifiers (PAs) are essential components in wireless communication systems, as they boost the signal power from (usually) a few milliwatts up to several watts to ensure reliable transmission over the air. While PAs are simple in concept, their design and operation involve several trade-offs between efficiency, linearity, bandwidth, and cost.</p>
<p>A basic PA based on a single common-source stage is shown in <a href="#fig-poweramp-basic" class="quarto-xref">Figure&nbsp;91</a>. The input signal is applied to the gate of the transistor via a matching network, which amplifies the signal at the drain terminal. The output matching network transforms the 50 Ohm load to the optimal load impedance for the desired output power under linearity and efficiency constraints.</p>
<div id="cell-fig-poweramp-basic" class="cell" data-execution_count="91">
<div class="cell-output cell-output-display">
<div id="fig-poweramp-basic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-poweramp-basic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-poweramp-basic-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-91" title="Figure&nbsp;91: A basic single stage single-ended common-source power amplifier with input and output matching."><img src="rfic_files/figure-html/fig-poweramp-basic-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poweramp-basic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;91: A basic single stage single-ended common-source power amplifier with input and output matching.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The RF choke at the drain allows the drain node to swing above the supply voltage, enabling higher output power. However, the transistor <span class="math inline">\(M_1\)</span> must be able to handle the high voltages and currents involved. Unfortunately, in Silicon technologies the Johnson limit, which is the product of the breakdown voltage and the transit frequency of the transistor, is limited to around 200 GHz·V. This often requires the use of different semiconductor technologies for the PAs, such as GaAs, InP, or GaN. Implementing the PA in a different technology than the rest of the RFIC means to implement it off-chip.</p>
<p>Assuming the output voltage swing is limited only by the supply voltage <span class="math inline">\(V_\mathrm{DD}\)</span>, the maximum output power delivered to a load <span class="math inline">\(R_\mathrm{L}\)</span> is given by</p>
<p><span class="math display">\[
P_\mathrm{out,max} = \frac{V_\mathrm{DD}^2}{2 R_\mathrm{L}}.
\]</span></p>
<p>For a typical supply voltage of <span class="math inline">\(V_\mathrm{DD} = 3\,\mathrm{V}\)</span> and a load of <span class="math inline">\(R_\mathrm{L} = 50\,\Omega\)</span>, this results in a maximum output power of <span class="math inline">\(P_\mathrm{out,max} = 90\,\mathrm{mW}\)</span> or <span class="math inline">\(19.5\,\mathrm{dBm}\)</span>. Higher output powers require either higher supply voltages (which may not be available in battery-powered systems) or lower load impedances. The output matching network is thus designed in such a way as to present a lower impedance to the PA, e.g., <span class="math inline">\(R_\mathrm{L} = 5\,\Omega\)</span>, which increases the maximum output power to <span class="math inline">\(P_\mathrm{out,max} = 900\,\mathrm{mW}\)</span> or <span class="math inline">\(29.5\,\mathrm{dBm}\)</span>. The matching networks are usually implemented as LC networks or transmission line sections, often using transformers to achieve the required impedance transformation.</p>
<p>In order to drive the large output transistor <span class="math inline">\(M_1\)</span> in <a href="#fig-poweramp-basic" class="quarto-xref">Figure&nbsp;91</a>, a driver stage is often required. This driver stage provides the necessary voltage and current gain to ensure that the PA operates in its optimal region. If needed, even another pre-driver stage can be added, but higher gain might cause stability issues and increased output noise. A two-stage power amplifier is shown in <a href="#fig-poweramp-twostage" class="quarto-xref">Figure&nbsp;92</a>.</p>
<div id="cell-fig-poweramp-twostage" class="cell" data-execution_count="92">
<div class="cell-output cell-output-display">
<div id="fig-poweramp-twostage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-poweramp-twostage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-poweramp-twostage-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-92" title="Figure&nbsp;92: A basic two-stage single-ended common-source power amplifier with input and output matching."><img src="rfic_files/figure-html/fig-poweramp-twostage-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poweramp-twostage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;92: A basic two-stage single-ended common-source power amplifier with input and output matching.
</figcaption>
</figure>
</div>
</div>
</div>
<p>One of the main characteristics of a PA is its <strong>drain efficiency</strong>, which is defined as the ratio of the output RF power to the total DC power consumed from the supply:</p>
<p><span class="math display">\[
\eta = \frac{P_\mathrm{out}}{P_\mathrm{dc}}
\]</span></p>
<p>Since <span class="math inline">\(\eta\)</span> does not take into account the required input power to drive the PA, a more comprehensive metric is the <strong>power-added efficiency (PAE)</strong>:</p>
<p><span class="math display">\[
\text{PAE} = \frac{P_\mathrm{out} - P_\mathrm{in}}{P_\mathrm{dc}}
\]</span></p>
<p>Ideally, we want both efficiency metrics as high as possible, but in practice there is a trade-off between efficiency and linearity (for linearity metrics refer to <a href="#sec-linearity" class="quarto-xref">Section&nbsp;2.2</a>). High efficiency is often achieved by operating the PA in saturation, which leads to signal distortion and spectral regrowth. Various techniques exist to improve the linearity of PAs, such as <strong>predistortion</strong>, <strong>feedback</strong>, and <strong>envelope tracking</strong>.</p>
<p>For describing PA nonlinearity, various models can be used. One simple model is the <strong>Saleh model</strong> (originally developed for trawelling-wave tube amplifiers), which describes the AM/AM and AM/PM conversion of the PA using a smooth transition from linear operation to saturation <span class="citation" data-cites="Saleh.1981">(<a href="#ref-Saleh.1981" role="doc-biblioref">Saleh 1981</a>)</span>. This model is defined by the following equations in the polar domain (<span class="math inline">\(r(t)\)</span> and <span class="math inline">\(\psi(t)\)</span> are the modulated input signal amplitude and phase, respectively; <span class="math inline">\(y(t)\)</span> is the output signal):</p>
<p><span class="math display">\[
y(t) = A[r(t)] \cos\{ \omega_0 t + \psi(t) + \varphi[r(t)] \}
\]</span></p>
<p>with</p>
<p><span class="math display">\[
A(r) = \frac{\alpha_1 r}{1 + \beta_1 r^2} \quad \text{and} \quad \varphi(r) = \frac{\alpha_2 r^2}{1 + \beta_2 r^2}
\]</span></p>
<p>where <span class="math inline">\(\alpha_1\)</span>, <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\alpha_2\)</span>, and <span class="math inline">\(\beta_2\)</span> are the Saleh model parameters that define the PA characteristics. The AM/AM conversion <span class="math inline">\(A(r)\)</span> describes how the output amplitude saturates with increasing input amplitude, while the AM/PM conversion <span class="math inline">\(\varphi(r)\)</span> describes the phase distortion introduced by the PA. While this simple model does not capture memory effects or frequency-dependent behavior, it provides a good starting point for understanding PA nonlinearity.</p>
<p>Note that most discrete PAs are implemented similar to <a href="#fig-poweramp-twostage" class="quarto-xref">Figure&nbsp;92</a>. For RFIC-integrated PAs, a single-ended implementation is problematic due to power supply parasitics and coupling issues. Therefore, integrated PAs are very often implemented in a differential configuration, which improves power supply rejection and reduces even-order harmonics <span class="citation" data-cites="Moreira.2015">Fuhrmann et al. (<a href="#ref-Fuhrmann.2017" role="doc-biblioref">2017</a>)</span>. A generic differential PA implementation is shown in <a href="#fig-poweramp-differential" class="quarto-xref">Figure&nbsp;93</a>.</p>
<div id="cell-fig-poweramp-differential" class="cell" data-execution_count="93">
<div class="cell-output cell-output-display">
<div id="fig-poweramp-differential" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-poweramp-differential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="rfic_files/figure-html/fig-poweramp-differential-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-93" title="Figure&nbsp;93: A generic differential power amplifier with cascode stages for peak voltage handling. Inductors L1, L_2, and L_3 are implemented as a transformer, and form the load and output matching network together with C_1 and C_2. Note that the load transformer allows a differential to single-ended conversion, as well as a dc block."><img src="rfic_files/figure-html/fig-poweramp-differential-output-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-poweramp-differential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;93: A generic differential power amplifier with cascode stages for peak voltage handling. Inductors <span class="math inline">\(L1\)</span>, <span class="math inline">\(L_2\)</span>, and <span class="math inline">\(L_3\)</span> are implemented as a transformer, and form the load and output matching network together with <span class="math inline">\(C_1\)</span> and <span class="math inline">\(C_2\)</span>. Note that the load transformer allows a differential to single-ended conversion, as well as a dc block.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The cascode transistors <span class="math inline">\(M_2\)</span> and <span class="math inline">\(M_4\)</span> allow higher output voltage swings by stacking the transistors, thus reducing the voltage stress on each individual transistor. They can be implemented as thick-oxide transistors to further increase the breakdown voltage.</p>
<p>While the power amplifier circuits look simple in principle, their design and optimization require large-signal models and extensive electromagnetic (EM) simulations to accurately capture the behavior of the matching networks and parasitic effects. Additionally, thermal management is crucial in PA design, as high power dissipation can lead to device degradation and failure.</p>
<p>In order to accurately capture and model large-signal effects, load-pull measurements are often performed during PA design. In a <strong>load-pull measurement</strong> setup, the PA is driven with a known input signal while the output load impedance is varied systematically using impedance tuners. By measuring the output power, efficiency, and linearity metrics at different load impedances, the optimal load conditions for the PA can be determined. This information is then used to design the output matching network to achieve the desired performance.</p>
<section id="sec-poweramp-classes" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-poweramp-classes"><span class="header-section-number">8.1</span> Amplifier Classes</h2>
<p>Power amplifiers can be classified into different <a href="https://en.wikipedia.org/wiki/Power_amplifier_classes">classes</a> based on their conduction angle, which is the portion of the input signal cycle during which the transistor conducts current. The most common classes are Class A, Class B, Class AB, Class C, Class D, Class E, and Class F. Each class has its own trade-offs between efficiency, linearity, and complexity. The following table summarizes the main characteristics of each amplifier class:</p>
<div id="tbl-poweramp-classes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-poweramp-classes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Amplifier Classes
</figcaption>
<div aria-describedby="tbl-poweramp-classes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Class</th>
<th>Conduction Angle</th>
<th>Efficiency</th>
<th>Linearity</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>360°</td>
<td>Low</td>
<td>High</td>
<td style="text-align: left;">Bias current is larger than peak output current</td>
</tr>
<tr class="even">
<td>B</td>
<td>180°</td>
<td>Medium</td>
<td>Medium</td>
<td style="text-align: left;">Conducts half the cycle (zero bias current)</td>
</tr>
<tr class="odd">
<td>AB</td>
<td>180°-360°</td>
<td>Medium</td>
<td>Medium-high</td>
<td style="text-align: left;">Between A and B (a little bit of bias current)</td>
</tr>
<tr class="even">
<td>C</td>
<td>&lt;180°</td>
<td>High</td>
<td>Low</td>
<td style="text-align: left;">Conducts less than half the cycle</td>
</tr>
<tr class="odd">
<td>D</td>
<td>N/A</td>
<td>Very high</td>
<td>Low-high</td>
<td style="text-align: left;">Switching amplifier, uses PWM or similar</td>
</tr>
<tr class="even">
<td>E</td>
<td>N/A</td>
<td>Very high</td>
<td>Low</td>
<td style="text-align: left;">Switching amplifier with tuned load</td>
</tr>
<tr class="odd">
<td>F</td>
<td>N/A</td>
<td>Very high</td>
<td>Low</td>
<td style="text-align: left;">Uses harmonic tuning for efficiency</td>
</tr>
<tr class="even">
<td>G</td>
<td>N/A</td>
<td>Very high</td>
<td>Medium</td>
<td style="text-align: left;">Multi-level supply voltage for efficiency</td>
</tr>
<tr class="odd">
<td>H</td>
<td>N/A</td>
<td>Very high</td>
<td>Medium</td>
<td style="text-align: left;">Adaptive supply voltage for efficiency</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ul>
<li><strong>Class A</strong> amplifiers are the most linear but also the least efficient, as they conduct current throughout the entire input signal cycle. They are typically used in applications where linearity is critical, such as low power analog signal processing. Drain efficiency is limited to <span class="math inline">\(\eta \leq 50\%\)</span>.</li>
<li><strong>Class B</strong> amplifiers are more efficient than Class A, as they conduct current only during half of the input signal cycle. However, they suffer from crossover distortion at the zero-crossing point of the input signal. The upper limit for drain efficiency is <span class="math inline">\(\eta \leq 78.5\%\)</span>.</li>
<li><strong>Class AB</strong> amplifiers are a compromise between Class A and Class B, providing better linearity than Class B while still being more efficient than Class A. They are widely used in small-signal applications and linear RF power amplifiers, where better efficiency than Class A is desired.</li>
<li><strong>Class C</strong> amplifiers are highly efficient but exhibit significant distortion, as they conduct current for only a part of the input signal cycle. They are typically used in applications where efficiency is more important than linearity, such as RF transmitters for constant-envelope modulation schemes (e.g., FM, FSK). Drain efficiency can reach up to <span class="math inline">\(\eta \leq 100\%\)</span>, but only as the output power falls to zero.</li>
<li><strong>Class D, E, and F</strong> amplifiers are switching amplifiers that achieve very high efficiencies by operating the transistor as a switch, either fully on or fully off. They use various techniques such as pulse-width modulation (PWM), tuned loads, and harmonic tuning to optimize efficiency. These classes are commonly used in high-power applications, such as audio amplifiers and RF transmitters.</li>
<li><strong>Class G and H</strong> amplifiers use multiple supply voltages or adaptive supply voltages to improve efficiency, and can be combined with the other classes. They are often used in applications where power consumption is a concern, such as battery-powered devices. Class AB combined with Class G or H techniques is state-of-the-art in mobile device PAs. Class G and H are sometimes also referred to as “<strong>envelope tracking</strong>” techniques.</li>
</ul>
</section>
<section id="sec-poweramp-advanced" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="sec-poweramp-advanced"><span class="header-section-number">8.2</span> PA Advanced Techniques</h2>
<p>To further improve the performance of power amplifiers, several advanced techniques can be employed:</p>
<ul>
<li><strong>Predistortion</strong>: This technique involves applying an inverse distortion to the input signal before it enters the PA, effectively canceling out the nonlinearity of the PA. Digital predistortion (DPD) is commonly used in modern communication systems to improve linearity and reduce spectral regrowth.</li>
<li><strong>Envelope Tracking</strong>: This technique dynamically adjusts the supply voltage of the PA based on the envelope of the input signal, improving efficiency by reducing power consumption during low signal levels (see Class G and Class H).</li>
<li><strong>Load Modulation</strong>: This technique involves varying the load impedance seen by the PA to optimize performance for different signal conditions. This can be achieved using tunable matching networks or switched load networks. An active method is the <strong>Doherty amplifier</strong> architecture, which uses two amplifiers (a main and a peaking amplifier) to improve efficiency at back-off power levels.</li>
</ul>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Andreani.2000" class="csl-entry" role="listitem">
Andreani, P., and S. Mattisson. 2000. <span>“<span class="nocase">On the use of MOS varactors in RF VCOs</span>.”</span> <em>IEEE Journal of Solid-State Circuits</em> 35 (6): 905–10. <a href="https://doi.org/10.1109/4.845194">https://doi.org/10.1109/4.845194</a>.
</div>
<div id="ref-Bird.2009" class="csl-entry" role="listitem">
Bird, Trevor S. 2009. <span>“<span class="nocase">Definition and Misuse of Return Loss [Report of the Transactions Editor-in-Chief]</span>.”</span> <em>IEEE Antennas and Propagation Magazine</em> 51 (2): 166–67. <a href="https://doi.org/10.1109/map.2009.5162049">https://doi.org/10.1109/map.2009.5162049</a>.
</div>
<div id="ref-Darabi_RFIC" class="csl-entry" role="listitem">
Darabi, Hooman. 2020. <em>Radio Frequency Integrated Circuits and Systems</em>. 2nd edition. Cambridge University Press.
</div>
<div id="ref-Fuhrmann.2017" class="csl-entry" role="listitem">
Fuhrmann, J., J. Moreira, P. Oβmann, A. Springer, R. Weigel, and H. Pretl. 2017. <span>“<span class="nocase">A 15-Bit 28nm CMOS Fully-Integrated 1.6W Digital Power Amplifier for LTE IoT</span>.”</span> In, 199–202. ESSCIRC 2017 - 43rd IEEE European Solid State Circuits Conference. IEEE. <a href="https://doi.org/10.1109/esscirc.2017.8094560">https://doi.org/10.1109/esscirc.2017.8094560</a>.
</div>
<div id="ref-Gardner.1980" class="csl-entry" role="listitem">
Gardner, F. 1980. <span>“<span>Charge-Pump Phase-Lock Loops</span>.”</span> <em>IEEE Transactions on Communications</em> 28 (11): 1849–58. <a href="https://doi.org/10.1109/TCOM.1980.1094619">https://doi.org/10.1109/TCOM.1980.1094619</a>.
</div>
<div id="ref-Gray_Meyer_5th_ed" class="csl-entry" role="listitem">
Gray, Paul R., Paul J. Hurst, Stephen H. Lewis, and Robert G. Meyer. 2009. <em><span class="nocase">Analysis and Design of Analog Integrated Circuits</span></em>. Fifth. Wiley.
</div>
<div id="ref-Kaukovuori.2008" class="csl-entry" role="listitem">
Kaukovuori, Jouni, Kari Stadius, Jussi Ryynänen, and Kari A. I. Halonen. 2008. <span>“<span class="nocase">Analysis and Design of Passive Polyphase Filters</span>.”</span> <em>IEEE Transactions on Circuits and Systems–I: Regular Papers</em> 55 (10): 3023–37. <a href="https://doi.org/10.1109/tcsi.2008.917990">https://doi.org/10.1109/tcsi.2008.917990</a>.
</div>
<div id="ref-Kral.1998" class="csl-entry" role="listitem">
Kral, A., F. Behbahani, and A. A. Abidi. 1998. <span>“<span class="nocase">RF-CMOS oscillators with switched tuning</span>.”</span> In, 555–58. Proceedings of the IEEE 1998 Custom Integrated Circuits Conference (Cat. No.98CH36143). IEEE. <a href="https://doi.org/10.1109/cicc.1998.695039">https://doi.org/10.1109/cicc.1998.695039</a>.
</div>
<div id="ref-Leeson.1966" class="csl-entry" role="listitem">
Leeson, D. B. 1966. <span>“<span class="nocase">A simple model of feedback oscillator noise spectrum</span>.”</span> <em>Proceedings of the IEEE</em> 54 (2): 329–30. <a href="https://doi.org/10.1109/proc.1966.4682">https://doi.org/10.1109/proc.1966.4682</a>.
</div>
<div id="ref-Lepage.1953" class="csl-entry" role="listitem">
Lepage, W. R., C. R. Cahn, and J. S. Brown. 1953. <span>“<span class="nocase">Analysis of a comb filter using synchronously commutated capacitors</span>.”</span> <em>Transactions of the American Institute of Electrical Engineers, Part I: Communication and Electronics</em> 72 (1): 63–68. <a href="https://doi.org/10.1109/tce.1953.6371974">https://doi.org/10.1109/tce.1953.6371974</a>.
</div>
<div id="ref-Molisch_Wireless_Communications" class="csl-entry" role="listitem">
Molisch, Andreas F. 2022. <em>Wireless Communications: From Fundamentals to Beyond 5G</em>. 3rd edition. Wiley-IEEE Press.
</div>
<div id="ref-Moreira.2015" class="csl-entry" role="listitem">
Moreira, José, Stephan Leuschner, Nenad Stevanovic, Harald Pretl, Peter Pfann, Ronald Thüringer, Martin Kastner¹, et al. 2015. <span>“<span class="nocase">9.2 A Single-Chip HSPA Transceiver with Fully Integrated 3G CMOS Power Amplifiers</span>.”</span> <em>2015 IEEE International Solid-State Circuits Conference - (ISSCC) Digest of Technical Papers</em>, February, 162–64. <a href="https://doi.org/10.1109/isscc.2015.7062976">https://doi.org/10.1109/isscc.2015.7062976</a>.
</div>
<div id="ref-Pozar_RF" class="csl-entry" role="listitem">
Pozar, David M. 2011. <em>Microwave Engineering</em>. Wiley.
</div>
<div id="ref-Razavi.1996" class="csl-entry" role="listitem">
Razavi, B. 1996. <span>“<span class="nocase">A study of phase noise in CMOS oscillators</span>.”</span> <em>IEEE Journal of Solid-State Circuits</em> 31 (3): 331–43. <a href="https://doi.org/10.1109/4.494195">https://doi.org/10.1109/4.494195</a>.
</div>
<div id="ref-Razavi_RFIC" class="csl-entry" role="listitem">
Razavi, Behzad. 2011. <em>RF Microelectronics</em>. 2nd edition. Pearson.
</div>
<div id="ref-Razavi_Analog_CMOS" class="csl-entry" role="listitem">
———. 2017. <em><span class="nocase">Design of Analog CMOS Integrated Circuits</span></em>. McGraw-Hill.
</div>
<div id="ref-Saleh.1981" class="csl-entry" role="listitem">
Saleh, A A M. 1981. <span>“<span class="nocase">Frequency-Independent and Frequency-Dependent Nonlinear Models of TWT Amplifiers</span>.”</span> <em>IEEE Transactions on Communications</em> 29 (11): 1715–20. <a href="https://doi.org/10.1109/tcom.1981.1094911">https://doi.org/10.1109/tcom.1981.1094911</a>.
</div>
<div id="ref-Sarpeshkar_1993" class="csl-entry" role="listitem">
Sarpeshkar, R., T. Delbruck, and C. A. Mead. 1993. <span>“<span class="nocase">White noise in MOS transistors and resistors</span>.”</span> <em>IEEE Circuits and Devices Magazine</em> 9 (6): 23–29. <a href="https://doi.org/10.1109/101.261888">https://doi.org/10.1109/101.261888</a>.
</div>
<div id="ref-Schreier_DSM" class="csl-entry" role="listitem">
Schreier, Richard, Shanthi Pavan, and Gabor C. Temes. 2017. <em>Understanding Delta-Sigma Data Converters</em>. John Wiley &amp; Sons, Ltd.
</div>
<div id="ref-Sklar_Digital_Communications" class="csl-entry" role="listitem">
Sklar, Bernard, and Fredric J. Harris. 2020. <em>Digital Communications: Fundamentals and Applications</em>. 3rd edition. Pearson.
</div>
<div id="ref-Staszewski.2003" class="csl-entry" role="listitem">
Staszewski, R. B., D. Leipold, K. Muhammad, and P. T. Balsara. 2003. <span>“<span class="nocase">Digitally controlled oscillator (DCO)-based architecture for RF frequency synthesis in a deep-submicrometer CMOS Process</span>.”</span> <em>IEEE Transactions on Circuits and Systems II: Analog and Digital Signal Processing</em> 50 (11): 815–28. <a href="https://doi.org/10.1109/tcsii.2003.819128">https://doi.org/10.1109/tcsii.2003.819128</a>.
</div>
<div id="ref-Vazny.2010" class="csl-entry" role="listitem">
Vazny, Rastislav, Werner Schelmbauer, Harald Pretl, Stefan Herzinger, and Robert Weigel. 2010. <span>“<span class="nocase">An Interstage Filter-Free Mobile Radio Receiver with Integrated TX Leakage Filtering</span>.”</span> In, 21–24. 2010 IEEE Radio Frequency Integrated Circuits Symposium. IEEE. <a href="https://doi.org/10.1109/rfic.2010.5477294">https://doi.org/10.1109/rfic.2010.5477294</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>Apache-2.0 license</div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pretl2025,
  author = {Pretl, Harald},
  title = {Radio-Frequency {Integrated} {Circuits}},
  date = {2025-11-12},
  url = {https://iic-jku.github.io/radio-frequency-integrated-circuits},
  doi = {10.5281/zenodo.17563943},
  langid = {en-US}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pretl2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Pretl, Harald. 2025. <span>“Radio-Frequency Integrated Circuits.”</span>
November 12, 2025. <a href="https://doi.org/10.5281/zenodo.17563943">https://doi.org/10.5281/zenodo.17563943</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/iic-jku\.github\.io\/radio-frequency-integrated-circuits\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/iic-jku/radio-frequency-integrated-circuits" class="external" target="_blank">Source code</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Website built with <a href="https://quarto.org/" class="external" target="_blank">Quarto</a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>