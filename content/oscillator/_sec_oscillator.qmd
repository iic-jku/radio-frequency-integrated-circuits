::: {.content-hidden}
Copyright (C) 2025 Harald Pretl and co-authors (harald.pretl@jku.at)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
:::

# Oscillators {#sec-oscillator}

For the generation of the LO frequency to be used by in a mixer for frequency conversion, oscillators are used. Ideally, oscillators produce a stable, noise-free sinusoidal signal, independent of environmental conditions like temperature or supply voltage variations. The circuit symbol of an oscillator is shown in @fig-oscillator-symbol.

{{< include /content/oscillator/_fig_oscillator_block.qmd >}}

The question is how to construct an oscillator. In summary, we need to build something that oscillates, i.e., produces a sustained periodic signal with frequency $\omega_0$. One way to achieve this is to construct a feedback loop where $|H(s = j \omega_0)| = 1$ and $\angle H(s = j \omega_0) = n \cdot 2 \pi$; these conditions are called the "[Barkhausen criterion](https://en.wikipedia.org/wiki/Barkhausen_criterion)" (here, $H(s)$ is the loop gain around the feedback loop). A ring oscillator is one example of such a feedback oscillator. For the 3-stage single-ended *ring oscillator* shown in @fig-ring-oscillator, each inverter provides a phase shift of $2 \pi / 3$ at the oscillation frequency $\omega_0$, resulting in a total phase shift of $2 \pi$ for the three inverters. The gain condition is fulfilled by the gain of the inverters, which must be larger than unity to compensate for losses in the loop. By using an odd number of inverters, a stable locking point at dc is avoided.

{{< include /content/oscillator/_fig_ring_oscillator.qmd >}}

Note that the output frequency of the ring oscillator shown above is ill-controlled, as it only depends on the delay (i.e., phase shift) of the inverters, which are usually dependent on process, voltage, and temperature (PVT) variations. Also the inherent quality factor of such an oscillator is low, as exemplified by the definitions of the quality factor $Q$ as [@Razavi.1996]

$$
Q = 2 \pi \frac{\text{Average energy stored}}{\text{Energy loss per cycle}} = \frac{\omega_0}{\Delta \omega} = \frac{\omega_0}{2} \sqrt{ \left( \frac{d A}{d \omega} \right)^2 + \left( \frac{d \varphi}{d \omega} \right)^2 }
$$ {#eq-definition-q}

with a ring oscillator having very low $dA / d \omega$ and $d \varphi / d \omega$ slopes ($A(\omega)$ and $\varphi(\omega)$ are the open loop gain and phase shift, respectively). It can be shown that $Q \approx 1.3$ for a 3-stage ring oscillator [@Razavi.1996]. For some applications, this might be sufficient, but in many cases, a higher $Q$ is desired to reduce phase noise and improve frequency stability (as we will see later in this chapter).

According to @eq-definition-q, a high $Q$ can be achieved by using a resonator with high energy storage capability and low energy loss per cycle. We then add an amplifier in a feedback loop to compensate for the losses of the resonator. This principle is shown in @fig-lc-oscillator for a parallel LC tank circuit as the resonator. Sometimes the action of the feedback loop around the amplifier is modelled as a negative resistance $-R_\mathrm{amp}$ that compensates for the losses of the tank circuit represented by the resistor $R_\mathrm{p}$. The single parallel resistor $R_\mathrm{p}$ models the losses of the inductor $L$ and the capacitor $C$.

{{< include /content/oscillator/_fig_lc_oscillator.qmd >}}

When $|-R_\mathrm{amp}| = R_\mathrm{p}$, the losses of the tank circuit are fully compensated, and we have a sustained oscillation at the resonance frequency $\omega_0 = 1 / \sqrt{L C}$. In practice, the amplifier gain is usually set slightly higher than required for loss compensation to **start the oscillation from noise**. Then, as the oscillation amplitude increases, some **non-linear mechanism in the amplifier reduces the effective gain** until a stable oscillation amplitude is reached. Various implementations of such LC oscillators exist, which will be discussed in the following sections.

- An alternative implementation of setting the oscillation amplitude is to use an *automatic level control* (ALC) loop, which measures the oscillation amplitude and adjusts the amplifier gain accordingly to maintain a constant output amplitude. This approach can improve the stability of the oscillation amplitude over process, voltage, and temperature variations.

- As an alternative to start the oscillation from thermal noise (which can take considerable time depending on the $Q$ of the resonator) is to provide a known initial condition to the resonator, e.g., by pre-charging the capacitor $C$ to a certain voltage before enabling the amplifier. This way, the oscillation can start immediately from this initial energy stored in the resonator.

As a first hint on how to optimize an LC oscillator for low phase noise, we can try to maximize $Q$ according to @eq-definition-q. The energy stored in the capacitor at peak voltage is

$$
E_\mathrm{stored} = \frac{C V_\mathrm{osc,p}^2}{2}
$$

so to maximize this we should maximize both $C$ and the peak oscillation voltage $V_\mathrm{osc,p}$. On the other hand, the energy loss per cycle is related to the power dissipated in the resistor $R_\mathrm{p}$ by

$$
E_\mathrm{loss} = \frac{V_\mathrm{osc,p}^2}{2 R_\mathrm{p}} \cdot \frac{1}{f_0}
$$

which we can minimize by maximizing $R_\mathrm{p}$. In summary, to maximize $Q$ we should use a large capacitance $C$, a high oscillation amplitude $V_\mathrm{osc,p}$, and a high tank resistance $R_\mathrm{p}$. Note that increasing $C$ will reduce $L$ for a given $\omega_0$. Calculating $Q$ from these expressions yields

$$
Q = 2 \pi \frac{E_\mathrm{stored}}{E_\mathrm{loss}} = \omega_0 C R_\mathrm{p} 
$$

which confirms the above observations.

Fundamentally, if we describe the output voltage of the oscillator as

$$
v_\mathrm{osc}(t) = V_\mathrm{osc,p}(t) \cdot \cos[ \omega_0(t) t + \varphi(t) ]
$$

we want to keep the amplitude variations small, i.e., $V_\mathrm{osc,p}(t) = V_\mathrm{osc,p}$, and also the frequency variations small, i.e., $\omega_0(t) = \omega_0$. We further want to minimize any phase fluctuations, i.e., $\varphi(t) = \varphi_0$.

As a side note, the definition of $Q$ in @eq-definition-q can be also be understand that it describes how many oscillation cycles it takes until the energy stored in the resonator is dissipated. For example, if $Q = 1000$ at $f_0 = 1\,\text{GHz}$, the energy stored in the resonator will last for approximately 1000 cycles, which is 1 Âµs. This time duration is sometimes called the "ring-down time" of the resonator.

## Oscillator Noise {#sec-oscillator-noise}

For calculating the noise of an oscillator, we assume that an LC-based oscillator as shown in @fig-lc-oscillator is used. We assume that the oscillator is in steady state operation, i.e., $-R_\mathrm{amp} = R_\mathrm{p}$. We can then simplify the circuit to the one shown in @fig-lc-oscillator-noise-model.

{{< include /content/oscillator/_fig_lc_oscillator_noise.qmd >}}

We can calculate

$$
Z_\mathrm{tank}(s) = \frac{s L \frac{1}{s C}}{s L + \frac{1}{s C}} = \frac{s L}{1 + s^2 L C}.
$$

At $s = j \omega_0$, we have $Z_\mathrm{tank}(s) \to \infty$, so let's approximate around $\omega_0$:

$$
Z_\mathrm{tank}(j \omega_0 + j \Delta \omega) =\frac{j (\omega_0 + \Delta \omega) L}{1 - (\omega_0 + \Delta \omega)^2 L C}
$$

For $\Delta \omega \ll \omega_0$, we can approximate $(\omega_0 + \Delta \omega)^2 \approx \omega_0^2 + 2 \omega_0 \Delta \omega$ and $\omega_0 + \Delta \omega \approx \omega_0$, which yields (using $\omega_0^2 L C = 1$)

$$
Z_\mathrm{tank}(j \omega_0 + j \Delta \omega) = -\frac{j}{2 \Delta \omega C}.
$$

We now use the correspondence $C = 1 / \omega_0^2 L$ and express $L = R_\mathrm{p} / \omega_0 Q$ to get

$$
|Z_\mathrm{tank}(j \omega_0 + j \Delta \omega)| = \frac{R_\mathrm{p}}{2 Q} \left( \frac{\omega_0}{\Delta \omega} \right)
$$

which provides us with an expression for the magnitude of the tank impedance around resonance. We now calculate the noise power if a noise current is injected into this impedance. We use the single-sided noise current of $R_\mathrm{p}$ (see @sec-noise-types), increased by a factor $F$ contributed by the active circuit providing $-R_\mathrm{amp}$:

$$
\overline{I_n^2} = \frac{4 k T F}{R_\mathrm{p}} 
$$

The noise voltage across the tank at a frequency offset $\Delta \omega$ from $\omega_0$ is then

$$
\overline{V_n^2}(\Delta \omega) = |Z_\mathrm{tank}(j \omega_0 + j \Delta \omega)|^2 \cdot \frac{4 k T F}{R_\mathrm{p}} = \frac{k T F R_\mathrm{p}}{Q^2} \left( \frac{\omega_0}{\Delta \omega} \right)^2
$$

This absolute noise voltage is not of much interest per se. We normalize it to the oscillation amplitude $V_\mathrm{p}$, and only account for 1/2 of the noise, as the total noise power is split equally into amplitude noise and phase noise [@Razavi.1996], and we are only interested in the **phase noise**. This is because we assume the amplitude noise being removed by amplitude clipping in the LO chain routing the oscillator signal to the mixer. This is often a valid assumption. We introduce the symbol $\phn(\cdot)$ to denote this normalized phase noise of the oscillator:

$$
\phn\{\Delta \omega\} = \frac{\frac{1}{2} \frac{k T F R_\mathrm{p}}{Q^2} \left( \frac{\omega_0}{\Delta \omega} \right)^2}{\left( \frac{V_\mathrm{p}}{\sqrt{2}} \right)^2} = \frac{k T F R_\mathrm{p}}{V_\mathrm{p}^2} \cdot \frac{1}{Q^2} \cdot \left( \frac{\omega_0}{\Delta \omega} \right)^2
$$ {#eq-lesson-equation}

This equation is known as "**Leeson's equation**" [@Leeson.1966], and it provides us with important insights on how to design low phase noise oscillators:

1. Use a resonator with high quality factor $Q$ to reduce phase noise. On-chip LC tanks usually provide moderate $Q$ values (e.g., 10 to 30), while off-chip crystals can provide very high $Q$ values (e.g., 10,000 to 100,000).
2. Maximize the oscillation amplitude $V_\mathrm{p}$ to increase the stored energy in the resonator. In CMOS implementations, this is often limited by the supply voltage and/or device breakdown voltages.
3. Use an active circuit with low noise factor $F$ to minimize the noise contribution of the negative resistance $-R_\mathrm{amp}$. A good value to aim for is $F \approx 2$ or lower.
4. Maximize the tank resistance $R_\mathrm{p}$ to minimize the thermal noise contribution. This can be achieved by using high-Q inductors and low-loss capacitors.

The phase noise $\phn\{\Delta \omega\}$ is expressed in the unit of dBc/Hz, i.e., in decibels of phase noise relative to the carrier power per 1 Hz of bandwidth. When expressing the phase noise of an oscillator in dBc/Hz it is important to state both the oscillation frequency $\omega_0$ and the offset frequency $\Delta \omega$ at which the phase noise is evaluated. For example, we could say that an oscillator has a phase noise of -137 dBc/Hz at 3 MHz offset from a carrier frequency of 2 GHz.

The phase noise expressed with @eq-lesson-equation describes an important region of the total oscillator phase noise where the phase noise decreased with $1 / (\Delta \omega)^2$, i.e., with 20 dB per decade. This region is often called the "thermal noise region" as it is dominated by thermal noise from the tank resistor and the active circuit. However, at lower offset frequencies, other noise mechanisms (like flicker noise) can dominate, leading to different slopes of the phase noise vs. offset frequency curve. At larger offset frequencies, the phase noise can flatten out due to thermal noise floor limitation of bufer amplifiers following the oscillator. A typical phase noise plot of an LC oscillator is shown in @fig-phase-noise-spectrum.

{{< include /content/oscillator/_fig_phase_noise_spectrum.qmd >}}

It is important to note that the phase noise does not go to infinity as $\Delta \omega$ approaches zero, as @eq-lesson-equation might suggest. This is an artifact of the simplified model used to derive Leeson's equation. In reality, the phase noise has the form of a Lorentzian spectrum around the carrier frequency, which means that it flattens out at very low offset frequencies with a trend described by

$$
\phn \{ \Delta \omega \ll \} \propto \frac{1}{\omega_\mathrm{B}^2 + \Delta \omega^2}
$$

with $\omega_\mathrm{B}$ being the half-power bandwidth of the oscillator spectrum.

Why is phase noise important?

1. In RX and TX the phase noise of the LO creates jitter, which degrades signal quality and contributes to EVM degradation.
2. In TX, phase noise of the LO creates noise sidebands around the carrier, which can lead to adjacent channel interference together with spectral regrowth due to nonlinearities and thermal noise.
3. In RX, reciprocal mixing of the phase noise sidebands with the desired signal creates in-band noise, which degrades the SNR and sensitivity of the RX.
4. In systems using multiple carriers or carriers with high-order modulation schemes (like in OFDM), phase noise can lead to inter-carrier interference (ICI) and symbol misinterpretation, further degrading system performance.

## Reciprocal Mixing {#sec-oscillator-reciprocal-mixing}

Reciprocal mixing is a phenomenon that occurs in receivers when the phase noise sidebands of the local oscillator mix with strong adjacent channel signals, resulting in in-band noise that degrades the signal-to-noise ratio of the desired signal. This effect is particularly pronounced in systems with high-order modulation schemes or closely spaced channels, where even small amounts of phase noise can lead to significant performance degradation.

To analyze reciprocal mixing, we consider a scenario where a strong interferer is present at a frequency offset $\Delta f$ from the desired signal. The phase noise of the local oscillator at this offset frequency can be characterized by its power spectral density $\phn\{\Delta f\}$. When the local oscillator mixes with the interferer, the phase noise sidebands effectively "fold" into the desired signal band, creating additional noise. This noise level can be estimated by multiplying the power of the interferer by the phase noise level at the offset frequency and considering the channel bandwidth $B$ of the RX

$$
P_\mathrm{RM} = P_\mathrm{interferer} + \phn\{ \Delta f\} + 10 \log_{10}(B)
$$ {#eq-reciprocal-mixing-noise}

where $P_\mathrm{RM}$ is the power of the reciprocal mixing noise introduced into the desired signal band.

::: {#nte-reciprocal-mixing .callout-note}
## Reciprocal Mixing Example
Let us assume the following example from a Bluetooth LE receiver: The sensitivity target for the RX is -70 dBm with an SNR of 10 dB for a 1 MHz channel. An adjacent channel interferer is present at -27 dB channel to interferer ratio at an offset of 3 MHz. How much phase noise can the LO have to meet the sensitivity target?

From the sensitivity target and the SNR requirement, we can calculate the maximum allowable noise floor in the RX. We add a margin of 3 dB to account for implementation losses:

$$
P_\mathrm{noise,max} = P_\mathrm{sens} - \text{SNR} - P_\mathrm{margin} = -70\,\text{dBm} - 10\,\text{dB} - 3\,\text{dB} = -83\,\text{dBm}
$$

The interferer power is:

$$
P_\mathrm{interferer} = P_\mathrm{sens} - \text{C/I} = -70\,\text{dBm} + 27\,\text{dB} = -43\,\text{dBm}
$$

Using @eq-reciprocal-mixing-noise, we can express the maximum allowable phase noise at 3 MHz offset at 2.4 GHz as:

$$
\phn\{3\,\text{MHz}\} = P_\mathrm{noise,max} - P_\mathrm{interferer} - 10 \log_{10}(B) = -83\,\text{dBm} + 43\,\text{dBm} - 60\,\text{dB} = -100\,\text{dBc/Hz}
$$
:::

The reciprocal mixing scenario descibred in @nte-reciprocal-mixing is visualized in @fig-reciprocal-mixing.

{{< include /content/oscillator/_fig_reciprocal_mixing.qmd >}}

## Single-Ended Oscillators {#sec-single-ended-oscillators}

Single-ended oscillators are commonly used in RF applications due to their simplicity and ease of integration, especially in quartz oscillators. A negative resistance is implemented using a single transistor amplifier as is shown in @fig-neg-r-single-ended. The transistor is configured with two capacitors $C_1$ and $C_2$ to provide a phase-shifted feedback path.

{{< include /content/oscillator/_fig_neg_r_single_ended.qmd >}}

It can be shown that the differential input impedance looking into the transistor gate and drain is given by

$$
Z_\mathrm{in}(s) = -\frac{\gm}{\omega^2 C_1 C_2} + \frac{C_1 + C_2}{s C_1 C_2} = -R_\mathrm{amp} + \frac{1}{s C_\mathrm{amp}}
$$

which consists of the series combination of a negative resistance $-R_\mathrm{amp}$ and a capacitance $C_\mathrm{amp}$. Note that the circuit in @fig-neg-r-single-ended does not show a ground symbol. In fact, any of the three nodes marked with blue numbers can be used as a reference node (ground), and this results in the following well-known oscillator topologies:

| Reference Node | Oscillator Topology                                                      |
|----------------|--------------------------------------------------------------------------|
| Node 1 (Gate)  | [Colpitts oscillator](https://en.wikipedia.org/wiki/Colpitts_oscillator) |
| Node 2 (Source)| [Pierce oscillator](https://en.wikipedia.org/wiki/Pierce_oscillator)     |
| Node 3 (Drain) | [Clapp oscillator](https://en.wikipedia.org/wiki/Clapp_oscillator)       |

When we investigate the equivalent electrical circuit of a quartz crystal, we find that it has inductive behavior between its series resonance frequency and its parallel resonance frequency, which are very close together. The quartz crystal equivalent circuit is shown in @fig-crystal-equivalent-circuit.

{{< include /content/oscillator/_fig_crystal_equivalent_circuit.qmd >}}

This means we can operate the quartz crystal as a high-Q inductor in an oscillator circuit, which results in the single-ended quartz crystal oscillator shown in @fig-quartz-crystal-oscillator, which is a very popular choice for high-performance crystal oscillators. Note that in simple implementation the current-bias MOSFET can be replaced by an inverter stage biased in the linear region.

{{< include /content/oscillator/_fig_crystal_oscillator.qmd >}}
