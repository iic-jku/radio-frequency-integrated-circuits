::: {.content-hidden}
Copyright (C) 2025 Harald Pretl and co-authors (harald.pretl@jku.at)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
:::

# Phase-Locked Loops {#sec-pll}

Thinking about oscillators, we phase a dilemma:

- Good phase noise performance is reached with high $Q$ in the resonator (see @eq-leeson-equation).
- Oscillator tunability requires a tunable resonator, which usually has a low-to-moderate $Q$.
- Oscillators have inherent frequency stability issues due to temperature variations, device aging, and supply voltage fluctuations.

We solve this dilemma by using a **phase-locked loop (PLL)** to stabilize and control the frequency of a tunable oscillator, mostly in the form of a VCO. A PLL is a feedback control system that locks the phase of the VCO output to the phase of a reference signal, typically generated by a crystal oscillator with excellent frequency stability. The block diagram of a basic PLL is shown in @fig-pll-block-diagram.

{{< include /content/pll/_fig_pll_block_diagram.qmd >}}

A reference frequency (often coming from a high-$Q$ crystal oscillator) is compared to the phase of a VCO output signal in a phase detector (PD). The phase error is low-pass filtered and used to tune the VCO frequency. By continuously adjusting the VCO based on the phase difference, the PLL ensures that the VCO output remains synchronized with the reference signal, effectively combining the stability of the reference with the tunability of the VCO. When the output signal of the VCO is fed back to the phase detector through a frequency divider (with division ratio $N$), the PLL can generate output frequencies that are integer multiples of the reference frequency, given by $f_\mathrm{out} = N \cdot f_\mathrm{ref}$.

The PD compares the phase of the reference signal with the phase of the VCO output signal. It works in the time domain and produces an output voltage proportional to the arrival time difference (phase difference) between the two input signals. This output voltage, known as the phase error signal, indicates whether the VCO is leading or lagging the reference signal in phase expressed as

$$
\Delta \varphi = 2 \pi \frac{\Delta t}{T_\mathrm{ref}}
$$

and

$$
V_\mathrm{error} = K_\mathrm{PD} \cdot \Delta \varphi
$$

where $\Delta \varphi$ is the phase difference (cause by the arrival time difference) in rad, $K_\mathrm{PD}$ is the phase detector gain in V/rad, $\Delta t$ is the time difference between the two signals, and $T_\mathrm{ref}$ is the period of the reference signal.

An important consideration of the PD is its linear operating range. The PD can only provide a linear output voltage for small phase differences, typically within ±180° (±π rad). If the phase difference exceeds this range, the PD characteristic "wraps around," leading to ambiguity in the phase error signal. This can cause the PLL to lose lock or behave unpredictably. Therefore, the PLL design must ensure that the phase difference remains within the linear range of the PD during normal operation, which is especially troublesome if the output frequency $f_\mathrm{out}$ is not yet close enough to its final steady-state value. Note that a simple PD can be implemented by using an XOR gate for digital signals or a mixer for analog signals.

As the output signal of the PD contains high-frequency components (at least at twice the reference frequency), a low-pass filter (LPF) is used to smooth the phase error signal before it is applied to the VCO tuning input. The LPF also determines the dynamic response of the PLL, affecting its stability and transient behavior. A well-designed LPF ensures that the PLL can quickly respond to changes in the reference signal or disturbances while maintaining stability and minimizing overshoot or oscillations in the output frequency. Often, the LPF has voltage-mode inputs and outputs to connect to the PD and VCO, respectively.

Using a digital divider in the feedback path to only pass every $N$-th cycle of the VCO output to the PD allows the PLL to generate output frequencies that are integer multiples of the reference frequency. This is particularly useful in applications such as frequency synthesis, where a wide range of frequencies is required from a single stable reference source. By adjusting the division ratio $N \in \mathbb{N}$, the PLL can produce various output frequencies while maintaining phase lock with the reference signal. However, note that the frequency resolution of the output frequencies $\Delta f_\mathrm{out}$ is limited to integer multiples of the reference frequency!

Putting everything together into an $s$-domain block diagram, the PLL can be modeled as shown in @fig-pll-block-diagram-s-domain.

{{< include /content/pll/_fig_pll_block_diagram_s_domain.qmd >}}

For the loop filter transfer function $H(s)$ we assume a simple first-order low-pass filter with a cutoff frequency of $\omega_\mathrm{LP} = 1 / T_\mathrm{LP}$ given by

$$
H_\mathrm{LP}(s) = \frac{1}{1 + s T_\mathrm{LP}}.
$$

::: {.callout-important}
## Why Regulate Phase Instead of Frequency?
Before we proceed, it is worth discussing why PLLs regulate the phase of the VCO output rather than its frequency directly. The reason lies in the relationship between phase and frequency: Frequency is the time derivative of phase. By controlling the phase, the PLL inherently controls the frequency as well. Additionally, even if the phase regulation has a steady state phase error $\varphi_\mathrm{err}$, the frequency error in steady state is **zero**, as can be appreciated when inspecting

$$
\omega_\mathrm{out}(t) = \frac{d \varphi_\mathrm{out}(t)}{dt}  = \frac{d}{dt} \left[ N \cdot \varphi_\mathrm{ref}(t) + \varphi_\mathrm{err} \right] = N \cdot \frac{d \varphi_\mathrm{ref}(t)}{dt} = N \cdot \omega_\mathrm{ref}(t).
$$

:::

We now derive the closed-loop transfer function of the PLL from reference phase $\varphi_\mathrm{ref}(s)$ to output phase $\varphi_\mathrm{out}(s)$. First, we note that

$$
V_\mathrm{PD}(s) = K_\mathrm{PD} \left[ \varphi_\mathrm{ref}(s) - \frac{\varphi_\mathrm{out}(s)}{N} \right]
$$

and

$$
\varphi_\mathrm{out}(s) = \frac{K_\mathrm{VCO}}{s} \cdot H_\mathrm{LP}(s) \cdot V_\mathrm{PD}(s) = \frac{K_\mathrm{VCO}}{s} \cdot \frac{1}{1 + s T_\mathrm{LP}} \cdot K_\mathrm{PD} \left[ \varphi_\mathrm{ref}(s) - \frac{\varphi_\mathrm{out}(s)}{N} \right].
$$

Not that this equation as one integrator $1/s$ (which we can also see in @fig-pll-block-diagram-s-domain). We call PLLs with one integrator in the loop a **Type-I PLL**. We can now rearrange to find the closed-loop transfer function $H(s)$ as

$$
H(s) = \frac{\varphi_\mathrm{out}(s)}{\varphi_\mathrm{ref}(s)} = N \cdot \frac{K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP} / N}{s^2 + s \cdot \omega_\mathrm{LP} + K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP} / N}.
$$ {#eq-pll-transfer-function}

We can use all techniques known from control theory to analyze the stability and dynamic response of the PLL based on @eq-pll-transfer-function, however, we have to keep the following in mind:

- $H(s)$ is a small-signal model of the PLL around its locked operating point, only valid for small perturbations. Large-signal behavior, such as acquisition and lock range, are not captured by this model.
- A PLL is a sampled system, working at instances of $T_\mathrm{ref}$. $H(s)$ is a continuous-time approximation, which is valid only if the loop bandwidth is much smaller (typically $1/10$) than the reference frequency $f_\mathrm{ref}$. If this approximation is not valid, a discrete-time model of the PLL must be used deriving the $z$-domain transfer function $H(z)$.

If we compare the canonical form of a second-order system given by

$$
H(s) = K \cdot \frac{\omega_\mathrm{n}^2}{s^2 + s \cdot 2 \zeta \omega_\mathrm{n} + \omega_\mathrm{n}^2},
$$

with @eq-pll-transfer-function, we can identify the natural frequency $\omega_n$ and the damping factor $\zeta$ of the PLL as

$$
\omega_\mathrm{n} = \sqrt{\frac{K_\mathrm{VCO} \cdot K_\mathrm{PD} \cdot \omega_\mathrm{LP}}{N}}
$$

and

$$
\zeta = \frac{1}{2} \sqrt{\frac{\omega_\mathrm{LP} \cdot N}{K_\mathrm{VCO} \cdot K_\mathrm{PD}}}.
$$

This allows us to use standard control theory results to design the PLL parameters $K_\mathrm{PD}$, $K_\mathrm{VCO}$, $\omega_\mathrm{LP}$, and $N$ to achieve the desired dynamic response and stability margins. Note that $\omega_\mathrm{n}$ and $\zeta$ are not independent, as they both depend on the same set of PLL parameters! This seriously limits the design of the loop dynamics, and means that we need a more complex loop filter $H_\mathrm{LP}(s)$ to achieve more freedom in selecting $\omega_\mathrm{n}$ and $\zeta$ independently. Often, we want to choose $\zeta = 1/\sqrt{2} \approx 0.707$ to achieve a Butterworth response for a good step response without overshoot.

The poles of a second-order system are given by

$$
p_{1,2} = -\omega_\mathrm{n} \left( \zeta \pm \sqrt{\zeta^2 - 1} \right)
$$

with $\zeta = 1/\sqrt{2}$ resulting in complex conjugate poles at

$$
p_{1,2} = -\frac{\omega_\mathrm{n}}{\sqrt{2}} \pm j \frac{\omega_\mathrm{n}}{\sqrt{2}}.
$$

To summarize: We can make a simple PLL using an XOR for a PD, use a first-order LPF, plus a feedback divider to get frequency multiplication of $f_\mathrm{out} = N \cdot f_\mathrm{ref}$. However, the control over the loop dynamics is very limited, and the locking procedure of the PLL is tricky, as the PD has a limited linear range of ±180°, requiring that the VCO frequency at the start of the locking procedure is already close enough to the desired output frequency. In addition, $N$ is an integer, limiting the frequency resolution of the output frequencies to integer multiples of the reference frequency.

The question is how to improve the PLL design to overcome these limitations? We will explore advanced PLL architectures and techniques in the following section.

## Charge-Pump PLL {#sec-charge-pump-pll}
